<div class="panel" style="border-width: 1px;">
<div class="panelContent">
<p>
This tutorial is part of a Series:
</p>

<ul>
<li>
<a href="display/revolution20/Developing+an+Extra+in+MODX+Revolution+-+MODX+2.1+and+Earlier" title="Developing an Extra in MODX Revolution - MODX 2.1 and Earlier">Part I: Getting Started and Creating the Doodles Snippet</a>
</li>

<li>Part II: Creating our Custom Manager Page
</li>

<li>
<a href="display/revolution20/Developing+an+Extra+in+MODX+Revolution%2C+Part+III+-+MODX+2.1+and+Earlier" title="Developing an Extra in MODX Revolution, Part III - MODX 2.1 and Earlier">Part III: Packaging Our Extra</a>
</li>
</ul>
</div>
</div>

<div>
<ul>
<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-FirstSetupSteps">First Setup Steps</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-Namespaces">Namespaces</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-ActionsandMenus">Actions and Menus</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-Lexicons">Lexicons</a>
</li>
</ul>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-SettinguptheControllerswithMODExt">Setting up the Controllers with MODExt</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-TheBaseController">The Base Controller</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-CustomRequestRouting">Custom Request Routing</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-TheHeaderController">The Header Controller</a>
</li>
</ul>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-OurDoodlesCMPPage">Our Doodles CMP Page</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-TheSectionJSFile">The Section JS File</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-ThePanelJSFile">The Panel JS File</a>
</li>
</ul>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-TheDoodlesGrid">The Doodles Grid</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-HookingUpviaConnectors">Hooking Up via Connectors</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-AddingSearch">Adding Search</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-AddinganUpdateWindow">Adding an Update Window</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-AddingaRemoveContextMenuOption">Adding a Remove Context Menu Option</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-CreatingtheCreateForm">Creating the Create Form</a>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-AddingInlineEditing">Adding Inline-Editing</a>
</li>
</ul>
</li>

<li>
<a href="revolution/2.x/case-studies-and-tutorials/developing-an-extra-in-modx-revolution-modx-2.1-and-earlier/developing-an-extra-in-modx-revolution,-part-ii-modx-2.1-and-earlier#DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-Summary">Summary</a>
</li>
</ul>
</div>

<p>
This section will cover creating the Custom Manager Page (CMP) for our Doodles Extra we created in <a href="display/revolution20/Developing+an+Extra+in+MODX+Revolution+-+MODX+2.1+and+Earlier" title="Developing an Extra in MODX Revolution - MODX 2.1 and Earlier">step 1</a>. This includes explaining controllers/connectors/processors, making our Namespace, Action and Menu item, and working with ExtJS to create the UI.
</p>

<h2>
<a name="DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-FirstSetupSteps"></a>First Setup Steps
</h2>

<p>
We've got our snippet and our basic directory structure. Now we need to setup a few things before we can start developing our Custom Manager Page. The first is our Namespace.
</p>

<h3>
<a name="DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-Namespaces"></a>Namespaces
</h3>

<p>
<a href="display/revolution20/Namespaces" title="Namespaces">Namespaces</a> in MODX Revolution are basically silos of development in the system. They load the base path for your CMP, and allow MODX to know where to grab the files for it and for Lexicon files (i18n). They allow you to develop and run your Extras without having to modify core MODX files or get in the way of Git/SVN deployments of MODX.
</p>

<p>
We'll want to create ours. Go ahead and click on the Namespaces submenu item in the System menu:
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/37683304/namespaces-menu.png?version=1&amp;modificationDate=1325795553000" style="border: 0px solid black" /></span>
</p>

<p>
From there, go ahead and click the 'Create New' button above the grid to load a Create Namespace window. Input these values into the form:
</p>

<ul>
<li>
<b>Name</b> - doodles
</li>

<li>
<b>Path</b> - /www/doodles/core/components/doodles/
</li>
</ul>

<p>
Let's explain. This gives us a Namespace key of 'doodles', which we can reference our Namespace with. Secondly, we're pointing the path to our doodles core directory that we've been developing in. This tells MODX to load the controller files that load the CMP (more on that in a sec) from that directory, which is what we want. When someone else installs this component later, their Namespace path will look like:
</p>

<blockquote>
<p>
{core_path}components/doodles/
</p>
</blockquote>

<p>
Because that's where we'll be installing the files with the Transport Package. However, setting it to an absolute path in our environment allows us to develop it outside of the MODX webroot.
</p>

<h3>
<a name="DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-ActionsandMenus"></a>Actions and Menus
</h3>

<p>
Next, we'll need to create our Actions and Menus for the CMP. What is an "Action" in MODX? Well, it's basically an abstract representation of a Manager page. Each MODX manager page has an Action in the modx_actions table, which can be referenced. This allows you to create any number of "Actions" that can be used as CMPs in the manager.
</p>

<p>
Load up the Actions page on System -&gt; Actions. This should load 2 trees:
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/37683304/doodles-actions.png?version=1&amp;modificationDate=1325795553000" style="border: 0px solid black" /></span>
</p>

<p>
We'll be first focused on the left-hand tree, which is the tree of Actions. The first level of the tree is all our Namespaces, which show as little computer icons. Below that are all the Actions for that Namespace. Our 'doodles' Namespace shows up there, but it's empty and has no Actions inside it. Let's remedy that. Right-click on the 'doodles' Namespace icon, and click 'Create Action Here'.
</p>

<p>
That should load a window, in which we'll want to input these values:
</p>

<ul>
<li>
<b>Controller</b> - controllers/index
</li>

<li>
<b>Namespace</b> - doodles
</li>

<li>
<b>Parent Controller</b> - <em>(leave blank)</em>
</li>

<li>
<b>Load Headers</b> - <em>checked</em>
</li>

<li>
<b>Language Topics</b> - doodles:default
</li>

<li>
<b>Assets</b> - <em>(leave blank)</em>
</li>
</ul>

<p>
Let's explain what each of these fields mean.
</p>

<p>
<b>Controller</b>: This tells MODX where the controller file is at for this Action, relative to the Namespace path, without the .php extension. Our file is going to be at /www/doodles/core/components/doodles/controllers/index.php. So, minus our Namespace path, that ends up being controllers/index.php. We drop the .php, and we get "controllers/index".
</p>

<p>
<b>Namespace</b>: The reference to the Namespace this Action is a part of. This should have automatically been filled in for you.
</p>

<p>
<b>Parent Controller</b>: For hierarchical display, Actions can be structured in tree form. This doesn't affect their behavior at all, and doesn't really concern us, so we'll skip it and leave it blank.
</p>

<p>
<b>Load Headers</b>: This tells MODX whether or not to load the contents of the controller in the manager's header and footer template, or if not checked, to only load the contents of the file and nothing else. This can be useful to uncheck if you want to create a CMP that runs isolated of the manager interface but is accessible via a menu. We want to leave it checked.
</p>

<p>
<b>Language Topics</b>: MODX will automatically load any Lexicon Topics (language files) that are listed here, in comma-separated format. We want to load a custom topic, called 'default', from our Doodles namespace. So we set it as 'doodles:default', which tells MODX to load the 'default' topic from the 'doodles' Namespace. We'll create this file later.
</p>

<p>
<b>Assets</b> - This field is currently not used in MODX Revolution, so we'll skip it.
</p>

<p>
Great, we've now got ourselves an Action. Now we need to tie that Action to a Menu item, which will show up in our main menu at the top of the manager. 'Menu' objects in MODX allow you to completely rearrange (and hide) menu items in the manager interface, enabling you to completely customize navigation for your MODX installation.
</p>

<p>
We're going to want to create our Doodles menu item under the 'Components' menu, which is where 3rd Party Extras usually go. We could place it anywhere, but for standards-sake, let's place it under Components. Right-click on the 'Components' tree node in the right-hand tree, and click 'Place Action Here'. That will load a window, which we can fill with these values:
</p>

<ul>
<li>
<b>Lexicon Key</b> - doodles
</li>

<li>
<b>Description</b> - doodles.desc
</li>

<li>
<b>Action</b> - doodles - controllers/index
</li>

<li>
<b>Icon</b> -
</li>

<li>
<b>Parameters</b> -
</li>

<li>
<b>Handler</b> -
</li>

<li>
<b>Permissions</b> -
</li>
</ul>

<p>
And let's explain each field:
</p>

<p>
<b>Lexicon Key</b>: This is the lexicon key for the menu item. Since MODX allows you to view the manager in a multiple number of languages, MODX provides us the option to load a Lexicon string (in our lexicon topic we said to load for the action earlier, <em>doodles:default</em>) to translate this with. We'll put <em>doodles</em> and provide that as a Lexicon string later.
</p>

<p>
<b>Description</b>: Similar to the first field, this allows us to provide either a straight up description, or a lexicon key to be translated. We'll provide a lexicon key, because we want that to be translated.
</p>

<p>
<b>Action</b> - This tells MODX what action to load when the Menu item is clicked.
</p>

<p>
<b>Icon</b> - Currently not used in the default manager interface, this allows menu items to have an icon. We'll skip it.
</p>

<p>
<b>Parameters</b> - This allows you to attach GET parameters to the menu item when clicked. We don't need this, so we'll skip it.
</p>

<p>
<b>Handler</b> - This allows you to run JavaScript instead of loading a page when running a menu item. It's useful for menu items that don't actually load a page but do things, such as the "Clear Cache" menu item under the Site menu. We'll skip this.
</p>

<p>
<b>Permissions</b> - Here you can specify a MODX Permission that MODX will check to see if the user has when loading the menu. If the user doesn't have this Permission, this menu item won't load. We don't want to restrict our CMP, so we'll leave this blank.
</p>

<p>
Great! We've got an Action and Menu now. Let's go ahead and create our default Lexicon Topic.
</p>

<h3>
<a name="DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-Lexicons"></a>Lexicons
</h3>

<p>
<a href="display/revolution20/Internationalization" title="Internationalization">Lexicons</a> in MODX Revolution allow you to provide MODX with translations for your Extra (and anything, really) in any language. We want our Extra to be i18n-compatible, so we want to utilize this feature. Each string (also called an Entry) has its own key, such as 'doodles.desc' shown above. The common practice for Lexicon keys for Extras is to prefix them with the Namespace path and a dot. This prevents collisions with other Extras.
</p>

<p>
Lexicon strings are collected in files called 'Lexicon Topics'. This means your strings can be isolated by a specific area (similar to how the core/lexicon/ directory does it), and makes it so you don't have to load <em>all</em> the strings for your Extra when you may only want to load a few.
</p>

<p>
If you wanted to use your Lexicons in a Snippet, you could use $modx-&gt;lexicon-&gt;load('doodles:default'). This would load the 'default' topic from the 'doodles' Namespace. For CMPs, however, this is a little different; you load it in the Action via the 'Language Topics' field we filled out earlier. This loads the topic in our page so we can easily access it.
</p>

<p>
But we haven't actually <em>made</em> that Lexicon Topic file, so let's go do this now. Lexicons on the filesystem are structured thus:
</p>

<blockquote>
<p>
{namespace_path}/lexicon/{language}/{topic}.inc.php
</p>
</blockquote>

<p>
So we'll go ahead and create our file here: /www/doodles/core/components/doodles/lexicon/en/default.inc.php and fill it with this:
</p>

<pre class="brush: php">
    return 'Test.'
    
</pre>
<p>
That should return something like this:
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/37683304/cmp-test.png?version=1&amp;modificationDate=1325795553000" style="border: 0px solid black" /></span>
</p>

<p>
Alright! We've got our own CMP working! Now, you could just output forms and code here, and do all your stuff in this index.php file. You don't have to use ExtJS, or any of the other functions. But, MODX provides it, and it's pretty darn powerful, and it would make your CMP be all shiny. So why not?
</p>

<h3>
<a name="DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-CustomRequestRouting"></a>Custom Request Routing
</h3>

<p>
Now that we know that it works, let's up the complexity a bit to make our CMP a bit more flexible. What if we wanted to have multiple pages in our CMP? Well, we <em>could</em> use Actions, or we could create a custom request handler to redirect to the page we want (which is what we're going to do) while still using our main Action. This allows us to do all our development and URL mapping from within our single Action. Replace the controllers/index.php file with this:
</p>

<pre class="brush: php">
    
public function initialize($ctx = 'web') {
   switch ($ctx) {
        case 'mgr':
            $this-&gt;modx-&gt;lexicon-&gt;load('doodles:default');
            if (!$this-&gt;modx-&gt;loadClass('doodlesControllerRequest',$this-&gt;config['modelPath'].'doodles/request/',true,true)) {
               return 'Could not load controller request handler.';
            }
            $this-&gt;request = new doodlesControllerRequest($this);
            return $this-&gt;request-&gt;handleRequest();
        break;
    }
    return true;
}
    
</pre>
<p>
Okay, so we're using this method to initialize the mgr context for our Doodles CMP. We tell it to load our default Doodles Lexicon Topic, and then to load another class (via our custom paths) and run the -&gt;handleRequest method on it. But we haven't made that class yet! Let's do so. In this method, note how we're loading the class name in the first parameter of the loadClass call, and then the 2nd is the path, which translates into: /www/doodles/core/components/doodles/model/doodles/request/. So we'll create our file here:
</p>

<blockquote>
<p>
/www/doodles/core/components/doodles/model/doodles/request/doodlescontrollerrequest.class.php
</p>
</blockquote>

<p>
And we'll fill it with this:
</p>

<pre class="brush: php">
    &lt;?php
$modx-&gt;regClientStartupScript($doodles-&gt;config['jsUrl'].'mgr/doodles.js');
$modx-&gt;regClientStartupHTMLBlock('&lt;script type="text/javascript"&gt;
Ext.onReady(function() {
    Doodles.config = '.$modx-&gt;toJSON($doodles-&gt;config).';
});
&lt;/script&gt;');
return '';

    
</pre>
<p>
So this header basically loads a common JS file, <em>mgr/doodles.js</em>, in our JS directory. Then it runs a JS method when ExtJS has loaded that loads the config vars for our $doodles-&gt;config in the 'Doodles.config' JS object (which we'll use for paths and such). In our doodles.js file (which is found at /www/doodles/assets/components/doodles/js/mgr/doodles.js), we have this:
</p>

<pre class="brush: php">
    &lt;?php
//$modx-&gt;regClientStartupScript($doodles-&gt;config['jsUrl'].'mgr/widgets/doodles.grid.js');
$modx-&gt;regClientStartupScript($doodles-&gt;config['jsUrl'].'mgr/widgets/home.panel.js');
$modx-&gt;regClientStartupScript($doodles-&gt;config['jsUrl'].'mgr/sections/index.js');

return '&lt;div id="doodles-panel-home-div"&gt;&lt;/div&gt;';
    
</pre>
<p>
Great! So we're doing a couple things here. We're loading a few 'widgets', and then loading a 'section'. These terms are arbitrary, but we're using them here in the same way MODX uses them in MODExt to render the manager interface. Basically, a "widget" is something like a grid of objects (such as Doodles), or a tree, or a specialized panel. Putting them in separate files allows you to use them in different pages without having to duplicate code. A "section" is a piece of JS that actually <em>loads</em> the widgets onto a page. Including a widget won't load and render it - a section will render it.
</p>

<p>
We're going to load first the doodles.grid.js, which is a widget that displays a grid of Doodles. Secondly, we load the 'home' panel, which is our home page's main panel, that the grid will reside in. And finally, we load the 'index' section, which renders the UI.
</p>

<p>
We're going to leave the grid commented out for now, but we'll come back to it. Promise.
</p>

<div class="note">
We could have put all these JS files in one file, which would have loaded the page faster. For illustration purposes, we put them in 3 separate files, to make explaining this tutorial easier. Feel free to do whatever you want when developing your CMP.
</div>

<h3>
<a name="DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-TheSectionJSFile"></a>The Section JS File
</h3>

<p>
Let's first create the index.js file, at /www/doodles/assets/components/doodles/js/mgr/sections/index.js:
</p>

<pre class="brush: php">
    Doodles.panel.Home = function(config) {
    config = config || {};
    Ext.apply(config,{
        border: false
        ,baseCls: 'modx-formpanel'
        ,items: [{
            html: '&lt;h2&gt;'+_('doodles.management')+'&lt;/h2&gt;'
            ,border: false
            ,cls: 'modx-page-header'
        },{
            xtype: 'modx-tabs'
            ,bodyStyle: 'padding: 10px'
            ,defaults: { border: false ,autoHeight: true }
            ,border: true
            ,items: [{
                title: _('doodles')
                ,defaults: { autoHeight: true }
                ,items: [{
                    html: '&lt;p&gt;'+_('doodles.management_desc')+'&lt;/p&gt;&lt;br /&gt;'
                    ,border: false
                }]
            }]
        }]
    });
    Doodles.panel.Home.superclass.constructor.call(this,config);
};
Ext.extend(Doodles.panel.Home,MODx.Panel);
Ext.reg('doodles-panel-home',Doodles.panel.Home);
    
</pre>
<p>
So, first, at the bottom, note how we're registering this panel to 'doodles-panel-home', which we referenced in our section. Also note that this panel extends MODx.Panel, which in turn extends Ext.Panel. Why not just extend Ext.Panel? Well, extending MODx.Panel does the same, and adds a CSS class to the panel to give it the nice manager MODX styling.
</p>

<p>
We're going to give this panel a baseCls of 'modx-formpanel', which lets our top part have a transparent background. Then, we'll make sure it doesn't have a border.
</p>

<p>
Next, we'll define the 'items' in the panel. First, we add a header:
</p>

<pre class="brush: php">
    ,{
   xtype: 'modx-tabs'
   ,bodyStyle: 'padding: 10px'
   ,defaults: { border: false ,autoHeight: true }
   ,border: true
   ,items: /* ... */
}
    
</pre>
<p>
Note we load our tabpanel with the xtype 'modx-tabs'. This loads a MODX-specific tabpanel, which has some MODX-specific configuration options. Then we give it some padding, a border, and make sure the defaults for its tabs have no border and an automatic height. Then, we add the tab itself:
</p>

<pre class="brush: php">
    $modx-&gt;regClientStartupScript($doodles-&gt;config['jsUrl'].'mgr/widgets/doodles.grid.js');
    
</pre>
<p>
This tells MODX to load the grid widget file, which we'll now create at /www/doodles/assets/components/doodles/js/mgr/widgets/doodles.grid.js:
</p>

<pre class="brush: php">
    ,items: [{
   html: '&lt;p&gt;'+_('doodles.management_desc')+'&lt;/p&gt;&lt;br /&gt;'
   ,border: false
}]
    
</pre>
<p>
to this:
</p>

<pre class="brush: php">
    
require_once dirname(dirname(dirname(dirname(__FILE__)))).'/config.core.php';
require_once MODX_CORE_PATH.'config/'.MODX_CONFIG_KEY.'.inc.php';
require_once MODX_CONNECTORS_PATH.'index.php';

$corePath = $modx-&gt;getOption('doodles.core_path',null,$modx-&gt;getOption('core_path').'components/doodles/');
require_once $corePath.'model/doodles/doodles.class.php';
$modx-&gt;doodles = new Doodles($modx);

$modx-&gt;lexicon-&gt;load('doodles:default');

/* handle request */
$path = $modx-&gt;getOption('processorsPath',$modx-&gt;doodles-&gt;config,$corePath.'processors/');
$modx-&gt;request-&gt;handleRequest(array(
    'processors_path' =&gt; $path,
    'location' =&gt; '',
));

    
</pre>
<p>
That's it. We first load the config.core.php file. We'll go ahead and add it here in our development environment; in standard MODX installs, this will already exist.
</p>

<p>
Create a file at /www/doodles/config.core.php and put this in it:
</p>

<pre class="brush: php">
    &lt;?php
$isLimit = !empty($scriptProperties['limit']);
$start = $modx-&gt;getOption('start',$scriptProperties,0);
$limit = $modx-&gt;getOption('limit',$scriptProperties,10);
$sort = $modx-&gt;getOption('sort',$scriptProperties,'name');
$dir = $modx-&gt;getOption('dir',$scriptProperties,'ASC');

/* build query */
$c = $modx-&gt;newQuery('Doodle');
$count = $modx-&gt;getCount('Doodle',$c);
$c-&gt;sortby($sort,$dir);
if ($isLimit) $c-&gt;limit($limit,$start);
$doodles = $modx-&gt;getIterator('Doodle', $c);

/* iterate */
$list = array();
foreach ($doodles as $doodle) {
    $doodleArray = $doodle-&gt;toArray();
    $list[]= $doodleArray;
}
return $this-&gt;outputArray($list,$count);
    
</pre>
<p>
Great. So a few things. You'll note the $modx object, and an array called $scriptProperties, is already available. What is $scriptProperties? Well here it's a sanitized array of REQUEST vars - anything passed in goes in that array. So you'll notice we're setting up some default parameters to handle sorting and pagination at the beginning.
</p>

<p>
Then, we're creating a new <a href="display/xPDO20/xPDOQuery" title="xPDOQuery">xPDOQuery</a> object to do sorting and pagination on the query with our passed-in parameters. We grab a collection of Doodle objects then with $modx-&gt;getIterator. $modx-&gt;getIterator is the same as $modx-&gt;getCollection, with one big caveat; it only loads objects as they are requested - so it's faster than getCollection when just looping over a collection of objects like we're doing here.
</p>

<p>
Finally, we use a foreach loop to loop over our data, store an associative array of their fields and values using -&gt;toArray, and then run a special-to-processors method called 'outputArray'. This method returns a JSON array of data, with 2 parameters - the first being the array of data, and the second being the total number of objects. We are passing in a $count var here, because if we had more than 10 Doodles, we'd want to get the total number (as we're only returning 10 by default).
</p>

<p>
That's it. Now let's load up our grid:
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/37683304/doodles-grid1.png?version=1&amp;modificationDate=1325795553000" style="border: 0px solid black" /></span>
</p>

<p>
Great! We've got a working grid. Now, let's add some functionality to it, since right now all it does is list Doodles.
</p>

<h3>
<a name="DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-AddingSearch"></a>Adding Search
</h3>

<p>
Add this bit of code to your grid panel, right after the columns: definition:
</p>

<pre class="brush: php">
    Ext.extend(Doodles.grid.Doodles,MODx.grid.Grid);
    
</pre>
<p>
And replace it with this:
</p>

<pre class="brush: php">
    $query = $modx-&gt;getOption('query',$scriptProperties,'');
    
</pre>
<p>
And right below our $modx-&gt;newQuery('Doodle') call, add this:
</p>

<pre class="brush: php">
    ,getMenu: function() {
    var m = [{
        text: _('doodles.doodle_update')
        ,handler: this.updateDoodle
    },'-',{
        text: _('doodles.doodle_remove')
        ,handler: this.removeDoodle
    }];
    this.addContextMenuItem(m);
    return true;
}
    
</pre>
<p>
MODX looks for a getMenu method on grids that extend it, and if it finds it, it runs it. Here we've added 2 menu items for our context menu, one that runs a this.updateDoodle method, and the other that runs a this.removeDoodle method. We'll get to the removeDoodle method here in a bit. For now, let's add another JS method below the getMenu call, and call it updateDoodle:
</p>

<pre class="brush: php">
    Doodles.window.UpdateDoodle = function(config) {
    config = config || {};
    Ext.applyIf(config,{
        title: _('doodles.doodle_update')
        ,url: Doodles.config.connectorUrl
        ,baseParams: {
            action: 'mgr/doodle/update'
        }
        ,fields: [{
            xtype: 'hidden'
            ,name: 'id'
        },{
            xtype: 'textfield'
            ,fieldLabel: _('doodles.name')
            ,name: 'name'
            ,width: 300
        },{
            xtype: 'textarea'
            ,fieldLabel: _('doodles.description')
            ,name: 'description'
            ,width: 300
        }]
    });
    Doodles.window.UpdateDoodle.superclass.constructor.call(this,config);
};
Ext.extend(Doodles.window.UpdateDoodle,MODx.Window);
Ext.reg('doodles-window-doodle-update',Doodles.window.UpdateDoodle);
    
</pre>
<p>
Similar to what you've seen in the grids, except this time we have 'fields' as the fields for the Window's form. We've provided some fields to edit - and remember, since this is an "Update" form, we need to provide the ID of the Doodle, passed in as a hidden field.
</p>

<p>
MODx.Window wraps Ext.Window, but provides a form inside that will automatically try and connect to the url: param with the baseParams: parameters, as well as the fields' values. It also automatically provides OK/Cancel buttons. Right-click on a record in the grid, and your window should look like this now:
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/37683304/doodles-window-update.png?version=1&amp;modificationDate=1325795553000" style="border: 0px solid black" /></span>
</p>

<p>
Excellent! We've got a nice little update window. Now as you probably noticed in our baseParams, we're looking now for the 'mgr/doodle/update' processor. So let's create a file at: /www/doodles/core/components/doodles/processors/mgr/doodle/update.php:
</p>

<pre class="brush: php">
    ,removeDoodle: function() {
    MODx.msg.confirm({
        title: _('doodles.doodle_remove')
        ,text: _('doodles.doodle_remove_confirm')
        ,url: this.config.url
        ,params: {
            action: 'mgr/doodle/remove'
            ,id: this.menu.record.id
        }
        ,listeners: {
            'success': {fn:this.refresh,scope:this}
        }
    });
}
    
</pre>
<p>
MODx.msg.confirm pops up a confirmation dialog, and if confirmed, runs a processor via a connector. Let's take a look at each parameter:
</p>

<ul>
<li>
<b>title</b> - This is the title of the confirmation dialog.
</li>

<li>
<b>text</b> - The text of the dialog. Here it basically asks if we really want to remove a Doodle.
</li>

<li>
<b>url</b> - The URL to the connector.
</li>

<li>
<b>params</b> - Any REQUEST parameters to send to the processor. We're going to send the processor path, and the ID of the Doodle to remove.
</li>

<li>
<b>listeners</b> - Similar to our update form's listeners, whenever this succeeds, refresh the grid.
</li>
</ul>

<p>
Now let's create our remove processor at /www/doodles/core/components/doodles/processors/mgr/doodle/remove.php:
</p>

<pre class="brush: php">
    ,{
   text: _('doodles.doodle_create')
   ,handler: { xtype: 'doodles-window-doodle-create' ,blankValues: true }
}
    
</pre>
<p>
MODExt allows you to pass JSON objects into the handler: method on toolbars. What this does is loads the Window with the xtype 'doodles-window-doodle-create', makes sure its values are blanked on load, and runs this.success on a successful window form submit (basically shortcuts the stuff we've been doing). That's what we want, so let's now define the window at the end of our file:
</p>

<pre class="brush: php">
    
&lt;?php
if (empty($scriptProperties['name'])) {
    $modx-&gt;error-&gt;addField('name',$modx-&gt;lexicon('doodles.doodle_err_ns_name'));
} else {
    $alreadyExists = $modx-&gt;getObject('Doodle',array('name' =&gt; $scriptProperties['name']));
    if ($alreadyExists) {
        $modx-&gt;error-&gt;addField('name',$modx-&gt;lexicon('doodles.doodle_err_ae'));
    }
}

if ($modx-&gt;error-&gt;hasError()) { return $modx-&gt;error-&gt;failure(); }

$doodle = $modx-&gt;newObject('Doodle');
$doodle-&gt;fromArray($scriptProperties);

if ($doodle-&gt;save() == false) {
    return $modx-&gt;error-&gt;failure($modx-&gt;lexicon('doodles.doodle_err_save'));
}

return $modx-&gt;error-&gt;success('',$doodle);
    
</pre>
<p>
Similar to the update and remove methods, again, except we aren't grabbing the object, but rather using newObject to create it. Also, we have a bit of form validation beforehand - we're going to make sure the name isn't blank, and if it is, return a custom error message on that specific field. If it's not blank, then we'll make sure there's no other Doodles with that name. The $modx-&gt;error-&gt;hasError() method checks to see if any errors have been registered earlier in the processor, and returns true if there were. If there were errors, we'll return a failure message, and we'll get an error message like so:
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/37683304/doodles-error-no-name.png?version=1&amp;modificationDate=1325795553000" style="border: 0px solid black" /></span>
</p>

<p>
Pretty neat, huh? Field-specific validation, built right in. And we've got a working create form!
</p>

<h3>
<a name="DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-AddingInlineEditing"></a>Adding Inline-Editing
</h3>

<p>
MODExt also has automatic inline editing built right into its grids. Simply add this to your Doodles.grid.Grid config object, right below the 'autoExpandColumn' property:
</p>

<pre class="brush: php">
    &lt;?php
/* parse JSON */
if (empty($scriptProperties['data'])) return $modx-&gt;error-&gt;failure('Invalid data.');
$_DATA = $modx-&gt;fromJSON($scriptProperties['data']);
if (!is_array($_DATA)) return $modx-&gt;error-&gt;failure('Invalid data.');

/* get obj */
if (empty($_DATA['id'])) return $modx-&gt;error-&gt;failure($modx-&gt;lexicon('doodles.doodle_err_ns'));
$doodle = $modx-&gt;getObject('Doodle',$_DATA['id']);
if (empty($doodle)) return $modx-&gt;error-&gt;failure($modx-&gt;lexicon('doodles.doodle_err_nf'));

$doodle-&gt;fromArray($_DATA);

/* save */
if ($doodle-&gt;save() == false) {
    return $modx-&gt;error-&gt;failure($modx-&gt;lexicon('doodles.doodle_err_save'));
}

return $modx-&gt;error-&gt;success('',$doodle);
    
</pre>
<p>
Note the similarity to our update.php processor, except one thing - we're first processing a param in the $scriptProperties array called "data". This contains a JSON object of our row in the grid, with all the values. We'll just use $modx-&gt;fromJSON() to convert it to a nice, readable array, and then use its values in the rest of our processor. Simple, eh?
</p>

<h2>
<a name="DevelopinganExtrainMODXRevolution%2CPartII-MODX2.1andEarlier-Summary"></a>Summary
</h2>

<p>
We've got ourselves a nice CRUD user interface now, with creating, updating, removing, searching, pagination, and sorting. And all pretty easily, too.
</p>

<p>
Next, in Part III, we'll explore <a href="display/revolution20/Developing+an+Extra+in+MODX+Revolution%2C+Part+III+-+MODX+2.1+and+Earlier" title="Developing an Extra in MODX Revolution, Part III - MODX 2.1 and Earlier">creating a Transport Package</a> for our Doodles Extra so that we can distribute it on modxcms.com and via Revolution's Package Management system.
</p>

<div class="panel" style="border-width: 1px;">
<div class="panelContent">
<p>
This tutorial is part of a Series:
</p>

<ul>
<li>
<a href="display/revolution20/Developing+an+Extra+in+MODX+Revolution+-+MODX+2.1+and+Earlier" title="Developing an Extra in MODX Revolution - MODX 2.1 and Earlier">Part I: Getting Started and Creating the Doodles Snippet</a>
</li>

<li>Part II: Creating our Custom Manager Page
</li>

<li>
<a href="display/revolution20/Developing+an+Extra+in+MODX+Revolution%2C+Part+III+-+MODX+2.1+and+Earlier" title="Developing an Extra in MODX Revolution, Part III - MODX 2.1 and Earlier">Part III: Packaging Our Extra</a>
</li>
</ul>
</div>
</div>