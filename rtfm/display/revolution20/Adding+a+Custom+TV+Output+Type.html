<div class='panelMacro'>
<table class='warningMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<b>Only use this documentation for pre-2.2 or core submissions.</b>
<br />
Refer to the <a href="/display/revolution20/Adding+a+Custom+TV+Type+-+MODX+2.2" title="Adding a Custom TV Type - MODX 2.2">Adding a Custom TV Type</a> doc for the proper way to build custom TVs in 2.2 which allows easy packaging.
</td>
</tr>
</table>
</div>

<div>
<ul>
<li>
<a href='#AddingaCustomTVOutputType-WhatareTVOutputTypes%3F'>What are TV Output Types?</a>
</li>

<li>
<a href='#AddingaCustomTVOutputType-CreatingtheFiles'>Creating the Files</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#AddingaCustomTVOutputType-SettinguptheInputPropertiesController'>Setting up the Input Properties Controller</a>
</li>

<li>
<a href='#AddingaCustomTVOutputType-SettinguptheInputPropertiesTemplate'>Setting up the Input Properties Template</a>
</li>

<li>
<a href='#AddingaCustomTVOutputType-SettinguptheOutputController'>Setting up the Output Controller</a>
</li>
</ul>
</li>

<li>
<a href='#AddingaCustomTVOutputType-UsingtheCustomTVOutputType'>Using the Custom TV Output Type</a>
</li>

<li>
<a href='#AddingaCustomTVOutputType-SeeAlso'>See Also</a>
</li>
</ul>
</div>

<h2>
<a name="AddingaCustomTVOutputType-WhatareTVOutputTypes%3F"></a>What are TV Output Types?
</h2>

<p>
TV Output Types allow you to output <a href="/display/revolution20/Template+Variables" title="Template Variables">Template Variables</a> in different markup and formats. Some examples include outputting a TV value as an image, URL, HTML tag, date, etc.
</p>

<p>
MODx Revolution lets you create custom output types fairly easily.
</p>

<h2>
<a name="AddingaCustomTVOutputType-CreatingtheFiles"></a>Creating the Files
</h2>

<p>
Let's create a custom TV Output Type called "button". This will render an input button (or more than one) with a specified value and an optional name, with some other fields for attributes. You'll need 3 files:
</p>

<ul>
<li>An input properties controller - put here: core/model/modx/processors/element/tv/renders/mgr/properties/button.php
</li>

<li>An input properties template - put here: manager/templates/default/element/tv/renders/properties/button.tpl
</li>

<li>An output controller - put here: core/model/modx/processors/element/tv/renders/web/output/button.php
</li>
</ul>

<h3>
<a name="AddingaCustomTVOutputType-SettinguptheInputPropertiesController"></a>Setting up the Input Properties Controller
</h3>

<p>
This is the PHP file that will load the mgr template for managing the TV output type's properties. We'll have it contain just this:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
<span class="code-comment">// any custom php you want to run here
</span><span class="code-keyword">return</span> $modx-&gt;smarty-&gt;fetch('element/tv/renders/properties/button.tpl');
</pre>
</div>
</div>

<h3>
<a name="AddingaCustomTVOutputType-SettinguptheInputPropertiesTemplate"></a>Setting up the Input Properties Template
</h3>

<p>
This is the template for the default manager theme to render properties with. We'll use ExtJS to render some pretty form fields:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;div id=<span class="code-quote">"tv-wprops-form{$tv}"</span>&gt;&lt;/div&gt;
{literal}
&lt;script type=<span class="code-quote">"text/javascript"</span>&gt;
<span class="code-comment">// &lt;![CDATA[
</span><span class="code-keyword">var</span> params = {
{/literal}{foreach from=$params key=k item=v name='p'}
 '{$k}': '{$v}'{<span class="code-keyword">if</span> NOT $smarty.foreach.p.last},{/<span class="code-keyword">if</span>}
{/foreach}{literal}
};
<span class="code-keyword">var</span> oc = {'change':{fn:function(){Ext.getCmp('modx-panel-tv').markDirty();},scope:<span class="code-keyword">this</span>}};
MODx.load({
    xtype: 'panel'
    ,layout: 'form'
    ,autoHeight: <span class="code-keyword">true</span>
    ,labelWidth: 150
    ,border: <span class="code-keyword">false</span>
    ,items: [{
        xtype: 'textfield'
        ,fieldLabel: _('class')
        ,name: 'prop_class'
        ,id: 'prop_class{/literal}{$tv}{literal}'
        ,value: params['class'] || ''
        ,width: 300
        ,listeners: oc
    },{
        xtype: 'textfield'
        ,fieldLabel: _('id')
        ,name: 'prop_id'
        ,id: 'prop_id{/literal}{$tv}{literal}'
        ,value: params['id'] || ''
        ,width: 300
        ,listeners: oc
    },{
        xtype: 'textfield'
        ,fieldLabel: _('style')
        ,name: 'prop_style'
        ,id: 'prop_style{/literal}{$tv}{literal}'
        ,value: params['style'] || ''
        ,width: 300
        ,listeners: oc
    },{
        xtype: 'textfield'
        ,fieldLabel: _('attributes')
        ,name: 'prop_attributes'
        ,id: 'prop_attributes{/literal}{$tv}{literal}'
        ,value: params['attributes'] || ''
        ,width: 300
        ,listeners: oc
    }]
    ,renderTo: 'tv-wprops-form{/literal}{$tv}{literal}'
});
<span class="code-comment">// ]]&gt;
</span>&lt;/script&gt;
{/literal}
</pre>
</div>
</div>

<p>
The key way these save is that each field is prepended with 'prop_' in its name. This tells MODx to save this field in the TV's output properties. Make sure you specify your fields with this prefix!
</p>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
You don't have to use ExtJS, however - you can use just straight HTML - it's totally up to you.
<br />
Note that if you created another manager theme, you'd have to create a properties tpl for that theme as well.
</td>
</tr>
</table>
</div>

<h3>
<a name="AddingaCustomTVOutputType-SettinguptheOutputController"></a>Setting up the Output Controller
</h3>

<p>
Now we get into the good stuff. This controller will handle exactly how the button is outputted. Our file looks like this (comments inline):
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
$o= '';
$buttons= $<span class="code-keyword">this</span>-&gt;parseInput($value, '||', 'array');
/* allow multiple buttons separated by ||, or checkbox/multiple input tvs */
foreach ($buttons as $button) {
    <span class="code-keyword">if</span> (!is_array($button)) {
        $button= explode('==', $button);
    }
    /* the TV value must have a value of either: text or text==name */
    $text = $button[0];
    <span class="code-keyword">if</span> (!empty($text)) {
        $attributes = '';
        $attr = array(
            'class' =&gt; $params['class'],
            'id' =&gt; ($params['id'] ? $params['id'] : ''),
            'alt' =&gt; htmlspecialchars($params['alttext']),
            'style' =&gt; $params['style']
        );
        /* <span class="code-keyword">if</span> a name is specified, use it! */
        <span class="code-keyword">if</span> (!empty($button[1])) $attr['name'] = $button[1];

        /* separate the attributes into html tag format */
        foreach ($attr as $k =&gt; $v) $attributes.= ($v ? ' '.$k.'=<span class="code-quote">"'.$v.'"</span>' : '');
        $attributes .= ' '.$params['attrib'];

        /* Output the image with attributes */
        $o .= '&lt;button'.rtrim($attributes).'&gt;'.$text.'&lt;/button&gt;'.<span class="code-quote">"\n"</span>;
    }
}

<span class="code-keyword">return</span> $o;
</pre>
</div>
</div>

<h2>
<a name="AddingaCustomTVOutputType-UsingtheCustomTVOutputType"></a>Using the Custom TV Output Type
</h2>

<p>
So, how does it look? Well, it should render an output form like this when editing the TV - I've added some custom values to it as well:
</p>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/18678064/outtvprop1.png?version=1&amp;modificationDate=1269529790000" style="border: 0px solid black" /></span>
</p>

<p>
So we'll save this, and then let's go edit in in a Resource. We'll specify two buttons, separating with ||. We could also just do one button. And, we'll have the first button have a custom 'name' attribute as well:
</p>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/18678064/outtvinput.png?version=1&amp;modificationDate=1269529790000" style="border: 0px solid black" /></span>
</p>

<p>
Great. Now let's preview the resource, and we'll get an output like this:
</p>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/18678064/outtvresult1.png?version=1&amp;modificationDate=1269529790000" style="border: 0px solid black" /></span>
</p>

<p>
And we can examine the HTML source:
</p>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/18678064/outtvsource1.png?version=1&amp;modificationDate=1269529790000" style="border: 0px solid black" /></span>
</p>

<p>
And there you go! A custom TV output type!
</p>

<h2>
<a name="AddingaCustomTVOutputType-SeeAlso"></a>See Also
</h2>

<div class="plugin_pagetree">
<div style="margin-left: 2em" class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">
<div class="plugin_pagetree_children">
</div>
</div>

<fieldset class="hidden">
<input type="hidden" name="treeId" value="" /> <input type="hidden" name="treeRequestId" value="/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false" /> <input type="hidden" name="treePageId" value="18678064" /> <input type="hidden" name="noRoot" value="false" /> <input type="hidden" name="rootPageId" value="18678062" /> <input type="hidden" name="rootPage" value="" /> <input type="hidden" name="startDepth" value="0" /> <input type="hidden" name="spaceKey" value="revolution20" /> <input type="hidden" name="i18n-pagetree.loading" value="Loading..." /> <input type="hidden" name="i18n-pagetree.error.permission" value="Unable to load page tree. It seems that you do not have permission to view the root page." /> <input type="hidden" name="i18n-pagetree.eeror.general" value="There was a problem retrieving the page tree. Please check the server log file for more information." /> <input type="hidden" name="loginUrl" value="/login.action?os_destination=%2Fdisplay%2Frevolution20%2FAdding%2Ba%2BCustom%2BTV%2BOutput%2BType" />
<fieldset class="hidden">
<input type="hidden" name="ancestorId" value="18678062" />
</fieldset>
</fieldset>
</div>