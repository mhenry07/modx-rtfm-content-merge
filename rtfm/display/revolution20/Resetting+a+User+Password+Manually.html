<p>
<br class="atl-forced-newline" />
</p>

<div>
<ul>
<li>
<a href='#ResettingaUserPasswordManually-ResettingaUserPasswordviaDatabaseManipulation'>Resetting a User Password via Database Manipulation</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#ResettingaUserPasswordManually-ResettingPasswordinMODX2.1'>Resetting Password in MODX 2.1+</a>
</li>

<li>
<a href='#ResettingaUserPasswordManually-ResettingPasswordinMODX2.0.x'>Resetting Password in MODX 2.0.x</a>
</li>
</ul>
</li>

<li>
<a href='#ResettingaUserPasswordManually-ResettingaPasswordviatheAPI'>Resetting a Password via the API</a>
</li>
</ul>
</div>

<h2>
<a name="ResettingaUserPasswordManually-ResettingaUserPasswordviaDatabaseManipulation"></a>Resetting a User Password via Database Manipulation
</h2>

<p>
It is not uncommon for a User account to become inaccessible because of a lost/forgotten password. In many cases, this can easily be resolved by having the user use the Forgot Password link on the login form. But in some cases you may need to manually reset the password directly in the database. You will need access to the database containing the MODX tables in order to this, either via PHPMyAdmin or another database client that allows you to edit or UPDATE database records.
</p>

<h3>
<a name="ResettingaUserPasswordManually-ResettingPasswordinMODX2.1"></a>Resetting Password in MODX 2.1+
</h3>

<p>
In MODX 2.1+, users are created by default with the a hashing algorithm called PBKDF2. Databases like MySQL or SQL Server generally do not have functions for calculating these hashes, and as a result, in order to manually reset the password in the database, you will also need to change the hash_class specified for the user from hashing.modPBKDF2 to hashing.modMD5. Then you can use the native MD5() function to set the value of the password field appropriately. Here is an example MySQL UPDATE statement:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
UPDATE modx_users SET hash_class = 'hashing.modMD5', password = MD5('the-<span class="code-keyword">new</span>-password') WHERE username = 'theusername';
</pre>
</div>
</div>

<p>
If you want to then have the user password automatically converted back to PBKDF2, you can install the <a href="http://modx.com/extras/package/pbkdf2convert" class="external-link" rel="nofollow">pbkdf2Convert Plugin</a> available from Package Management.
</p>

<h3>
<a name="ResettingaUserPasswordManually-ResettingPasswordinMODX2.0.x"></a>Resetting Password in MODX 2.0.x
</h3>

<p>
In MODX 2.0.x, you can simply reset the password field with a valid MD5 hash value directly in the database table. Here is an example MySQL UPDATE statement that can reset a user's password by username:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
UPDATE modx_users SET password = MD5('the-<span class="code-keyword">new</span>-password') WHERE username = 'theusername';
</pre>
</div>
</div>

<h2>
<a name="ResettingaUserPasswordManually-ResettingaPasswordviatheAPI"></a>Resetting a Password via the API
</h2>

<p>
You can also reset the password (or manipulate any part of the MODX application) by using the API. Below is a sample script to update the password and email address of a given user. It also ensures this user is in the Administrator User Group.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
define('MODX_API_MODE', <span class="code-keyword">true</span>); <span class="code-comment">// Gotta set <span class="code-keyword">this</span> one constant.
</span>
<span class="code-comment">// Reset the password and email of an existing user
</span><span class="code-comment">// and ensure they are a member of the specified group
</span>$username = 'theusername';
$password = 'newpassword';
$email = '<span class="code-keyword">new</span>@email.com';

$user_group = 1; <span class="code-comment">// 1 <span class="code-keyword">for</span> Administrator 
</span>
<span class="code-comment">// Full path to the MODX index.php file
</span>require_once('/full/path/to/index.php');

<span class="code-comment">// ====== Don't change anything below <span class="code-keyword">this</span> line ======
</span><span class="code-keyword">if</span> (empty($username) || empty($password) || empty($email)) {
        die('ERROR: Missing criteria.');
}



$modx= <span class="code-keyword">new</span> modX();
$modx-&gt;initialize('mgr');

$query = $modx-&gt;newQuery('modUser');
$query-&gt;where( array('username'=&gt;$username) );
$user = $modx-&gt;getObjectGraph('modUser', '{ <span class="code-quote">"Profile"</span>:{}, <span class="code-quote">"UserGroupMembers"</span>:{} }', $query);
<span class="code-comment">// print_r($user); exit;
</span><span class="code-keyword">if</span> (!$user) {
        die(<span class="code-quote">"ERROR: No user with username $username"</span>);
}


$user-&gt;set('username',$username);
$user-&gt;set('active',1);
$user-&gt;set('password', $password);
$user-&gt;Profile-&gt;set('email', $email);
$user-&gt;Profile-&gt;set('blocked', 0);
$user-&gt;Profile-&gt;set('blockeduntil', 0);
$user-&gt;Profile-&gt;set('blockedafter', 0);

<span class="code-comment">// Verify the user is a member of specified User Group
</span>$is_member = <span class="code-keyword">false</span>;
<span class="code-keyword">if</span> (!empty($user-&gt;UserGroupMembers)) {
        foreach ($user-&gt;UserGroupMembers as $UserGroupMembers) {
                <span class="code-keyword">if</span> ($UserGroupMembers-&gt;get('user_group') == $user_group) {
                        $is_member = <span class="code-keyword">true</span>;
                        <span class="code-keyword">break</span>;                        
                }
        }
}
<span class="code-comment">// Add the User to the User Group <span class="code-keyword">if</span> he is not a member
</span><span class="code-keyword">if</span> (!$is_member) {
        <span class="code-comment">// Verify the user group exists
</span> $UserGroup = $modx-&gt;getObject('modUserGroup', $user_group);
        <span class="code-keyword">if</span> (!$UserGroup) {
                die (<span class="code-quote">"ERROR: User Group $user_group does not exist."</span>);
        }

        $Member = $modx-&gt;newObject('modUserGroupMember');
        $Member-&gt;set('user_group', $user_group); 
        $Member-&gt;set('member', $user-&gt;get('id'));
        <span class="code-comment">// Super User = role 2
</span> $Member-&gt;set('role', 2); 
        $Member-&gt;set('rank', 0);
        $user-&gt;addOne($Member,'UserGroupMembers');
}

/* save user */
<span class="code-keyword">if</span> (!$user-&gt;save()) {
        die('ERROR: Could not save user.');
}

print <span class="code-quote">"SUCCESS: User $username updated."</span>;

?&gt;
</pre>
</div>
</div>

<p>
You can put this script anywhere on your server so long as you update the path to the primary <b>index.php</b> file. You can execute the script by hitting it in a browser or via the command line.
</p>

<div class='panelMacro'>
<table class='warningMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<b>Warning</b>
<br />
Be extremely careful when using a script like this! If possible, do NOT put it inside your document root â€“ instead put it outside of your document root and execute the script via the command line.
</td>
</tr>
</table>
</div>