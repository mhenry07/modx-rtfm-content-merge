<p>
<br class="atl-forced-newline" />
</p>

<div>
<ul>
<li>
<a href='#Plugins-WhatisaPlugin%3F'>What is a Plugin?</a>
</li>

<li>
<a href='#Plugins-TheEventModel'>The Event Model</a>
</li>

<li>
<a href='#Plugins-HandlinganEvent'>Handling an Event</a>
</li>

<li>
<a href='#Plugins-PluginExamples'>Plugin Examples</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#Plugins-MessagetheUser%3A'>Message the User:</a>
</li>

<li>
<a href='#Plugins-CustomValidation'>Custom Validation</a>
</li>

<li>
<a href='#Plugins-WordFilter'>Word Filter</a>
</li>

<li>
<a href='#Plugins-PageNotFoundRedirector%3A'>Page-Not-Found Redirector:</a>
</li>
</ul>
</li>

<li>
<a href='#Plugins-SeeAlso'>See Also</a>
</li>
</ul>
</div>

<h2>
<a name="Plugins-WhatisaPlugin%3F"></a>What is a Plugin?
</h2>

<p>
Plugins are similar to Snippets in that they are bits of PHP code that have access to the MODx API. The big difference, however, is in <em>when</em> the code executes. You put Snippets inside of a page or inside a template and they run when the page is viewed, whereas Plugins are set to execute during certain system events, e.g. saving a Chunk, or emptying the cache. So when a given event "fires", any Plugin "listening" for that event is executed. Once the Plugin's code has executed, control returns to the point after the spot where the System Event was triggered.
</p>

<div class='panelMacro'>
<table class='infoMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<b>Other CMSs</b>
<br />
Every CMS uses some concept of "plugin", but the exact nomenclature may differ. In WordPress, for example, plugins are "hooked" to events called "actions" or "filters".
</td>
</tr>
</table>
</div>

<p>
Since they execute during various events, Plugins aren't limited to front-end processing. Many events are triggered by events that take place only within the MODx Manager. There is a list of MODx System Events <a href="http://wiki.modxcms.com/index.php/System_Events" title="MODx System Events" class="external-link" rel="nofollow">here</a>.
</p>

<div class='panelMacro'>
<table class='infoMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
Any closing PHP tag ?&gt; will be stripped from your plugin code when it is saved. It's unnecessary (and unwanted) because the plugin code will end up inside other PHP code when executed.
</td>
</tr>
</table>
</div>

<h2>
<a name="Plugins-TheEventModel"></a>The Event Model
</h2>

<p>
MODx invokes System Events across its code processes to allow you to modify core functionality without hacking the core. These System Events can have any number of Plugins attached to them, and will execute each Plugin in rank according to its priority (lowest numbers first).
</p>

<h2>
<a name="Plugins-HandlinganEvent"></a>Handling an Event
</h2>

<p>
In your Plugin, how you handle the output depends on the System Event you are in. For some system events, you return a value from the Plugin. For others, you access the output by reference and modify it.
</p>

<p>
If you need to know which event triggered your plugin (say, for a plugin that listens to more than one event), you can access the Event's name like so:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$eventName = $modx-&gt;event-&gt;name;
</pre>
</div>
</div>

<p>
The code for a Plugin listening to more than one event looks like this:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$eventName = $modx-&gt;event-&gt;name;
<span class="code-keyword">switch</span>($eventName) {
    <span class="code-keyword">case</span> 'OnWebPageInit':
        /* <span class="code-keyword">do</span> something */
        <span class="code-keyword">break</span>;
    <span class="code-keyword">case</span> 'OnWebPagePrerender':
        /* <span class="code-keyword">do</span> something <span class="code-keyword">else</span> */
        <span class="code-keyword">break</span>;
}
</pre>
</div>
</div>

<h2>
<a name="Plugins-PluginExamples"></a>Plugin Examples
</h2>

<p>
Plugins can be used for a variety of different applications, below are a couple of examples:
</p>

<h3>
<a name="Plugins-MessagetheUser%3A"></a>Message the User:
</h3>

<p>
<b>Description:</b> Send a custom message to the user as they create/edit a page... a custom header.
<br />
<b>System Events:</b> OnDocFormPrerender
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$modx-&gt;event-&gt;output('Hi there user!');
</pre>
</div>
</div>

<hr />

<h3>
<a name="Plugins-CustomValidation"></a>Custom Validation
</h3>

<p>
<b>Description:</b> Do some custom validation on saving a page resource
<br />
<b>System Events:</b> OnBeforeDocFormSave
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
<span class="code-comment">// Do some logical stuff.... <span class="code-keyword">if</span> validation failed:
</span>$modx-&gt;event-&gt;output('Something did not validate!');
<span class="code-keyword">return</span> <span class="code-quote">"This goes to the logs"</span>;
</pre>
</div>
</div>

<p>
The trick here is that what you want to message the user has to be passed to the <b>$modx-&gt;event-&gt;output()</b> function; any text you want to write to the logs can simply be returned by the plugin. If you pass validation, simply return null.
</p>

<div class='panelMacro'>
<table class='warningMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<b>No HTML Allowed</b>
<br />
The output you set in <b>$modx-&gt;event-&gt;output()</b> must not contain any HTML! Use plain text only! This is because the message is passed to the user via a Javascript modal window.
</td>
</tr>
</table>
</div>

<hr />

<h3>
<a name="Plugins-WordFilter"></a>Word Filter
</h3>

<p>
<b>Description:</b> Filter words from a document before it's displayed on the web
<br />
<b>System Events:</b> OnWebPagePrerender
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$words = array(<span class="code-quote">"snippet"</span>, <span class="code-quote">"template"</span>); <span class="code-comment">// words to filter
</span>$output = &amp;$modx-&gt;resource-&gt;_output; <span class="code-comment">// get a reference to the output
</span>$output = str_replace($words,<span class="code-quote">"&lt;b&gt;[filtered]&lt;/b&gt;"</span>,$output);

</pre>
</div>
</div>

<p>
<br class="atl-forced-newline" />
</p>

<hr />

<h3>
<a name="Plugins-PageNotFoundRedirector%3A"></a>Page-Not-Found Redirector:
</h3>

<p>
<b>Description:</b> Redirects a user to selected document and sends a message
<br />
<b>System Events:</b> OnPageNotFound
<br />
<b>System Settings:</b>
</p>

<ul>
<li>
<em>pnf.page</em>: Error Resource ID
</li>

<li>
<em>pnf.mailto</em>: Mail To Address
</li>

<li>
<em>pnf.mailfrom</em>: Mail From Address
</li>
</ul>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">if</span> ($modx-&gt;event-&gt;name == 'OnPageNotFound') {
     $errorPage = $modx-&gt;getOption('pnf.page');
     <span class="code-keyword">if</span> (empty($errorPage)) {
         $modx-&gt;sendErrorPage();
     } <span class="code-keyword">else</span> {
         $mailto = $modx-&gt;getOption('pnf.mailto');
         <span class="code-keyword">if</span> (!empty($mailto)) {
            <span class="code-comment">// send a message to a local account
</span>            $resourceId = $modx-&gt;resource-&gt;get('id');
            $subject = 'Page not found';
            $body = 'Someone tried to access document id '.$resourceId;
            $modx-&gt;getService('mail', 'mail.modPHPMailer');
            $modx-&gt;mail-&gt;set(modMail::MAIL_BODY, $body);
            $modx-&gt;mail-&gt;set(modMail::MAIL_FROM, '$modx-&gt;getOption('pnf.mailfrom'));
            $modx-&gt;mail-&gt;set(modMail::MAIL_FROM_NAME, 'MODx');
            $modx-&gt;mail-&gt;set(modMail::MAIL_SENDER, 'MODx');
            $modx-&gt;mail-&gt;set(modMail::MAIL_SUBJECT, $subject);
            $modx-&gt;mail-&gt;address('to',$mailto);
            $modx-&gt;mail-&gt;setHTML(<span class="code-keyword">true</span>);
            $modx-&gt;mail-&gt;send();
         }
         $url = $<span class="code-keyword">this</span>-&gt;makeUrl($scriptProperties['page']);
         $modx-&gt;sendRedirect($url, 1);
         exit;
    }
}
</pre>
</div>
</div>

<p>
<br class="atl-forced-newline" />
</p>

<h2>
<a name="Plugins-SeeAlso"></a>See Also
</h2>

<div class="plugin_pagetree">
<div style="margin-left: 2em" class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">
<div class="plugin_pagetree_children">
</div>
</div>

<fieldset class="hidden">
<input type="hidden" name="treeId" value="" /> <input type="hidden" name="treeRequestId" value="/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false" /> <input type="hidden" name="treePageId" value="18678226" /> <input type="hidden" name="noRoot" value="false" /> <input type="hidden" name="rootPageId" value="18678226" /> <input type="hidden" name="rootPage" value="" /> <input type="hidden" name="startDepth" value="0" /> <input type="hidden" name="spaceKey" value="revolution20" /> <input type="hidden" name="i18n-pagetree.loading" value="Loading..." /> <input type="hidden" name="i18n-pagetree.error.permission" value="Unable to load page tree. It seems that you do not have permission to view the root page." /> <input type="hidden" name="i18n-pagetree.eeror.general" value="There was a problem retrieving the page tree. Please check the server log file for more information." /> <input type="hidden" name="loginUrl" value="/login.action?os_destination=%2Fdisplay%2Frevolution20%2FPlugins" />
<fieldset class="hidden">
<input type="hidden" name="ancestorId" value="18678226" />
</fieldset>
</fieldset>
</div>