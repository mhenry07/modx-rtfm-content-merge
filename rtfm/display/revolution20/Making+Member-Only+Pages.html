<div>
<ul>
<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-Introduction">Introduction</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-AccessWizardexplanation%282.2.2andlater%29">Access Wizard explanation (2.2.2 and later)</a>
<ul>
<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-1.CreateaResourceGroup">1. Create a Resource Group</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-2.AddResourcestotheResourceGroup">2. Add Resources to the Resource Group</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-3.AddUserstotheUserGroup">3. Add Users to the User Group</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-4.AddContextAccesstotheUserGroup">4. Add Context Access to the User Group</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-5.FlushPermissions">5. Flush Permissions</a>
</li>
</ul>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-Stepbystepexplanation%28pre2.2.2%29">Step-by-step explanation (pre-2.2.2)</a>
<ul>
<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-1.CreateaResourceGroup">1. Create a Resource Group</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-2.LinkyourmemberonlyresourcetotheResourceGroup">2. Link your member-only resource to the Resource Group</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-3.CreateaUserGroup">3. Create a User Group</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-4.AddResourceGroupaccess">4. Add Resource Group access</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-5.Adduserstotheusergroup">5. Add users to the user group</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-6.Flushpermissions">6. Flush permissions</a>
</li>
</ul>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-Help%5C%21Ican%27tgetthistowork%2Cstill%5C%21">Help! I can't get this to work, still!</a>
</li>

<li>
<a href="revolution/2.x/administering-your-site/security/security-tutorials/making-member-only-pages#MakingMember-OnlyPages-SeeAlso">See Also</a>
</li>
</ul>
</div>

<h2 id="MakingMember-OnlyPages-Introduction">
Introduction
</h2>

<p>
MODX Revolution uses a whole new set of security systems to allow you more flexibility while giving your users access (or denying) to Manager and Web resources. As there seems to be need for a proper tutorial to get you into the basics of working with this advanced system this document has been written.
</p>

<p>
It's common to have pages in the front end of a site that can only be seen by certain users. This tutorial describes how to do that in MODX Revolution. It assumes that you already know how to let users register and log in using the components in the <a href="extras/revo/login" title="Login">Login</a> package. The process described below will have no effect on which resources users can see or edit in the MODX Manager.
</p>

<p>
For those that are savvy enough, below follows a simple list to help you through the maze or to remind you how it works. If you need more information and would like some examples, scroll down to the related subsection below.
</p>

<ol>
<li>Create a Resource Group (Security -&gt; Resource Groups -&gt; Create Resource Group)
</li>

<li>Link your member-only resource to the Resource Group. (By editing the resource, or by dragging them from the resource tree to the right)
</li>

<li>Create a User Group (Security -&gt; Access Controls -&gt; User Groups -&gt; New User Group)
</li>

<li>Add a resource group entry on the Resource Group Access tab (context: web, minimum role: Member (9999), access policy: Resource)
</li>

<li>Add users to the user group with the role of Member. (Security -&gt; Manage Users)
</li>

<li>Flush permissions (Security -&gt; Flush Permissions) and try it in another browser (not just another browser window: another browser)
</li>
</ol>

<h2 id="MakingMember-OnlyPages-AccessWizardexplanation(2.2.2andlater)">
Access Wizard explanation (2.2.2 and later)
</h2>

<p>
MODX 2.2.2 ships with an access wizard that simplifies this process. The step-by-step explanation is still valid, but the access wizard simplifies the process. You may wish to read both explanations to gain a better understanding of how each aspect of MODX's security system interacts.
</p>

<h3 id="MakingMember-OnlyPages-1.CreateaResourceGroup">
1. Create a Resource Group
</h3>

<p>
Go to Security -&gt; Resouce Groups and click the Create Resource Group. A window similar to this should pop up: <img src="download/attachments/18678352/create-resource-group.png?version=1&amp;modificationDate=1348848806000" style="border: 1px solid black" />
</p>

<p>
Let's go over each section:
</p>

<table>
<tbody>
<tr>
<th>
Section
</th>
<th>
Explanation
</th>
<th>
Tutorial Default
</th>
</tr>

<tr>
<td>
Name
</td>
<td>
This is the name of the resource group that we're generating. Make it descriptive and easy-to-remember.
</td>
<td>
Protected
</td>
</tr>

<tr>
<td>
Contexts
</td>
<td>
This is the context where you want the rules to apply. For this tutorial, we only have one context, "web", and we only want to hide things there.
</td>
<td>
web
</td>
</tr>

<tr>
<td>
Automatically give Administrator Group Access
</td>
<td>
Checking this box will give all users in the default administrator group access to the resource group. As of 2.2.1, the default admin user is marked as a "sudo" user and they can view all resource groups, regardless of whether the administrator group has access. However, if there are any other administrators that don't have sudo access and we want them to be able to view the resources in the resource group, we should check that box.
</td>
<td>
checked
</td>
</tr>

<tr>
<td>
Automatically give Anonymous Group Access
</td>
<td>
Checking this box will give all users in the anonymous user group access to the resource group. When someone comes to your website and they're not logged into anywhere, they're considered in the anonymous user group. We want to protect our pages from users who aren't logged in, so let's leave this box unchecked for this tutorial.
</td>
<td>
unchecked
</td>
</tr>

<tr>
<td>
Create Parallel User Group
</td>
<td>
You may not wish to have everyone who can view the member-only pages be in the administrator group (if you've checked the "Automatically give Administrator Group Access" option). In this case, you can create another user group that has access to the resources in this resource group. Let's check that, as our members aren't administrators.
</td>
<td>
checked
</td>
</tr>

<tr>
<td>
Automatically Give Other User Groups Access
</td>
<td>
If you have any other user groups that you've defined previously to this tutorial to whom you want to give access, you can list them here.
</td>
<td>
&nbsp;
</td>
</tr>
</tbody>
</table>

<p>
Great! We have a resource group and a user group created. We now need to add resources to the resource group and users to that user group and then we'll be laughing.
</p>

<h3 id="MakingMember-OnlyPages-2.AddResourcestotheResourceGroup">
2. Add Resources to the Resource Group
</h3>

<p>
We need to tell MODX with resource we want to protect. Let's stay on the same page from Step 1 (Security &gt; Resource Groups). On the right, open up the web context to see all the pages on your site. Drag them from the column on the right into your resource group. Easy, right? An alternative is to go into each resource, go to the Resource Groups tab, and check the checkbox under the "Acces" column and the "Protected" row.
</p>

<h3 id="MakingMember-OnlyPages-3.AddUserstotheUserGroup">
3. Add Users to the User Group
</h3>

<p>
Okay, we've had enough of the Resource Group page. Go to Security &gt; Access Controls. In the Users Groups tab, we can see a list of all of the user groups on our site. Right click on the "Protected" User group. Select "Add User to Group". For the "Name", select the user you want in the user group. For the Role, let's select "Member" for now. Roles define what an individual user can do within a user group, but we don't need that fine of control for this tutorial. Click Save.
</p>

<div class="info">
It is important to realize that as soon as you have protected a resource by (1) assigning it to one or more resource groups and (2) linking the resource group to a user group using an access control, those pages will no longer show up for users that are not linked to the resource group. The default behavior in that case is displaying the 404-error page. If you would rather return the 401-error, you will need to give the anonymous user group "load" permission for the resource group. More about this in a later tutorial. At this moment in the tutorial, your page will not be visible as you have not yet added it to a user group.
</div>

<p>
We now have our resources in a resource group, and users in a user group. Done? Sorry, we have a few small things to do first. If you're following this tutorial and this is your first foray into MODX security, you will likely run into a small but important snag: the user group we created doesn't have context access to our front end context, web. In other words, if we could view that context, we could view those protected resources -- but we can't currently view that context. Let's give our user group permission to view that context.
</p>

<h3 id="MakingMember-OnlyPages-4.AddContextAccesstotheUserGroup">
4. Add Context Access to the User Group
</h3>

<p>
Go to Security &gt; Access Controls. Right click on the protected user group. Select "Update user group". Go to the Context Access tab. Click "Add Context". We are presented with a dialog such as the one below. Let's break it down: <img src="download/attachments/18678352/context-access.png?version=1&amp;modificationDate=1348853336000" style="border: 1px solid black" />
</p>

<table>
<tbody>
<tr>
<th>
Section
</th>
<th>
Explanation
</th>
<th>
Tutorial Default
</th>
</tr>

<tr>
<td>
Context
</td>
<td>
This specifies to which context we're giving access. The basic use case will have web and mgr. Web is the public front-end of your website, and mgr is the private back-end of your website (i.e., the manager that you're logged in).
</td>
<td>
web
</td>
</tr>

<tr>
<td>
Minimum Role
</td>
<td>
This specifies what user roles this rule will apply to. If we want all users in this user group, select "Member - 9999". This is where some of that fine control comes in that we talked about earlier.
</td>
<td>
Member - 9999
</td>
</tr>

<tr>
<td>
Access Policy
</td>
<td>
This specifies what permissions we're giving to the users. Different policies will allow user groups to do different things.
</td>
<td>
Administrator
</td>
</tr>
</tbody>
</table>

<p>
Let's make one rule with "web", "Member - 9999", and "Load, List and View". If we want users to be able to view the MODX manager, we can add a second rule to give them access to the mgr context: "mgr", "Member - 9999", and "Administrator". All these users will have admin access. If you would prefer to limit their permissions, you could instead choose "Content Editor" or "Developer" for their access policies. Alternatively, you can make your own in Security &gt; Access Policies if you want to be specific about what users can or can't do.
</p>

<p>
We now have users in a user group, resources in a resource group, and that user group can view the context. We're so close!
</p>

<h3 id="MakingMember-OnlyPages-5.FlushPermissions">
5. Flush Permissions
</h3>

<p>
Before you can see a change, you need to reset / flush what your individual users can see and do. Go to Security &gt; Flush Permissions. To test this in the front end, you must use a different browser. 90% of your grief will come from not testing in a different browser or flushing your permissions, so don't be lazy and open that second browser up. Congratulations, you now have members-only pages!
</p>

<div class="info">
In some cases you may need to clear the site cache, specifically for the mgr (manager) context as elements and resources may cache their permissions.
</div>

<h2 id="MakingMember-OnlyPages-Stepbystepexplanation(pre2.2.2)">
Step-by-step explanation (pre-2.2.2)
</h2>

<p>
If you're not quite as savvy, or would rather also know what happens when you set a certain permission or make an access entry, you might find this section interesting. As of 2.2.2, MODX ships with an Access Wizard and you might wish to start with that.
</p>

<h3 id="MakingMember-OnlyPages-1.CreateaResourceGroup">
1. Create a Resource Group
</h3>

<p>
A <a href="revolution/2.x/administering-your-site/security/resource-groups" title="Resource Groups">Resource Group</a> is a collection of resources which you can link to user groups and access list entries. When you have created a resource group, you can easily classify pages to be only visible for certain user groups, or roles within user groups.
</p>

<p>
To create a resource group, navigate to Security -&gt; Resource Groups and click on the Create Resource Group button. In the popup you are prompted to enter a name for the resource group. In the tutorial we expect you named it "Protected".
</p>

<h3 id="MakingMember-OnlyPages-2.LinkyourmemberonlyresourcetotheResourceGroup">
2. Link your member-only resource to the Resource Group
</h3>

<p>
Now that you have a resource group, you should add resources to it. There are two ways to achieve this.
</p>

<p>
First of all, you can go to Security -&gt; Resource Groups and drag resources from the right resource tree to the left resource groups ("Protected"). The second option is editing your resource, and ticking the right box on the "Access Permissions" tab.
</p>

<h3 id="MakingMember-OnlyPages-3.CreateaUserGroup">
3. Create a User Group
</h3>

<p>
You have a resource group with resource applied to them, now you'll need to decide who will be able to view the resources. For this, we'll make a new user group.
</p>

<p>
To do this, go to Security -&gt; Access Controls. On the (default) User Groups tab, click on the New User Group button. Choose a name for the group, and submit the form.
</p>

<h3 id="MakingMember-OnlyPages-4.AddResourceGroupaccess">
4. Add Resource Group access
</h3>

<p>
Move on to the "Resource Group Access" tab. This tab defines the resource groups your user group has access to. Three out of four fields are similar to the Context Access groups, namely the Context, Minimum Role and Access Policy. A new one is Resource Group which, as you probably guessed, defines the resource group the user group can access.
</p>

<p>
The settings:
</p>

<ul>
<li>Resource Group: whatever you named it, for example "Protected"
</li>

<li>Context: web
</li>

<li>Minimum role: Member (9999)
</li>

<li>Access Policy: Resource
</li>
</ul>

<div class="info">
It is important to realize that as soon as you have protected a resource by (1) assigning it to one or more resource groups and (2) linking the resource group to a user group using an access control, those pages will no longer show up for users that are not linked to the resource group. The default behavior in that case is displaying the 404-error page. If you would rather return the 401-error, you will need to give the anonymous user group "load" permission for the resource group. More about this in a later tutorial. At this moment in the tutorial, your page will not be visible as you have not yet added it to a user group.
</div>

<h3 id="MakingMember-OnlyPages-5.Adduserstotheusergroup">
5. Add users to the user group
</h3>

<p>
Now add some users to the user group. You can do this by editing the user, or by going back to the Users tab and adding them from there. It will ask for the User Group, as well as the Role. As we assumed the Member role with an authority of 9999, you can simply use that one.
</p>

<p>
When using a websignup snippet, make sure it automatically puts them in the right user group.
</p>

<h3 id="MakingMember-OnlyPages-6.Flushpermissions">
6. Flush permissions
</h3>

<p>
Now that all settings are done, you will need to flush permissions (Security -&gt; Flush Permissions) before you will see an effect. Also make sure that, if you go to test it front-end, you use a different browser all together. Don't use a different tab or browser window, as it will still use your Manager login to check for permissions.
</p>

<div class="info">
Please note that in some cases it is also necessary to clear the site cache, specifically for the mgr (manager) context, as elements and resources may cache their permissions.
</div>

<h2 id="MakingMember-OnlyPages-Help\!Ican'tgetthistowork,still\!">
Help! I can't get this to work, still!
</h2>

<p>
Make sure you followed everything step by step and that you flushed permissions properly. If everything seems to be alright, check again and then go to the Forums to ask for help. If you think the tutorial is misleading or inaccurate, please visit the forum topic (linked below) and post about what is incorrect so it can be fixed.
</p>

<h2 id="MakingMember-OnlyPages-SeeAlso">
See Also
</h2>

<p>
Bob's permissions guide: <a href="http://bobsguides.com/revolution-permissions.html">http://bobsguides.com/revolution-permissions.html</a>
</p>

<p>
Forum topic discussing this tutorial: <a href="http://modxcms.com/forums/index.php/topic,51259.0.html">http://modxcms.com/forums/index.php/topic,51259.0.html</a>
</p>

<p>
Using the Login Snippet to set up a basic "Members Only" area: <a href="extras/revo/login/login.tutorials/login.basic-setup" title="Login.Basic Setup">Login.Basic Setup</a>
</p>

<p>
Security: <a href="revolution/2.x/administering-your-site/security" title="Security">Security</a>
</p>