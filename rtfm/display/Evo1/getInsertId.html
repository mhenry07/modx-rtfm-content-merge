<h1>
<a name="getInsertId-API%3ADB%3AgetInsertId"></a>API:DB:getInsertId
</h1>

<div class="info">
<b>API Quick reference</b>
<br />

<div class='table-wrap'>
<table class='confluenceTable'>
<tbody>
<tr>
<td class='confluenceTd'>
Variable name:
</td>
<td class='confluenceTd'>
getInsertId
</td>
</tr>

<tr>
<td class='confluenceTd'>
Modx versions:
</td>
<td class='confluenceTd'>
0.9.x + Evolution
</td>
</tr>

<tr>
<td class='confluenceTd'>
Input parameters:
</td>
<td class='confluenceTd'>
([resource conn_identifier])
</td>
</tr>

<tr>
<td class='confluenceTd'>
Return if successful:
</td>
<td class='confluenceTd'>
AUTO_INCREMENT value from the last INSERT query.
</td>
</tr>

<tr>
<td class='confluenceTd'>
Return type:
</td>
<td class='confluenceTd'>
int
</td>
</tr>

<tr>
<td class='confluenceTd'>
Return on failure:
</td>
<td class='confluenceTd'>
0 or false (see below)
</td>
</tr>

<tr>
<td class='confluenceTd'>
Object parent:
</td>
<td class='confluenceTd'>
<a href="display/Evo1/DocumentParser+Object" title="DocumentParser Object">DocumentParser</a> -&gt; <a href="display/Evo1/DBAPI" title="DBAPI">DBAPI</a>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<h2>
<a name="getInsertId-Description" id="getInsertId-Description"></a>Description
</h2>

<pre class="brush: php">
    $newId = $modx-&gt;db-&gt;getInsertId();
    
</pre>
<h2>
<a name="getInsertId-Examples" id="getInsertId-Examples"></a>Examples
</h2>

<p>
This example function is passed two parameters: $fields and $table. The function checks that $fields is an array, and if so it proceeds to insert the data into the database and return the AUTO_INCREMENT value. If the query fals, or if $fields is not an array, it returns false.
</p>

<pre class="brush: php">
    $email = checkMail($_POST['email']);
$pass = makePass();
$sql = "INSERT INTO ".$modx-&gt;getFullTableName('web_users')." (username,password) VALUES ('".$email."', '".$pass."')";
$rs = $modx-&gt;db-&gt;query($sql);
$id = $modx-&gt;db-&gt;getInsertId();
$sql = "INSERT INTO ".$modx-&gt;getFullTableName('web_user_attributes')." (internalKey,email) VALUES (".$id.",'".$email."')";
$rs = $modx-&gt;db-&gt;query($sql);
    
</pre>
<p>
In this case, we've used a simple registration form to get the email of a new member. First the returned POST value is checked through a function. A password is automatically generated with another function. These values are used as the username and password, and inserted into the web_users table. The automatically generated ID for this new member is retrieved with the getInsertId function. The new member's ID is now used to insert the user's email into the web_user_attributes table.
</p>

<p>
This same value can then be used to insert the new member into a desired web group. This would be useful for registering a member to receive a newsletter, for example.
</p>

<h2>
<a name="getInsertId-Related" id="getInsertId-Related"></a>Related
</h2>

<p>
<span class="error">[$modx-&gt;db-&gt;insert]</span>()
</p>

<h2>
<a name="getInsertId-Notes" id="getInsertId-Notes"></a>Notes
</h2>

<p>
It's worth noting that mysql_insert_id() (used by $modx-&gt;db-&gt;getInsertId()) returns an integer, so if you have a value larger than that (for example, a BIGINT), the value returned will be incorrect. In this case, you should use the last_insert_id() function instead.
</p>

<h2>
<a name="getInsertId-FunctionSource" id="getInsertId-FunctionSource"></a>Function Source
</h2>

<p>
File: manager/includes/extenders/dbapi.mysql.class.inc.php
<br />
Line: 236
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
function getInsertId($conn=NULL) {
      <span class="code-keyword">if</span>(!is_resource($conn)) { $conn = $<span class="code-keyword">this</span>-&gt;conn; }
      <span class="code-keyword">return</span> mysql_insert_id($conn);
   }
</pre>
</div>
</div>