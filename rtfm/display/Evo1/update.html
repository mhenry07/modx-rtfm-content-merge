<h1>
<a name="update-API%3ADB%3Aupdate"></a>API:DB:update
</h1>

<div class='panelMacro'>
<table class='infoMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<b>API Quick reference</b>
<br />

<div class='table-wrap'>
<table class='confluenceTable'>
<tbody>
<tr>
<td class='confluenceTd'>
Variable name:
</td>
<td class='confluenceTd'>
update
</td>
</tr>

<tr>
<td class='confluenceTd'>
Modx versions:
</td>
<td class='confluenceTd'>
0.9.x + Evolution
</td>
</tr>

<tr>
<td class='confluenceTd'>
Input parameters:
</td>
<td class='confluenceTd'>
(String $fields, String $table, String $where)
</td>
</tr>

<tr>
<td class='confluenceTd'>
Return if successful:
</td>
<td class='confluenceTd'>
true
</td>
</tr>

<tr>
<td class='confluenceTd'>
Return type:
</td>
<td class='confluenceTd'>
bool
</td>
</tr>

<tr>
<td class='confluenceTd'>
Return on failure:
</td>
<td class='confluenceTd'>
false
</td>
</tr>

<tr>
<td class='confluenceTd'>
Object parent:
</td>
<td class='confluenceTd'>
<a href="/display/Evo1/DocumentParser+Object" title="DocumentParser Object">DocumentParser</a> -&gt; <a href="/display/Evo1/DBAPI" title="DBAPI">DBAPI</a>
</td>
</tr>
</tbody>
</table>
</div>
</td>
</tr>
</table>
</div>

<h2>
<a name="update-Description"></a>Description
</h2>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
<span class="code-object">boolean</span> update(<span class="code-object">String</span> $fields, <span class="code-object">String</span> $table, <span class="code-object">String</span> $where)
</pre>
</div>
</div>

<p>
Updating a value or a group of values in a table is very easy using the DBAPI update function.
</p>

<p>
This function allows you to update fields in a MySQL database. $fields may be either a simple String, if you're only updating one field in a table, or an associative array consisting of field =&gt; new_value to update multiple fields. The $table argument is the actual table in the database you're going to be updating, and if this is empty, the function will return false. The $where argument is the condition under which the table should be updated, and if it's left blank it will update all rows in the table. On failure, this function returns false, and on success, it returns true.
</p>

<h2>
<a name="update-Usage"></a>Usage
</h2>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$rows_affected = $modx-&gt;db-&gt;update(<span class="code-quote">"fields"</span>, <span class="code-quote">"table_name"</span> [, <span class="code-quote">"where value"</span>]);
</pre>
</div>
</div>

<p>
<b>The "fields" argument</b>
</p>

<p>
The "fields" argument can be an (associative) array if more than one field is to be updated. ie:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$fields = array(
     <span class="code-quote">"field1"</span> =&gt; 1,
     <span class="code-quote">"field2"</span> =&gt; 2,
     <span class="code-quote">"field3"</span> =&gt; <span class="code-quote">"three"</span>
     )
$rows_affected = $modx-&gt;db-&gt;update($fields, <span class="code-quote">"table_name"</span>, <span class="code-quote">"where value"</span>);
</pre>
</div>
</div>

<p>
Otherwise, it can simply be the field and value you want to update:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$rows_affected = $modx-&gt;db-&gt;update(<span class="code-quote">"field=value"</span> <span class="code-quote">"table_name"</span>, <span class="code-quote">"where value"</span>);
</pre>
</div>
</div>

<p>
<b>The "table" argument</b>
</p>

<p>
The "table" argument is the table to update. You can use the MODx function to return the full tablename; this is probably the best way, since you won't have to remember to include the prefix of the table names for your site:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$table_name = $modx-&gt;getFullTableName(<span class="code-quote">"table"</span>);
$rows_affected = $modx-&gt;db-&gt;update($fields, $table_name, <span class="code-quote">"where value"</span>);
The <span class="code-quote">"where"</span> argument
</pre>
</div>
</div>

<p>
The "where" argument tells the database the specific record to update:
<br />
$rows_affected = $modx-&gt;db-&gt;update($fields, "table_name", "field = value");
</p>

<h2>
<a name="update-Examples"></a>Examples
</h2>

<p>
The following function takes an id and username as parameters and updates the database with a new username, based on the id passed to the function:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
function update_username( $id, $username ) {
        global $modx;
        $table = $modx-&gt;getFullTableName( 'user_table' );
        
        $result = $modx-&gt;db-&gt;update( 'username = <span class="code-quote">"' . $username . '"</span>', $table, 'userid = <span class="code-quote">"' . $id . '"</span>' );
        <span class="code-keyword">return</span> $result;               <span class="code-comment">// Returns '<span class="code-keyword">true</span>' on success, '<span class="code-keyword">false</span>' on failure.
</span>}
</pre>
</div>
</div>

<p>
This snippet uses an array to update multiple fields in a database:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$table = $modx-&gt;getFullTableName( 'cars_table' );
$fields = array('make'  =&gt; $new_make,
                'model' =&gt; $new_model,
                'color' =&gt; $new_color,
                'year'  =&gt; $new_year,
                'updated'=&gt; time()
                );
$result = $modx-&gt;db-&gt;update( $fields, $table, 'id = <span class="code-quote">"' . $id . '"</span>' );
<span class="code-keyword">if</span>( $result ) {
        echo 'Table updated.';
}
<span class="code-keyword">else</span> {
        echo 'Query Failed!';
}
</pre>
</div>
</div>

<p>
<b>Example 3</b>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$table = $modx-&gt;getFullTableName(<span class="code-quote">"site_content"</span>);
$fields = array(
     <span class="code-quote">"pagetitle"</span> =&gt; <span class="code-quote">"New Title"</span>,
     <span class="code-quote">"alias"</span> =&gt; <span class="code-quote">"<span class="code-keyword">new</span>-alias"</span>,
     <span class="code-quote">"menuindex"</span> =&gt; 2,
     <span class="code-quote">"published"</span> =&gt; 1
     )
$rows_affected = $modx-&gt;db-&gt;update($fields, $table, <span class="code-quote">"id = 45"</span>);
</pre>
</div>
</div>

<p>
will change document 45's title to "New Title", its alias to "new-alias", make it the second item in the menu, and publish it.
</p>

<p>
<b>Example 4</b>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$table = $modx-&gt;getFullTableName(<span class="code-quote">"system_settings"</span>);
$rows_affected = $modx-&gt;db-&gt;update(<span class="code-quote">"setting_value = '5'"</span>, $table, <span class="code-quote">"setting_name='default_template'"</span>);
</pre>
</div>
</div>

<p>
will change the site's default template to template 5.
</p>

<h2>
<a name="update-Related"></a>Related
</h2>

<p>
<a href="/display/Evo1/query" title="query">query</a>(), <span class="error">[getAffectedRows]</span>(), <a href="/display/Evo1/escape" title="escape">escape</a>()
</p>

<h2>
<a name="update-Notes"></a>Notes
</h2>

<p>
It's important to note that, if taking any user-inputted data (ie. via a $_GET request), you should always first sanitize the data before using it in a MySQL query. Using the <a href="/display/Evo1/escape" title="escape">$modx-&gt;db-&gt;escape</a>() function will escape all potentially harmful characters that could be used to inject an arbitrary command.
</p>

<h2>
<a name="update-FunctionSource"></a>Function Source
</h2>

<p>
File: manager/includes/extenders/dbapi.class.inc.php
<br />
Line: 185
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
function update($fields, $table, $where = "") {
      <span class="code-keyword">if</span> (!$table)
         <span class="code-keyword">return</span> <span class="code-keyword">false</span>;
      <span class="code-keyword">else</span> {
         <span class="code-keyword">if</span> (!is_array($fields))
            $flds = $fields;
         <span class="code-keyword">else</span> {
            $flds = '';
            foreach ($fields as $key =&gt; $value) {
               <span class="code-keyword">if</span> (!empty ($flds))
                  $flds .= <span class="code-quote">","</span>;
               $flds .= $key . <span class="code-quote">"="</span>;
               $flds .= <span class="code-quote">"'"</span> . $value . <span class="code-quote">"'"</span>;
            }
         }
         $where = ($where != <span class="code-quote">"") ? "</span>WHERE $where<span class="code-quote">" : "</span>";
         <span class="code-keyword">return</span> $<span class="code-keyword">this</span>-&gt;query(<span class="code-quote">"UPDATE $table SET $flds $where"</span>);
      }
   }
</pre>
</div>
</div>