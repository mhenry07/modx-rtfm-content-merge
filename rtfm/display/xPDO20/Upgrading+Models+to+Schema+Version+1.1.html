<div>
<ul>
<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/defining-the-database-and-tables/upgrading-models-to-schema-version-1.1#UpgradingModelstoSchemaVersion1.1-UpgradingModelsfromSchemaVersion1.0to1.1">Upgrading Models from Schema Version 1.0 to 1.1</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/defining-the-database-and-tables/upgrading-models-to-schema-version-1.1#UpgradingModelstoSchemaVersion1.1-xpdo%2Ftools%2Fschema%2Fupgrademysql1.1.php">xpdo/tools/schema/upgrade-mysql-1.1.php</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/defining-the-database-and-tables/upgrading-models-to-schema-version-1.1#UpgradingModelstoSchemaVersion1.1-Usage">Usage</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/defining-the-database-and-tables/upgrading-models-to-schema-version-1.1#UpgradingModelstoSchemaVersion1.1-RunningasCLIscript">Running as CLI script</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/defining-the-database-and-tables/upgrading-models-to-schema-version-1.1#UpgradingModelstoSchemaVersion1.1-Runningaswebrequest">Running as web request</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h2>
<a name="UpgradingModelstoSchemaVersion1.1-UpgradingModelsfromSchemaVersion1.0to1.1" id="UpgradingModelstoSchemaVersion1.1-UpgradingModelsfromSchemaVersion1.0to1.1"></a>Upgrading Models from Schema Version 1.0 to 1.1
</h2>

<p>
In xPDO 2.0.0-rc3, a new schema element for describing table indexes was added to the <tt>object</tt> element of the xPDO schema. To maintain backwards compatibility in the runtime code with older schemas, where the indexes were described using the <em>index</em> and <em>index_group</em> attributes of the <tt>field</tt> elements, schemas created with this new element must be differentiated from the older schemas. As a result, the <em>version</em> attribute was added to the <tt>model</tt> element with a value of 1.1. All legacy models without the version element are assumed to be version 1.0.
</p>

<p>
To make conversion of existing mysql models easier, a tool is provided in xPDO that can be executed from the command line or a browser.
</p>

<h3>
<a name="UpgradingModelstoSchemaVersion1.1-xpdo%2Ftools%2Fschema%2Fupgrademysql1.1.php"></a>xpdo/tools/schema/upgrade-mysql-1.1.php
</h3>

<p>
This simple tool takes a few arguments and automatically converts your 1.0 model's index definitions to the 1.1 format and adds version="1.1" to the <tt>model</tt> element.
</p>

<ul>
<li>Required Arguments
<ul>
<li>
<b>pkg</b> — The name of the model package being converted.
</li>

<li>
<b>pkg_path</b> — The root path of the model package.
</li>

<li>
<b>schema_name</b> — The xPDO schema filename to convert.
</li>

<li>
<b>schema_path</b> — The path to the schema file.
</li>
</ul>
</li>
</ul>

<ul>
<li>Optional Arguments
<ul>
<li>
<b>backup_path</b> — The path to write the backup schema file. If not specified, the backup is written to the same directory (schema_path).
</li>

<li>
<b>backup_prefix</b> — A string to prepend to the backup schema file. Default is '~'.
</li>

<li>
<b>dsn</b> — A valid PDO DSN connection string.
</li>

<li>
<b>dbuser</b> — A valid database user with access to the specified DSN.
</li>

<li>
<b>dbpass</b> — The password for the specified dbuser.
</li>

<li>
<b>regen</b> — If true, will regenerate the model after the schema is updated.
</li>

<li>
<b>write</b> — If true, will write the updated schema to file and backup the original.
</li>

<li>
<b>echo</b> — If true, will echo the updated schema to STDOUT.
</li>

<li>
<b>debug</b> — Sets the debug level of xPDO; if true, <b>echo</b> is automatically set true.
</li>

<li>
<b>include</b> — An external properties file to include arguments from.
</li>

<li>
<b>error_reporting</b> — Set the PHP error_reporting level for the script. Default is -1 (does not report errors).
</li>

<li>
<b>display_errors</b> — Set the PHP display_errors setting. Default is true.
</li>
</ul>
</li>
</ul>

<div class="note">
<b>Argument Rules</b>
<br />

<ul>
<li>At least one of the four arguments, <b>echo</b>, <b>write</b>, <b>regen</b>, or <b>debug</b>, must be set.
</li>

<li>The <b>write</b> argument cannot be used when the <b>debug</b> argument is true.
</li>

<li>
<b>regen</b> can only be used when <b>write</b> is set or the schema is already at version 1.1.
</li>
</ul>
</div>

<h3>
<a name="UpgradingModelstoSchemaVersion1.1-Usage" id="UpgradingModelstoSchemaVersion1.1-Usage"></a>Usage
</h3>

<div class="tip">
<b>realpath() used on path arguments</b>
<br />
All values for _path arguments (and the include argument) are passed through realpath().
</div>

<h4>
<a name="UpgradingModelstoSchemaVersion1.1-RunningasCLIscript" id="UpgradingModelstoSchemaVersion1.1-RunningasCLIscript"></a>Running as CLI script
</h4>

<p>
CLI arguments for the script are specified in the format:
</p>

<pre class="brush: php">
    
user@hostname:/home/user/xpdo$ php xpdo/tools/schema/upgrade-mysql-1.1.php --pkg=sample --pkg_path=models/ --schema_name=sample.mysql.schema.xml --schema_path=schemas/ --echo --write --regen

    
</pre>
<p>
Alternatively, you can use the include argument to set properties from an external file.
</p>

<p>
An example properties file, <tt>sample.schema.properties.php</tt>:
</p>

<pre class="brush: php">
    
user@hostname:/home/user/xpdo$ php xpdo/tools/schema/upgrade-mysql-1.1.php --include=sample.schema.properties.php

    
</pre>
<div class="note">
<b>CLI arguments override properties file</b>
<br />
Please note that any arguments provided in the CLI call will override values set in and included from the properties file.
</div>

<h4>
<a name="UpgradingModelstoSchemaVersion1.1-Runningaswebrequest" id="UpgradingModelstoSchemaVersion1.1-Runningaswebrequest"></a>Running as web request
</h4>

<p>
You can also execute the script as a web request, passing the arguments as $_REQUEST variables, $_GET, $_POST, or $_COOKIE. An example URL for such a call might look like this:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
http:<span class="code-comment">//localhost/food/xpdo/tools/schema/upgrade-mysql-1.1.php?pkg=sample&amp;pkg_path=models/&amp;schema_name=sample.mysql.schema.xml&amp;schema_path=schemas/&amp;echo=<span class="code-keyword">true</span>&amp;write=<span class="code-keyword">true</span>&amp;regen=<span class="code-keyword">true</span></span>
</pre>
</div>
</div>

<div class="tip">
<b>boolean arguments</b>
<br />
To set a boolean value of true, make sure you pass the string 'true', otherwise the value is assumed to be boolean false.
</div>