<div>
<ul>
<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-Goal">Goal</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-OnetoOne">One to One</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions">MySQL Table Definitions</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema">XML Schema</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode">Sample Snippet Code</a>
</li>
</ul>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-OnetoMany">One to Many</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions">MySQL Table Definitions</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema">XML Schema</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode">Sample Snippet Code</a>
</li>
</ul>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-ManytoMany%3AJoiningTables">Many to Many: Joining Tables</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions">MySQL Table Definitions</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema">XML Schema</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode">Sample Snippet Code</a>
</li>
</ul>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-ParentID%3ASelfJoin">Parent ID: Self Join</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions">MySQL Table Definitions</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema">XML Schema</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode">Sample Snippet Code</a>
</li>
</ul>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-UsingFieldAliases%28xPDO2.2%5Conly%29">Using Field Aliases <em>(xPDO 2.2+ only)</em></a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema">XML Schema</a>
</li>

<li>
<a href="xpdo/2.x/getting-started/creating-a-model-with-xpdo/defining-a-schema/more-examples-of-xpdo-xml-schema-files#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode">Sample Snippet Code</a>
</li>
</ul>
</li>
</ul>
</div>

<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-Goal" id="MoreExamplesofxPDOXMLSchemaFiles-Goal"></a>Goal
</h2>

<p>
This page contains examples that juxtapose MySQL database tables with their xPDO XML schema counterparts in order to teach developers how to define the foreign-key relationships between tables in xPDO XML schemas by using a series of common database relational patterns as examples.
</p>

<p>
Database relations can be complex, so it's no surprise that the XML schema files that describe those relations reflect that complexity. Although xPDO schema files <em>already</em> exist for built-in MODx tables inside of <b>core/model/schema/modx.mysql.schema.xml</b>, we don't recommend that developers rely on those XML files as their only examples of how to relate tables because they are often too complex to be used for educational purposes.
</p>

<p>
Remember that xPDO <em>abstracts</em> the database, so it's entirely possible that your model is something other than a traditional database, but for the sake of familiarity and clarity, the examples here assume you are using a MySQL database for your model. In general, it's recommended that you design your snippets/plugins etc. using a traditional database before abstracting it using xPDO.
</p>

<div class="note">
<b>FYI</b>
<br />
Once you've created a valid XML schema file, xPDO can generate PHP class files <em>and</em> database tables; it is bi-directional. The purpose of this page is to juxtapose the xPDO XML schema to MySQL database tables. Some developers may prefer to write the XML schema file by hand and then let xPDO generate the tables and the class files. Other developers may prefer to first create the database tables, then <a href="display/revolution20/Reverse+Engineer+xPDO+Classes+from+Existing+Database+Table" title="Reverse Engineer xPDO Classes from Existing Database Table">reverse engineer</a> the XML schema and the class files.
</div>

<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-OnetoOne" id="MoreExamplesofxPDOXMLSchemaFiles-OnetoOne"></a>One to One
</h2>

<p>
A one-to-one relationship exists when two tables use the same primary key. Architecturally, this means that the data could theoretically live in a single table, but for whatever reason, the data is separated into two (or more) tables.
</p>

<p>
The tricky thing about one-to-one relationships is that both tables are <em>not</em> equal. Like the movie Highlander, there can be only one primary table: you must decide which table is the primary (or master) table, and which is the secondary (or slave) table.
</p>

<p>
A good example of this type of relationship exists in the MODx database between the <b>users</b> and the <b>user_attributes</b> tables: the <b>users</b> table is the primary table, and the <b>user_attributes</b> is the secondary table. If you delete a user from the <b>users</b> table, the extra attributes in the <b>user_attributes</b> table should also be deleted, but the opposite is not necessarily true. The documentation on <a href="display/xPDO20/Defining+Relationships" title="Defining Relationships">relationships</a> stresses this primary/secondary relationship.
</p>

<p>
When defining relationships, you must first learn about <b>aggregate</b> and <b>composite</b> relationships; you may not understand the usage of these particular words, but when defining this type of relationship, simply remember the following:
</p>

<ul>
<li>The primary table's XML definition lists a <b><em>composite</em></b> relationship to the the secondary table.
</li>

<li>The secondary table's XML definition lists an <b><em>aggregate</em></b> relationship to the primary table.
</li>
</ul>

<p>
For this example, we are mimicking the MODx tables where we have one table for <b>users</b> and a secondary table that stores additional information about those users, named <b>userdata</b>.
</p>

<div class="note">
<b>FYI</b>
<br />
Unlike some ORMs (e.g. Doctrine) and even unlike MySQL's foreign-key definitions, xPDO defines a relationship on <em>both</em> sides. You tell the children who their parents are and you also tell the parents who their children are. E.g. the parent object contains a composite relationship and the child object contains an aggregate relationship. This ensures that everybody knows who they're related to.
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions" id="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions"></a>MySQL Table Definitions
</h3>

<p>
Here are abbreviated MySQL table definitions:
</p>

<pre class="brush: php">
    SELECT users.*, userdata.*
FROM users JOIN userdata ON users.user_id = userdata.userdata_id;

    
</pre>
<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-XMLSchema" id="MoreExamplesofxPDOXMLSchemaFiles-XMLSchema"></a>XML Schema
</h3>

<p>
And here's the corresponding XML definitions:
</p>

<pre class="brush: php">
    &lt;?php
        $base_path = MODX_CORE_PATH . 'components/one_to_one/';
        $modx-&gt;addPackage('one_to_one',$base_path.'model/','');
        $user = $modx-&gt;getObject('Users', array('user_id' =&gt; 1 ) );
        $userdata = $user-&gt;getOne('Userdata');
        $output = '';
        $output .= $user-&gt;get('username');
        $output .= $userdata-&gt;get('age');
        return $output;
?&gt;

    
</pre>
<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-OnetoMany" id="MoreExamplesofxPDOXMLSchemaFiles-OnetoMany"></a>One to Many
</h2>

<p>
This is a common pattern that occurs when a secondary table contains a foreign key. For example, you might have a primary table containing blog posts, and a secondary table containing comments. Each blog post might have zero or many comments, but each comment can belong to one and <em>only</em> one blog post.
</p>

<p>
This is the same type of relationship that exists in MODx between pages and templates: a single template might be used by hundreds of pages, but a page can only use a single template.
</p>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions" id="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions"></a>MySQL Table Definitions
</h3>

<pre class="brush: php">
    &lt;object class="Blogposts" table="blogposts" extends="xPDOObject"&gt;
        &lt;field key="blogpost_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" /&gt;
        &lt;field key="content" dbtype="text" phptype="string" null="true" /&gt;
        &lt;index alias="PRIMARY" name="PRIMARY" primary="true" unique="true"&gt;
                &lt;column key="blogpost_id" collation="A" null="false" /&gt;
        &lt;/index&gt;
        &lt;composite alias="Comments" class="Comments" local="blogpost_id" foreign="blogpost" cardinality="many" owner="local" /&gt;
&lt;/object&gt;

&lt;object class="Comments" table="comments" extends="xPDOObject"&gt;
        &lt;field key="comment_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" /&gt;
        &lt;field key="blogpost" dbtype="int" precision="11" phptype="integer" null="true" /&gt;
        &lt;field key="comment" dbtype="text" phptype="string" null="true" /&gt;
        &lt;index alias="PRIMARY" name="PRIMARY" primary="true" unique="true"&gt;
                &lt;column key="comment_id" collation="A" null="false" /&gt;
        &lt;/index&gt;
        &lt;aggregate alias="Blogposts" class="Blogposts" local="blogpost" foreign="blogpost_id" cardinality="one" owner="foreign" /&gt;
&lt;/object&gt;

    
</pre>
<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode" id="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode"></a>Sample Snippet Code
</h3>

<p>
Here is some sample Snippet code. It assumes your package name is <b>one_to_many</b>:
</p>

<pre class="brush: php">
    CREATE TABLE `blogposts` (
  `blogpost_id` int(11) NOT NULL AUTO_INCREMENT,
  `content` text,
  PRIMARY KEY (`blogpost_id`)
) ENGINE=MyISAM;

CREATE TABLE `tags` (
  `tag_id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`tag_id`)
) ENGINE=MyISAM;

/* The Join Table: */
CREATE TABLE `blogposts_tags` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `blogpost` int(11) DEFAULT NULL,
  `tag` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM;


    
</pre>
<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-XMLSchema" id="MoreExamplesofxPDOXMLSchemaFiles-XMLSchema"></a>XML Schema
</h3>

<p>
Note the the following schema still contains the composite relationship for the Comments table.
</p>

<pre class="brush: php">
    &lt;?php
$base_path = MODX_CORE_PATH . 'components/many_to_many/';
$modx-&gt;addPackage('many_to_many',$base_path.'model/','');

$output = '';

$blogpost = $modx-&gt;getObject('Blogposts', array('blogpost_id' =&gt; 1 ) );
$blopost_tags = $blogpost-&gt;getMany('BlogpostsTags');
foreach ( $blopost_tags as $bt )
{
    $tag = $bt-&gt;getOne('Tags');
    $output .= $tag-&gt;get('name');
}

return $output;

    
</pre>
<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-ParentID%3ASelfJoin"></a>Parent ID: Self Join
</h2>

<p>
Another common pattern used to indicate hierarchy is the self-join. This is when one column in a table contains a reference to that table's own primary key. We are familiar with this in the MODx database when we put pages into folders: there is a parent/child relationship where each page may be the child of another page.
</p>

<p>
In this example, we are going to demonstrate how a table can define hierarchical categories using a parent/child relationship. If a parent_id is defined for a row in our <b>categories</b> table, it means that the row represents a sub-category of the parent.
</p>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions" id="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions"></a>MySQL Table Definitions
</h3>

<pre class="brush: php">
    &lt;object class="Categories" table="categories" extends="xPDOObject"&gt;
        &lt;field key="category_id" dbtype="int" precision="11" phptype="integer" null="false" index="pk"  generated="native" /&gt;
        &lt;field key="parent_id" dbtype="int" precision="11" phptype="integer" null="true" /&gt;
        &lt;field key="name" dbtype="varchar" precision="255" phptype="string" null="true" /&gt;
        &lt;field key="seq" dbtype="smallint" precision="4" phptype="integer" null="true" /&gt;
        &lt;index alias="PRIMARY" name="PRIMARY" primary="true" unique="true"&gt;
                &lt;column key="category_id" collation="A" null="false" /&gt;
        &lt;/index&gt;
        &lt;composite alias="Parent" class="Categories" local="parent_id" foreign="category_id" cardinality="one" owner="foreign" /&gt;
        &lt;aggregate alias="Children" class="Categories" local="category_id" foreign="parent_id" cardinality="many" owner="local" /&gt;
&lt;/object&gt;

    
</pre>
<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode" id="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode"></a>Sample Snippet Code
</h3>

<p>
In this example, our package is named <b>parent_child_example</b>. Notice that the <b>getMany</b> method relies on the alias defined for that relationship.
</p>

<pre class="brush: php">
    &lt;object class="sfStore" table="sfinder_stores" extends="xPDOSimpleObject"&gt;
  &lt;field key="name" dbtype="varchar" precision="100" phptype="string" null="false" default="" index="index" /&gt;
  &lt;field key="address" dbtype="varchar" precision="255" phptype="string" null="false" default="" /&gt;
  &lt;field key="city" dbtype="varchar" precision="255" phptype="string" null="false" default="" /&gt;
  &lt;field key="state" dbtype="varchar" precision="255" phptype="string" null="false" default="" /&gt;
  &lt;field key="zip" dbtype="varchar" precision="10" phptype="string" null="false" default="0" index="index" /&gt;
  &lt;field key="country" dbtype="varchar" precision="20" phptype="string" null="false" default="" /&gt;
  &lt;field key="phone" dbtype="varchar" precision="20" phptype="string" null="false" default="" /&gt;
  &lt;field key="fax" dbtype="varchar" precision="20" phptype="string" null="false" default="" /&gt;
  &lt;field key="active" dbtype="int" precision="1" attributes="unsigned" phptype="integer" null="false" default="0" /&gt;

  &lt;alias key="postalcode" field="zip" /&gt;

  &lt;index alias="name" name="name" primary="false" unique="false" type="BTREE"&gt;
      &lt;column key="name" length="" collation="A" null="false" /&gt;
  &lt;/index&gt;
  &lt;index alias="zip" name="zip" primary="false" unique="false" type="BTREE"&gt;
      &lt;column key="zip" length="" collation="A" null="false" /&gt;
  &lt;/index&gt;
&lt;/object&gt;

    
</pre>
<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode" id="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode"></a>Sample Snippet Code
</h3>

<p>
The alias <em>postalcode</em> is now accessible as a field of an sfStore object in xPDO. It is simply a reference to the value of the <em>zip</em> field.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
$modx-&gt;addPackage('storefinder', MODX_CORE_PATH . 'components/storefinder/model/');

$output = '';
$store = $modx-&gt;getObject('sfStore', array('name' =&gt; 'My Store'));
<span class="code-keyword">if</span> ($store) {
    $output = <span class="code-quote">"Postal code is {$store-&gt;get('postalcode')}"</span>;
}
<span class="code-keyword">return</span> $output;
</pre>
</div>
</div>