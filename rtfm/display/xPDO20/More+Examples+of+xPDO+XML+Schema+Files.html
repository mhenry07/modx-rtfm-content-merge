<p>
<br class="atl-forced-newline" />
</p>

<div>
<ul>
<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-Goal'>Goal</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-OnetoOne'>One to One</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions'>MySQL Table Definitions</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema'>XML Schema</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode'>Sample Snippet Code</a>
</li>
</ul>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-OnetoMany'>One to Many</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions'>MySQL Table Definitions</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema'>XML Schema</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode'>Sample Snippet Code</a>
</li>
</ul>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-ManytoMany%3AJoiningTables'>Many to Many: Joining Tables</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions'>MySQL Table Definitions</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema'>XML Schema</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode'>Sample Snippet Code</a>
</li>
</ul>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-ParentID%3ASelfJoin'>Parent ID: Self Join</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions'>MySQL Table Definitions</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema'>XML Schema</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode'>Sample Snippet Code</a>
</li>
</ul>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-UsingFieldAliases%28xPDO2.2%5Conly%29'>Using Field Aliases <em>(xPDO 2.2+ only)</em></a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-XMLSchema'>XML Schema</a>
</li>

<li>
<a href='#MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode'>Sample Snippet Code</a>
</li>
</ul>
</li>
</ul>
</div>

<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-Goal"></a>Goal
</h2>

<p>
This page contains examples that juxtapose MySQL database tables with their xPDO XML schema counterparts in order to teach developers how to define the foreign-key relationships between tables in xPDO XML schemas by using a series of common database relational patterns as examples.
</p>

<p>
Database relations can be complex, so it's no surprise that the XML schema files that describe those relations reflect that complexity. Although xPDO schema files <em>already</em> exist for built-in MODx tables inside of <b>core/model/schema/modx.mysql.schema.xml</b>, we don't recommend that developers rely on those XML files as their only examples of how to relate tables because they are often too complex to be used for educational purposes.
</p>

<p>
Remember that xPDO <em>abstracts</em> the database, so it's entirely possible that your model is something other than a traditional database, but for the sake of familiarity and clarity, the examples here assume you are using a MySQL database for your model. In general, it's recommended that you design your snippets/plugins etc. using a traditional database before abstracting it using xPDO.
</p>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<b>FYI</b>
<br />
Once you've created a valid XML schema file, xPDO can generate PHP class files <em>and</em> database tables; it is bi-directional. The purpose of this page is to juxtapose the xPDO XML schema to MySQL database tables. Some developers may prefer to write the XML schema file by hand and then let xPDO generate the tables and the class files. Other developers may prefer to first create the database tables, then <a href="/display/revolution20/Reverse+Engineer+xPDO+Classes+from+Existing+Database+Table" title="Reverse Engineer xPDO Classes from Existing Database Table">reverse engineer</a> the XML schema and the class files.
</td>
</tr>
</table>
</div>

<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-OnetoOne"></a>One to One
</h2>

<p>
A one-to-one relationship exists when two tables use the same primary key. Architecturally, this means that the data could theoretically live in a single table, but for whatever reason, the data is separated into two (or more) tables.
</p>

<p>
The tricky thing about one-to-one relationships is that both tables are <em>not</em> equal. Like the movie Highlander, there can be only one primary table: you must decide which table is the primary (or master) table, and which is the secondary (or slave) table.
</p>

<p>
A good example of this type of relationship exists in the MODx database between the <b>users</b> and the <b>user_attributes</b> tables: the <b>users</b> table is the primary table, and the <b>user_attributes</b> is the secondary table. If you delete a user from the <b>users</b> table, the extra attributes in the <b>user_attributes</b> table should also be deleted, but the opposite is not necessarily true. The documentation on <a href="/display/xPDO20/Defining+Relationships" title="Defining Relationships">relationships</a> stresses this primary/secondary relationship.
</p>

<p>
When defining relationships, you must first learn about <b>aggregate</b> and <b>composite</b> relationships; you may not understand the usage of these particular words, but when defining this type of relationship, simply remember the following:
</p>

<ul>
<li>The primary table's XML definition lists a <b><em>composite</em></b> relationship to the the secondary table.
</li>

<li>The secondary table's XML definition lists an <b><em>aggregate</em></b> relationship to the primary table.
</li>
</ul>

<p>
For this example, we are mimicking the MODx tables where we have one table for <b>users</b> and a secondary table that stores additional information about those users, named <b>userdata</b>.
</p>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<b>FYI</b>
<br />
Unlike some ORMs (e.g. Doctrine) and even unlike MySQL's foreign-key definitions, xPDO defines a relationship on <em>both</em> sides. You tell the children who their parents are and you also tell the parents who their children are. E.g. the parent object contains a composite relationship and the child object contains an aggregate relationship. This ensures that everybody knows who they're related to.
</td>
</tr>
</table>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions"></a>MySQL Table Definitions
</h3>

<p>
Here are abbreviated MySQL table definitions:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
CREATE TABLE `users` (
  `user_id` <span class="code-object">int</span>(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(255) DEFAULT NULL,
  `bio` text,
  `joindate` date DEFAULT NULL,
  PRIMARY KEY (`user_id`)
) ENGINE=MyISAM;

CREATE TABLE `userdata` (
  `userdata_id` <span class="code-object">int</span>(11) NOT NULL AUTO_INCREMENT,
  `age` tinyint(3) unsigned DEFAULT NULL,
  PRIMARY KEY (`userdata_id`)
) ENGINE=MyISAM;
</pre>
</div>
</div>

<p>
This MySQL query will show <em>all</em> data for users (including info from the primary user table, and also from the secondary userdata table):
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
SELECT users.*, userdata.*
FROM users JOIN userdata ON users.user_id = userdata.userdata_id;
</pre>
</div>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-XMLSchema"></a>XML Schema
</h3>

<p>
And here's the corresponding XML definitions:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;object class=<span class="code-quote">"Users"</span> table=<span class="code-quote">"users"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOObject"</span>&gt;
        &lt;field key=<span class="code-quote">"user_id"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> index=<span class="code-quote">"pk"</span>  generated=<span class="code-quote">"<span class="code-keyword">native</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"username"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"255"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"bio"</span> dbtype=<span class="code-quote">"text"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"joindate"</span> dbtype=<span class="code-quote">"date"</span> phptype=<span class="code-quote">"date"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;index alias=<span class="code-quote">"PRIMARY"</span> name=<span class="code-quote">"PRIMARY"</span> primary=<span class="code-quote">"<span class="code-keyword">true</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">true</span>"</span>&gt;
                &lt;column key=<span class="code-quote">"user_id"</span> collation=<span class="code-quote">"A"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> /&gt;
        &lt;/index&gt;
        &lt;composite alias=<span class="code-quote">"Userdata"</span> class=<span class="code-quote">"Userdata"</span> local=<span class="code-quote">"user_id"</span> foreign=<span class="code-quote">"userdata_id"</span> cardinality=<span class="code-quote">"one"</span> owner=<span class="code-quote">"local"</span> /&gt;
&lt;/object&gt;


&lt;object class=<span class="code-quote">"Userdata"</span> table=<span class="code-quote">"userdata"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOObject"</span>&gt;
        &lt;field key=<span class="code-quote">"userdata_id"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> index=<span class="code-quote">"pk"</span>  generated=<span class="code-quote">"<span class="code-keyword">native</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"age"</span> dbtype=<span class="code-quote">"tinyint"</span> precision=<span class="code-quote">"3"</span> attributes=<span class="code-quote">"unsigned"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;index alias=<span class="code-quote">"PRIMARY"</span> name=<span class="code-quote">"PRIMARY"</span> primary=<span class="code-quote">"<span class="code-keyword">true</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">true</span>"</span>&gt;
                &lt;column key=<span class="code-quote">"userdata_id"</span> collation=<span class="code-quote">"A"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> /&gt;
        &lt;/index&gt;
        &lt;aggregate alias=<span class="code-quote">"Users"</span> class=<span class="code-quote">"Users"</span> local=<span class="code-quote">"userdata_id"</span> foreign=<span class="code-quote">"user_id"</span> cardinality=<span class="code-quote">"one"</span> owner=<span class="code-quote">"foreign"</span> /&gt;
&lt;/object&gt;
</pre>
</div>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode"></a>Sample Snippet Code
</h3>

<p>
If you were to access this data in a Snippet, you might do something like the following. This assumes that your package name is <b>one_to_one</b>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
        $base_path = MODX_CORE_PATH . 'components/one_to_one/';
        $modx-&gt;addPackage('one_to_one',$base_path.'model/','');
        $user = $modx-&gt;getObject('Users', array('user_id' =&gt; 1 ) );
        $userdata = $user-&gt;getOne('Userdata');
        $output = '';
        $output .= $user-&gt;get('username');
        $output .= $userdata-&gt;get('age');
        <span class="code-keyword">return</span> $output;
?&gt;
</pre>
</div>
</div>

<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-OnetoMany"></a>One to Many
</h2>

<p>
This is a common pattern that occurs when a secondary table contains a foreign key. For example, you might have a primary table containing blog posts, and a secondary table containing comments. Each blog post might have zero or many comments, but each comment can belong to one and <em>only</em> one blog post.
</p>

<p>
This is the same type of relationship that exists in MODx between pages and templates: a single template might be used by hundreds of pages, but a page can only use a single template.
</p>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions"></a>MySQL Table Definitions
</h3>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
CREATE TABLE `blogposts` (
  `blogpost_id` <span class="code-object">int</span>(11) NOT NULL AUTO_INCREMENT,
  `content` text,
  PRIMARY KEY (`blogpost_id`)
) ENGINE=MyISAM;

CREATE TABLE `comments` (
  `comment_id` <span class="code-object">int</span>(11) NOT NULL AUTO_INCREMENT,
  `blogpost` <span class="code-object">int</span>(11) DEFAULT NULL,
  `comment` text,
  PRIMARY KEY (`comment_id`)
) ENGINE=MyISAM;
</pre>
</div>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-XMLSchema"></a>XML Schema
</h3>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;object class=<span class="code-quote">"Blogposts"</span> table=<span class="code-quote">"blogposts"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOObject"</span>&gt;
        &lt;field key=<span class="code-quote">"blogpost_id"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> index=<span class="code-quote">"pk"</span>  generated=<span class="code-quote">"<span class="code-keyword">native</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"content"</span> dbtype=<span class="code-quote">"text"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;index alias=<span class="code-quote">"PRIMARY"</span> name=<span class="code-quote">"PRIMARY"</span> primary=<span class="code-quote">"<span class="code-keyword">true</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">true</span>"</span>&gt;
                &lt;column key=<span class="code-quote">"blogpost_id"</span> collation=<span class="code-quote">"A"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> /&gt;
        &lt;/index&gt;
        &lt;composite alias=<span class="code-quote">"Comments"</span> class=<span class="code-quote">"Comments"</span> local=<span class="code-quote">"blogpost_id"</span> foreign=<span class="code-quote">"blogpost"</span> cardinality=<span class="code-quote">"many"</span> owner=<span class="code-quote">"local"</span> /&gt;
&lt;/object&gt;

&lt;object class=<span class="code-quote">"Comments"</span> table=<span class="code-quote">"comments"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOObject"</span>&gt;
        &lt;field key=<span class="code-quote">"comment_id"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> index=<span class="code-quote">"pk"</span>  generated=<span class="code-quote">"<span class="code-keyword">native</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"blogpost"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"comment"</span> dbtype=<span class="code-quote">"text"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;index alias=<span class="code-quote">"PRIMARY"</span> name=<span class="code-quote">"PRIMARY"</span> primary=<span class="code-quote">"<span class="code-keyword">true</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">true</span>"</span>&gt;
                &lt;column key=<span class="code-quote">"comment_id"</span> collation=<span class="code-quote">"A"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> /&gt;
        &lt;/index&gt;
        &lt;aggregate alias=<span class="code-quote">"Blogposts"</span> class=<span class="code-quote">"Blogposts"</span> local=<span class="code-quote">"blogpost"</span> foreign=<span class="code-quote">"blogpost_id"</span> cardinality=<span class="code-quote">"one"</span> owner=<span class="code-quote">"foreign"</span> /&gt;
&lt;/object&gt;
</pre>
</div>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode"></a>Sample Snippet Code
</h3>

<p>
Here is some sample Snippet code. It assumes your package name is <b>one_to_many</b>:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
$base_path = MODX_CORE_PATH . 'components/one_to_many/';
$modx-&gt;addPackage('one_to_many',$base_path.'model/','');

$output = '';

$blogpost = $modx-&gt;getObject('Blogposts', array('blogpost_id' =&gt; 1 ) );
$comments = $blogpost-&gt;getMany('Comments');

$output .= $blogpost-&gt;get('content');

foreach ( $comments as $c )
{
    $output .= $c-&gt;get('comment');
}

<span class="code-keyword">return</span> $output;
</pre>
</div>
</div>

<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-ManytoMany%3AJoiningTables"></a>Many to Many: Joining Tables
</h2>

<p>
Another common database pattern involves the use of join tables. This type of relationship is seen frequently when using taxonomies such as "categories" or "tags": e.g. a single post can be "tagged" with multiple terms, and each tag can likewise be associated with multiple posts.
</p>

<p>
This type of relationship infers <em>three</em> database tables: <b>blogposts</b>, <b>tags</b>, and the joining table <b>blogposts_tags</b>. The trick here is that <em>two</em> of the tables are acting as primary tables: both the <b>blogposts</b> and the <b>tags</b> table will contain composite definitions that point to the <b>blogposts_tags</b>.
</p>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions"></a>MySQL Table Definitions
</h3>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
CREATE TABLE `blogposts` (
  `blogpost_id` <span class="code-object">int</span>(11) NOT NULL AUTO_INCREMENT,
  `content` text,
  PRIMARY KEY (`blogpost_id`)
) ENGINE=MyISAM;

CREATE TABLE `tags` (
  `tag_id` <span class="code-object">int</span>(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`tag_id`)
) ENGINE=MyISAM;

/* The Join Table: */
CREATE TABLE `blogposts_tags` (
  `id` <span class="code-object">int</span>(11) NOT NULL AUTO_INCREMENT,
  `blogpost` <span class="code-object">int</span>(11) DEFAULT NULL,
  `tag` <span class="code-object">int</span>(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM;

</pre>
</div>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-XMLSchema"></a>XML Schema
</h3>

<p>
Note the the following schema still contains the composite relationship for the Comments table.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;object class=<span class="code-quote">"Blogposts"</span> table=<span class="code-quote">"blogposts"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOObject"</span>&gt;
        &lt;field key=<span class="code-quote">"blogpost_id"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> index=<span class="code-quote">"pk"</span>  generated=<span class="code-quote">"<span class="code-keyword">native</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"content"</span> dbtype=<span class="code-quote">"text"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;index alias=<span class="code-quote">"PRIMARY"</span> name=<span class="code-quote">"PRIMARY"</span> primary=<span class="code-quote">"<span class="code-keyword">true</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">true</span>"</span>&gt;
                &lt;column key=<span class="code-quote">"blogpost_id"</span> collation=<span class="code-quote">"A"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> /&gt;
        &lt;/index&gt;
        &lt;composite alias=<span class="code-quote">"Comments"</span> class=<span class="code-quote">"Comments"</span> local=<span class="code-quote">"blogpost_id"</span> foreign=<span class="code-quote">"blogpost_id"</span> cardinality=<span class="code-quote">"many"</span> owner=<span class="code-quote">"local"</span> /&gt;
        &lt;composite alias=<span class="code-quote">"BlogpostsTags"</span> class=<span class="code-quote">"BlogpostsTags"</span> local=<span class="code-quote">"blogpost_id"</span> foreign=<span class="code-quote">"blogpost_id"</span> cardinality=<span class="code-quote">"many"</span> owner=<span class="code-quote">"local"</span> /&gt;
&lt;/object&gt;

&lt;object class=<span class="code-quote">"Tags"</span> table=<span class="code-quote">"tags"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOObject"</span>&gt;
        &lt;field key=<span class="code-quote">"tag_id"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> index=<span class="code-quote">"pk"</span>  generated=<span class="code-quote">"<span class="code-keyword">native</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"name"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"255"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;index alias=<span class="code-quote">"PRIMARY"</span> name=<span class="code-quote">"PRIMARY"</span> primary=<span class="code-quote">"<span class="code-keyword">true</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">true</span>"</span>&gt;
                &lt;column key=<span class="code-quote">"tag_id"</span> collation=<span class="code-quote">"A"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> /&gt;
        &lt;/index&gt;
        &lt;composite alias=<span class="code-quote">"BlogpostsTags"</span> class=<span class="code-quote">"BlogpostsTags"</span> local=<span class="code-quote">"tag_id"</span> foreign=<span class="code-quote">"tag_id"</span> cardinality=<span class="code-quote">"many"</span> owner=<span class="code-quote">"local"</span> /&gt;
&lt;/object&gt;

&lt;object class=<span class="code-quote">"BlogpostsTags"</span> table=<span class="code-quote">"blogposts_tags"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOSimpleObject"</span>&gt;
        &lt;field key=<span class="code-quote">"blogpost"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"tag"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;index alias=<span class="code-quote">"PRIMARY"</span> name=<span class="code-quote">"PRIMARY"</span> primary=<span class="code-quote">"<span class="code-keyword">true</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">true</span>"</span>&gt;
                &lt;column key=<span class="code-quote">"id"</span> collation=<span class="code-quote">"A"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> /&gt;
        &lt;/index&gt;
        &lt;aggregate alias=<span class="code-quote">"Tags"</span> class=<span class="code-quote">"Tags"</span> local=<span class="code-quote">"tag"</span> foreign=<span class="code-quote">"tag_id"</span> cardinality=<span class="code-quote">"one"</span> owner=<span class="code-quote">"foreign"</span> /&gt;
        &lt;aggregate alias=<span class="code-quote">"Blogposts"</span> class=<span class="code-quote">"Blogposts"</span> local=<span class="code-quote">"blogpost"</span> foreign=<span class="code-quote">"blogpost_id"</span> cardinality=<span class="code-quote">"one"</span> owner=<span class="code-quote">"foreign"</span> /&gt;
&lt;/object&gt;
</pre>
</div>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode"></a>Sample Snippet Code
</h3>

<p>
The following example assumes that the package is named <b>many_to_many</b>. Note that the logic displayed here traces the relationships precisely. In this example, we load up a blogpost, then trace it through the joining table to its tags. Arguably, this isn't any easier than writing a JOIN statement in MySQL.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
$base_path = MODX_CORE_PATH . 'components/many_to_many/';
$modx-&gt;addPackage('many_to_many',$base_path.'model/','');

$output = '';

$blogpost = $modx-&gt;getObject('Blogposts', array('blogpost_id' =&gt; 1 ) );
$blopost_tags = $blogpost-&gt;getMany('BlogpostsTags');
foreach ( $blopost_tags as $bt )
{
    $tag = $bt-&gt;getOne('Tags');
    $output .= $tag-&gt;get('name');
}

<span class="code-keyword">return</span> $output;
</pre>
</div>
</div>

<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-ParentID%3ASelfJoin"></a>Parent ID: Self Join
</h2>

<p>
Another common pattern used to indicate hierarchy is the self-join. This is when one column in a table contains a reference to that table's own primary key. We are familiar with this in the MODx database when we put pages into folders: there is a parent/child relationship where each page may be the child of another page.
</p>

<p>
In this example, we are going to demonstrate how a table can define hierarchical categories using a parent/child relationship. If a parent_id is defined for a row in our <b>categories</b> table, it means that the row represents a sub-category of the parent.
</p>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-MySQLTableDefinitions"></a>MySQL Table Definitions
</h3>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
CREATE TABLE `categories` (
  `category_id` <span class="code-object">int</span>(11) NOT NULL AUTO_INCREMENT,
  `parent_id` <span class="code-object">int</span>(11) DEFAULT NULL,
  `name` varchar(255) DEFAULT NULL,
  `seq` smallint(4) DEFAULT NULL,
  PRIMARY KEY (`category_id`)
) ENGINE=MyISAM;
</pre>
</div>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-XMLSchema"></a>XML Schema
</h3>

<p>
In order to define this relationship in xPDO XML, we must add 2 aggregate relationships to the object:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;object class=<span class="code-quote">"Categories"</span> table=<span class="code-quote">"categories"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOObject"</span>&gt;
        &lt;field key=<span class="code-quote">"category_id"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> index=<span class="code-quote">"pk"</span>  generated=<span class="code-quote">"<span class="code-keyword">native</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"parent_id"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"11"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"name"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"255"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;field key=<span class="code-quote">"seq"</span> dbtype=<span class="code-quote">"smallint"</span> precision=<span class="code-quote">"4"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;
        &lt;index alias=<span class="code-quote">"PRIMARY"</span> name=<span class="code-quote">"PRIMARY"</span> primary=<span class="code-quote">"<span class="code-keyword">true</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">true</span>"</span>&gt;
                &lt;column key=<span class="code-quote">"category_id"</span> collation=<span class="code-quote">"A"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> /&gt;
        &lt;/index&gt;
        &lt;composite alias=<span class="code-quote">"Parent"</span> class=<span class="code-quote">"Categories"</span> local=<span class="code-quote">"parent_id"</span> foreign=<span class="code-quote">"category_id"</span> cardinality=<span class="code-quote">"one"</span> owner=<span class="code-quote">"foreign"</span> /&gt;
        &lt;aggregate alias=<span class="code-quote">"Children"</span> class=<span class="code-quote">"Categories"</span> local=<span class="code-quote">"category_id"</span> foreign=<span class="code-quote">"parent_id"</span> cardinality=<span class="code-quote">"many"</span> owner=<span class="code-quote">"local"</span> /&gt;
&lt;/object&gt;
</pre>
</div>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode"></a>Sample Snippet Code
</h3>

<p>
In this example, our package is named <b>parent_child_example</b>. Notice that the <b>getMany</b> method relies on the alias defined for that relationship.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
$base_path = MODX_CORE_PATH . 'components/parent_child_example/';
$modx-&gt;addPackage('parent_child_example',$base_path.'model/','');

$output = '';

$category = $modx-&gt;getObject('Categories', array('category_id' =&gt; 1 ) );
$subcategories = $category-&gt;getMany('Children');
$output .= $category-&gt;get('content');
foreach ( $subcategories as $sc )
{
    $output .= $sc-&gt;get('name');
}
<span class="code-keyword">return</span> $output;
</pre>
</div>
</div>

<h2>
<a name="MoreExamplesofxPDOXMLSchemaFiles-UsingFieldAliases%28xPDO2.2%5Conly%29"></a>Using Field Aliases <em>(xPDO 2.2+ only)</em>
</h2>

<p>
In this example, we are setting an alias of <em>postalcode</em> for the <em>zip</em> field from the <b>storefinder</b> model.
</p>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-XMLSchema"></a>XML Schema
</h3>

<p>
The field alias definition is simply defined using the <tt>alias</tt> element.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;object class=<span class="code-quote">"sfStore"</span> table=<span class="code-quote">"sfinder_stores"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOSimpleObject"</span>&gt;
  &lt;field key=<span class="code-quote">"name"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"100"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> <span class="code-keyword">default</span>=<span class="code-quote">"" index="</span>index" /&gt;
  &lt;field key=<span class="code-quote">"address"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"255"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> <span class="code-keyword">default</span>="" /&gt;
  &lt;field key=<span class="code-quote">"city"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"255"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> <span class="code-keyword">default</span>="" /&gt;
  &lt;field key=<span class="code-quote">"state"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"255"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> <span class="code-keyword">default</span>="" /&gt;
  &lt;field key=<span class="code-quote">"zip"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"10"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> <span class="code-keyword">default</span>=<span class="code-quote">"0"</span> index=<span class="code-quote">"index"</span> /&gt;
  &lt;field key=<span class="code-quote">"country"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"20"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> <span class="code-keyword">default</span>="" /&gt;
  &lt;field key=<span class="code-quote">"phone"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"20"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> <span class="code-keyword">default</span>="" /&gt;
  &lt;field key=<span class="code-quote">"fax"</span> dbtype=<span class="code-quote">"varchar"</span> precision=<span class="code-quote">"20"</span> phptype=<span class="code-quote">"string"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> <span class="code-keyword">default</span>="" /&gt;
  &lt;field key=<span class="code-quote">"active"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"1"</span> attributes=<span class="code-quote">"unsigned"</span> phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> <span class="code-keyword">default</span>=<span class="code-quote">"0"</span> /&gt;

  &lt;alias key=<span class="code-quote">"postalcode"</span> field=<span class="code-quote">"zip"</span> /&gt;

  &lt;index alias=<span class="code-quote">"name"</span> name=<span class="code-quote">"name"</span> primary=<span class="code-quote">"<span class="code-keyword">false</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">false</span>"</span> type=<span class="code-quote">"BTREE"</span>&gt;
      &lt;column key=<span class="code-quote">"name"</span> length=<span class="code-quote">"" collation="</span>A<span class="code-quote">" <span class="code-keyword">null</span>="</span><span class="code-keyword">false</span>" /&gt;
  &lt;/index&gt;
  &lt;index alias=<span class="code-quote">"zip"</span> name=<span class="code-quote">"zip"</span> primary=<span class="code-quote">"<span class="code-keyword">false</span>"</span> unique=<span class="code-quote">"<span class="code-keyword">false</span>"</span> type=<span class="code-quote">"BTREE"</span>&gt;
      &lt;column key=<span class="code-quote">"zip"</span> length=<span class="code-quote">"" collation="</span>A<span class="code-quote">" <span class="code-keyword">null</span>="</span><span class="code-keyword">false</span>" /&gt;
  &lt;/index&gt;
&lt;/object&gt;
</pre>
</div>
</div>

<h3>
<a name="MoreExamplesofxPDOXMLSchemaFiles-SampleSnippetCode"></a>Sample Snippet Code
</h3>

<p>
The alias <em>postalcode</em> is now accessible as a field of an sfStore object in xPDO. It is simply a reference to the value of the <em>zip</em> field.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
$modx-&gt;addPackage('storefinder', MODX_CORE_PATH . 'components/storefinder/model/');

$output = '';
$store = $modx-&gt;getObject('sfStore', array('name' =&gt; 'My Store'));
<span class="code-keyword">if</span> ($store) {
    $output = <span class="code-quote">"Postal code is {$store-&gt;get('postalcode')}"</span>;
}
<span class="code-keyword">return</span> $output;
</pre>
</div>
</div>