<p>
<br class="atl-forced-newline" />
</p>

<h2>
<a name="xPDO.getCollectionGraph-xPDO%3A%3AgetCollectionGraph"></a>xPDO::getCollectionGraph
</h2>

<p>
Retrieves a collection of xPDOObjects and related objects by the specified xPDOCriteria.
</p>

<p>
If none are found, returns an empty array.
</p>

<h2>
<a name="xPDO.getCollectionGraph-Syntax"></a>Syntax
</h2>

<p>
API Docs: <a href="http://api.modx.com/xpdo/xPDO.html#getCollectionGraph" class="external-link" rel="nofollow">http://api.modx.com/xpdo/xPDO.html#getCollectionGraph</a>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
array getCollectionGraph (string $className, array|str $graph, [xPDOCriteria|array|str|<span class="code-object">int</span> $criteria = <span class="code-keyword">null</span>], [bool|<span class="code-object">int</span> $cacheFlag = <span class="code-keyword">true</span>])
</pre>
</div>
</div>

<p>
Remember, if you are using xPDO map and class files that were generated from XML schema, the classname is <b>not</b> the same as your table name. If in doubt, have a look at the schema XML file, e.g.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;object class=<span class="code-quote">"MyClassName"</span> table=<span class="code-quote">"my_class_name"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOObject"</span>&gt;
</pre>
</div>
</div>

<h2>
<a name="xPDO.getCollectionGraph-Example"></a>Example
</h2>

<p>
Get a collection of Box objects with related BoxColors and Color objects, where the Box has a width of 40.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$boxes = $xpdo-&gt;getCollectionGraph('Box', '{<span class="code-quote">"BoxColors"</span>:{<span class="code-quote">"Color"</span>:{}}}', array('Box.width' =&gt; 40));
foreach ($boxes as $box) {
    foreach ($box-&gt;getMany('BoxColors') as $boxColor) {
        echo <span class="code-quote">"A box with width of 40 and a color of "</span> . $boxColor-&gt;getOne('Color')-&gt;get('name') . <span class="code-quote">" was found.\n"</span>;
    }
}
</pre>
</div>
</div>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<b>No additional queries</b>
<br />
The main benefit of using getCollectionGraph is to retrieve data from related tables in a single query. No additional queries are executed when getMany() or getOne() are called on the related objects that are already loaded from the $graph. Graph's are a useful alternative to using xPDO joins.
</td>
</tr>
</table>
</div>

<h2>
<a name="xPDO.getCollectionGraph-Debugging"></a>Debugging
</h2>

<p>
There are a couple caveats to keep in mind when using getCollectionGraph. You can't use the traditional "prepare" and "toSQL" methods. Consider the following code:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$criteria['modResource.id:IN'] = array(1,2,3);
$criteria['TemplateVarResources.tmplvarid'] = 5;
$criteria = $modx-&gt;newQuery('modResource', $criteria);
$criteria-&gt;prepare();
print $criteria-&gt;toSQL();
$pages = $modx-&gt;getCollectionGraph('modResource', '{<span class="code-quote">"TemplateVarResources"</span>:{<span class="code-quote">"TemplateVar"</span>:{}}}', $criteria);
</pre>
</div>
</div>

<p>
If you look at the query, you'll see there is nothing inherent in the $criteria object that specifies a JOIN. You're specifying columns in multiple tables (modResource and TemplateVarResources), but if you look at the query when you use the toSQL() method, you'll find that the query will not execute.
</p>

<p>
The join on the related tables occurs in this case when the getCollectionGraph() function is executed, so trying to print the SQL prior to that moment will not produce an accurate result.
</p>

<h2>
<a name="xPDO.getCollectionGraph-SeeAlso"></a>See Also
</h2>

<ul>
<li>
<a href="/display/xPDO20/Retrieving+Objects" title="Retrieving Objects">Retrieving Objects</a>
</li>

<li>
<a href="/display/xPDO20/xPDO.getCollectionGraph" title="xPDO.getCollectionGraph">xPDO.getCollectionGraph</a>
</li>

<li>
<a href="/display/xPDO20/xPDO.getIterator" title="xPDO.getIterator">xPDO.getIterator</a>
</li>

<li>
<a href="/display/xPDO20/xPDO.getObject" title="xPDO.getObject">xPDO.getObject</a>
</li>

<li>
<a href="/display/xPDO20/xPDO" title="xPDO">xPDO</a>
</li>
</ul>