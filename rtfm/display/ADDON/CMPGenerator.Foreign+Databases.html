<div>
<ul>
<li>
<a href="extras/revo/cmpgenerator/cmpgenerator.foreign-databases#CMPGenerator.ForeignDatabases-UsingForeignDatabases">Using Foreign Databases</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="extras/revo/cmpgenerator/cmpgenerator.foreign-databases#CMPGenerator.ForeignDatabases-BasicSnippetCodeExample">Basic Snippet Code Example</a>
</li>

<li>
<a href="extras/revo/cmpgenerator/cmpgenerator.foreign-databases#CMPGenerator.ForeignDatabases-AdvancedSnippetCodeExample">Advanced Snippet Code Example</a>
</li>
</ul>
</li>

<li>
<a href="extras/revo/cmpgenerator/cmpgenerator.foreign-databases#CMPGenerator.ForeignDatabases-SeeAlso">See Also</a>
</li>
</ul>
</div>

<h2>
<a name="CMPGenerator.ForeignDatabases-UsingForeignDatabases" id="CMPGenerator.ForeignDatabases-UsingForeignDatabases"></a>Using Foreign Databases
</h2>

<p>
Added in 1.1
</p>

<p>
A foreign database means a another or third party database.&nbsp; Example your probably have the database modx as your MODX db and maybe your have crm for your CRM db.&nbsp; crm would be the foreign database.&nbsp; &nbsp; As of version 1.1, to generate files, your foreign database needs to be on the same machine as your MODX DB and in MySQL.&nbsp; The database user that MODX is using must also have permissions to the foreign database.
</p>

<p>
When you run the CMPGenerator fill in the database name and if needed the table prefix.&nbsp; Now when you create a snippet you will need to create a new instance of xPDO and then you can code as normal (using your $foreignDB reference instead of $modx of course).&nbsp; See the example code below.
</p>

<h3>
<a name="CMPGenerator.ForeignDatabases-BasicSnippetCodeExample" id="CMPGenerator.ForeignDatabases-BasicSnippetCodeExample"></a>Basic Snippet Code Example
</h3>

<pre class="brush: php">
    class ForeignConnect {
    /**
     * @var (Array) of db_dsn =&gt; (Object) the xPDO instance
     */
    private static $instance = array();
    
    /**
     * private constructor
     */
    private function __construct($database_dsn, $username, $password){
        
    }
    public function __destruct(){
        $this-&gt;close();
    }
    /**
     * This static method creates an instance of the class if no instance already exists.
     * @param (String) $database_dsn
     * @param (String) $username
     * @param (String) $password
    */
    static public function getInstance($database_dsn, $username, $password){
        //global $modx;
        //$modx-&gt;log(xPDO::LOG_LEVEL_ERROR, 'getInstance');
        //instance must be static in order to be referenced here
        if(!isset(self::$instance[$database_dsn]) ){
            // new connection
            //$modx-&gt;log(xPDO::LOG_LEVEL_ERROR, 'New Connection getInstance DB: '.$database_dsn);
            self::$instance[$database_dsn] = new xPDO($database_dsn,
                $username,
                $password );
            
        }
        //$modx-&gt;log(xPDO::LOG_LEVEL_ERROR, 'Return Connection');
        return self::$instance[$database_dsn];
    }
    /**
     * Close the instance
     */
    public function close(){
        self::$instance = array();
    }
}
    
</pre>
<p>
Now create a config file that can be required for each snippet call:
</p>

<pre class="brush: php">
    require $modx-&gt;getOption('core_path').'/config/foreign_config.inc.php';

$output = '';// this is what the snippet will return

$package_path = $modx-&gt;getOption('core_path').'components/foreigndb/model/';
require_once $package_path.'foreignconnect.class.php';

$foreignDB = ForeignConnect::getInstance($database_dsn, $database_user, $database_password); // returns an xPDO instance
    
</pre>
<h2>
<a name="CMPGenerator.ForeignDatabases-SeeAlso" id="CMPGenerator.ForeignDatabases-SeeAlso"></a>See Also
</h2>