<div>
<ul>
<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-Outline">Outline</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-DownloadtheNecessarySnippets">Download the Necessary Snippets</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-CreatetheRequiredPages">Create the Required Pages</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-EnsureBasicPermissionsareinPlace">Ensure Basic Permissions are in Place</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-AddSnippets">Add Snippets</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-LoginPage%281%29">Login Page (1)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-TheHomepageTemplate">The Homepage Template</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-AddChunk%3Aheaderforguests">Add Chunk: header_for_guests</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-AddChunk%3Aheaderformembers">Add Chunk: header_for_members</a>
</li>
</ul>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-LoginPage%281%29">Login Page (1)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-ForgotPassword%282%29">Forgot Password (2)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-ResetPasswordHandler%283%29">Reset Password Handler (3)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-MembersHomePage%284%29">Members Home Page (4)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-ComeAgainSoon%285%29">Come Again Soon (5)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-RequestMembership%286%29">Request Membership (6)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-RequestPending%287%29">Request Pending (7)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-MembershipConfirmationHandler%288%29">Membership Confirmation Handler (8)</a>
</li>
</ul>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-Testing%3AMakingitallWork">Testing: Making it all Work</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-RequestMembership">Request Membership</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-CheckforVerificationEmail">Check for Verification Email</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-Login">Login</a>
</li>
</ul>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-Errors">Errors</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-WhenIsubmittherequestmembershipform%2Cthepagedoesnotredirect%21">When I submit the request membership form, the page does not redirect!</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-WhenIgettheActivationemail%2Cthemessageisblank%21">When I get the Activation email, the message is blank!</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-InevergettheEmailsthatMODxsends%21">I never get the Emails that MODx sends!</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.request-membership#Login.RequestMembership-Aftersubmittingtheregistrationform%2CIgetawhitepage.">After submitting the registration form, I get a white page.</a>
</li>
</ul>
</li>
</ul>
</div>

<h2>
<a name="Login.RequestMembership-Outline" id="Login.RequestMembership-Outline"></a>Outline
</h2>

<p>
If you've followed the tutorial for the <a href="display/ADDON/Login.Basic+Setup" title="Login.Basic Setup">Basic Setup</a>, then it's time to try for a more thorough implementation of the Login Snippet where <font color="green"><em>users can apply for site membership themselves</em></font>. Once you've completed this tutorial, visitors to your site will be able to request membership by themselves and you will not have to add users manually.
</p>

<div class="note">
<font color="red">Do not try to use extended user fields yet.</font> First get the registration process working using the standard user fields. See the next tutorial for setting up user profiles and using extended user fields.
</div>

<p>
A good example for what we're trying to accomplish in this tutorial is visible on the <a href="http://forum.foxycart.com/" class="external-link" rel="nofollow">FoxyCart Forum</a>: when you're viewing the forums as a guest, the header displays a login link, but after you've signed in, additional functionality is unlocked. You've seen this type of thing on many sites.
</p>

<div class="note">
The FoxyCart forum is not running MODx: we're just using a simplified version of their login flow as an example.
</div>

<p>
The steps go something like this:
</p>

<p>
1. <b>Visit the homepage as a guest:</b> the header displays a link to the login page.
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/35094671/Foxy+Cart+Header.jpg?version=1&amp;modificationDate=1303606748000" style="border: 0px solid black" /></span>
</p>

<p>
2. <b>Login:</b> The Login page contains links to the "Forgot Password" and to a "Apply for Membership" page.
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/35094671/The+FoxyCart+Forum+-+Sign+In.jpg?version=1&amp;modificationDate=1303606758000" style="border: 0px solid black" /></span>
</p>

<p>
3. <b>Redirect to the Homepage:</b> after a successful login, you are returned to the homepage, but this time, additional functionality is unlocked.
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/35094671/The+FoxyCart+Forum+-+Logged+In.jpg?version=1&amp;modificationDate=1303606753000" style="border: 0px solid black" /></span>
</p>

<p>
4. <b>Logout:</b> When you're done visiting the site, you can click the "Logout" link and land on the "Come Again" page.
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/35094671/The+FoxyCart+Forum+-+Sign+Out.jpg?version=1&amp;modificationDate=1303606763000" style="border: 0px solid black" /></span>
</p>

<p>
Make sense? It's pretty similar to what we did before in the <a href="display/ADDON/Login.Basic+Setup" title="Login.Basic Setup">Basic Setup</a>, but there are a few extra things going on, so we need a few extra pages. Most importantly, we'll need to integrate both the <a href="display/ADDON/Login.Register" title="Login.Register">Register</a> and the <a href="http://modx.com/extras/package/personalize" class="external-link" rel="nofollow">Personalize</a> Snippets, and we'll need to shuffle around a couple other components from the <a href="display/ADDON/Login.Basic+Setup" title="Login.Basic Setup">Basic Setup</a> tutorial.
</p>

<div class="note">
This tutorial makes use of related and complimentary Snippets!
</div>

<p>
Let's get started!
</p>

<hr />

<h2>
<a name="Login.RequestMembership-DownloadtheNecessarySnippets" id="Login.RequestMembership-DownloadtheNecessarySnippets"></a>Download the Necessary Snippets
</h2>

<p>
We're augmenting the functionality offered by the default Login snippet, so make sure that you also download the <a href="http://modx.com/extras/package/personalize" class="external-link" rel="nofollow">Personalize</a> Snippet. It is available via package management.
</p>

<p>
<span class="image-wrap" style=""><img src="download/attachments/35094671/Personalize+Snippet.jpg?version=1&amp;modificationDate=1303607956000" style="border: 0px solid black" /></span>
</p>

<p>
Be sure to download the latest version (the one by BobRay). Bob says he may have goofed when submitting his upgrade, so it shows up as a separate package.
</p>

<hr />

<h2>
<a name="Login.RequestMembership-CreatetheRequiredPages" id="Login.RequestMembership-CreatetheRequiredPages"></a>Create the Required Pages
</h2>

<p>
As with the basic setup, we want to make sure we have the required pages in place before we add in all the Snippets. Make sure the following <b>9</b> pages exist on your MODx Revo site (1 - 5 are the same as the basic setup, additional pages highlighted in green):
</p>

<ul>
<li>
<b>Login Page (1)</b> : the page containing your login form
</li>

<li>
<b>Forgot Password (2)</b> : the page where users can go when they forgot their password
</li>

<li>
<b>Reset Password Handler (3)</b> : the hidden page that will actually do the resetting of the password
</li>

<li>
<b>Members Home Page (4)</b> : the secret clubhouse, available only to valid members
</li>

<li>
<b>Come Again Soon (5)</b> : the page displayed upon successful logout
</li>

<li>
<b><font color="green">Request Membership (6)</font></b> : the page where users can request membership, i.e. the "Become a Member" page.
</li>

<li>
<b><font color="green">Request Pending (7)</font></b> : notifies the user that the user's request has been received
</li>

<li>
<b><font color="green">Membership Confirmation Handler (8)</font></b> : the hidden page that will actually register the user
</li>
</ul>

<p>
And lest we forget...
</p>

<ul>
<li>
<b>Home Page (9)</b> : we're just being thorough â€“ you probably already some page designated as your home page.
</li>
</ul>

<h2>
<a name="Login.RequestMembership-EnsureBasicPermissionsareinPlace" id="Login.RequestMembership-EnsureBasicPermissionsareinPlace"></a>Ensure Basic Permissions are in Place
</h2>

<p>
In case you haven't already, you'll want to prepare the necessary rights and permissions for users and resources on your site as described in the <a href="http://rtfm.modx.com/display/ADDON/Login.Basic+Setup#Login.BasicSetup-CreatetheNecessaryUserGroupsandResourceGroups" class="external-link" rel="nofollow">Basic Setup</a>. <font color="red">This must be in place before continuing!</font>
</p>

<h2>
<a name="Login.RequestMembership-AddSnippets" id="Login.RequestMembership-AddSnippets"></a>Add Snippets
</h2>

<h3>
<a name="Login.RequestMembership-LoginPage%281%29"></a>Login Page (1)
</h3>

<div class="note">
You don't have to spruce up your login page, so if you're at all unsure here, skip these bits with the <b>Personalize</b> Snippet and skip ahead a bit.
</div>

<p>
As before, we can use the same Login Snippet:
</p>

<pre class="brush: php">
    
&lt;div id="your_header"&gt;
[[!Personalize? &amp;yesChunk=`header_for_members` &amp;noChunk=`header_for_guests` &amp;ph=`name`]]
&lt;/div&gt;

    
</pre>
<div class="note">
It's important that the <b>Personalize</b> snippet is not cached!
</div>

<h4>
<a name="Login.RequestMembership-AddChunk%3Aheaderforguests"></a>Add Chunk: header_for_guests
</h4>

<p>
Create a chunk that contains something like the following:
</p>

<pre class="brush: php">
    
&lt;span id="logged_in_status"&gt;Signed in: [[+name]] (&lt;a href="[[~1? &amp;service=`logout`]]"&gt;Sign out&lt;/a&gt;)&lt;/span&gt;

    
</pre>
<p>
Note the special format of the logout link: you trigger the logout action by passing a parameter to the <em>Login</em> page.
</p>

<div class="note">
The syntax for passing parameters to a MODx URL tag is similar the way parameters are passed to Snippets; this ensures that the parameter gets correctly appended to the URL. The [[~1? &amp;service=`logout`]] tag would render two different ways depending on whether friendly URLs were enabled:
<ul>
<li>
<a href="http://yoursite.com/index.php?id=1&amp;service=logout" class="external-link" rel="nofollow">http://yoursite.com/index.php?id=1&amp;service=logout</a>
</li>

<li>
<a href="http://yoursite.com/login?service=logout" class="external-link" rel="nofollow">http://yoursite.com/login?service=logout</a>
</li>
</ul>

<p>
Note that MODx automatically handled the placement of the "?"
</p>
</div>

<p>
We could do the same thing for any parts of our page that need to change how they look based on whether a user is logged-in or not. In the example of FoxyCart, their site also added some menu options that appeared when when a user had successfully logged in. All you would need to do is create another instance of the <a href="http://modx.com/extras/package/personalize" class="external-link" rel="nofollow">Personalize</a> Snippet with its corresponding <b>yesChunk</b> and <b>noChunk</b>. We're going to assume you get the idea and you can repeat as needed.
</p>

<h3>
<a name="Login.RequestMembership-LoginPage%281%29"></a>Login Page (1)
</h3>

<p>
We can basically use the same Snippet call as the Basic setup, but we're going to add one more parameter: <b>redirectToPrior</b>. This will enable users to login from any page, then return to that same page after completing the login.
</p>

<pre class="brush: php">
    
&lt;div class="loginForm"&gt;
    &lt;div class="loginMessage"&gt;[[+errors]]&lt;/div&gt;
    &lt;div class="loginLogin"&gt;
        &lt;form class="loginLoginForm" action="[[~[[*id]]]]" method="post"&gt;
            &lt;fieldset class="loginLoginFieldset"&gt;
                &lt;legend class="loginLegend"&gt;[[+actionMsg]]&lt;/legend&gt;
                &lt;label class="loginUsernameLabel"&gt;[[%login.username]]
                    &lt;input class="loginUsername" type="text" name="username" /&gt;
                &lt;/label&gt;
                
                &lt;label class="loginPasswordLabel"&gt;[[%login.password]]
                    &lt;input class="loginPassword" type="password" name="password" /&gt;
                &lt;/label&gt;
                &lt;input class="returnUrl" type="hidden" name="returnUrl" value="[[+request_uri]]" /&gt;

                [[+login.recaptcha_html]]
                
                &lt;input class="loginLoginValue" type="hidden" name="service" value="login" /&gt;
                &lt;span class="loginLoginButton"&gt;&lt;input type="submit" name="Login" value="[[+actionMsg]]" /&gt;&lt;/span&gt;
            &lt;/fieldset&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;a href="[[~2]]"&gt;Forgot your Password?&lt;/a&gt;  &lt;a href="[[~6]]"&gt;Apply for Membership&lt;/a&gt;

    
</pre>
<p>
Again, you may choose to put the "Forgot Password" and "Apply for Membership" links outside of your Chunk and put them in the template alongside the Snippet call.
</p>

<h3>
<a name="Login.RequestMembership-ForgotPassword%282%29"></a>Forgot Password (2)
</h3>

<p>
This page functions identically as it did in the Basic Setup: it provides a form where forgetful users can request that their password be reset. The form submission triggers an email to be sent. The email contains a link to the "Reset Passsword Handler (3)" page.
</p>

<h3>
<a name="Login.RequestMembership-ResetPasswordHandler%283%29"></a>Reset Password Handler (3)
</h3>

<p>
This page functions in exactly the way it did in the Basic Setup: it handles incoming links from emails and resets passwords as appropriate.
</p>

<h3>
<a name="Login.RequestMembership-MembersHomePage%284%29"></a>Members Home Page (4)
</h3>

<p>
You'll notice that in this scenario, we have effectively bypassed this page entirely. It's still good to have it there: by its membership in a "Members Only" resource group, it represents content that is only visible to validated members. In the FoxyCart example, the menu that was displayed only to the members represented "Members Only" pages like this one. Just create the necessary pages you need, and adjust their access permissions so they belong to the "Members Only" resource group.
</p>

<h3>
<a name="Login.RequestMembership-ComeAgainSoon%285%29"></a>Come Again Soon (5)
</h3>

<p>
This page doesn't have to change any from the basic setup. Its purpose is simply to message the user; you can throw a link back to the login page if you want.
</p>

<h3>
<a name="Login.RequestMembership-RequestMembership%286%29"></a>Request Membership (6)
</h3>

<p>
Next, let's handle the form that allows users to apply for membership on your site. The <a href="display/ADDON/Login.Register" title="Login.Register">Register</a> Snippet acts on a form that is included in-line on the page (as opposed to a form inside of a chunk).
</p>

<pre class="brush: php">
    
&lt;p&gt;Thank you for your interest in our site! Check your email for an activation link.  
You will need to click this link before you can log into our site.&lt;/p&gt;

    
</pre>
<h3>
<a name="Login.RequestMembership-MembershipConfirmationHandler%288%29"></a>Membership Confirmation Handler (8)
</h3>

<p>
This page handles the incoming links from the emails sent by the <b>Register</b> Snippet. The <b>ConfirmRegister</b> Snippet handles this processing; in our example, we want it to redirect users to the home page (page 9 in our example):
</p>

<pre class="brush: php">
    
&lt;?php
 $to = "recipient@example.com";
 $subject = "Hi!";
 $body = "Hi,\n\nHow are you?";
 if (mail($to, $subject, $body)) {
   echo("&lt;p&gt;Message successfully sent!&lt;/p&gt;");
  } else {
   echo("&lt;p&gt;Message delivery failed...&lt;/p&gt;");
  }
 ?&gt;

    
</pre>
<p>
<em>* Script from <a href="http://email.about.com/od/emailprogrammingtips/qt/How_to_Send_Email_from_a_PHP_Script.htm" class="external-link" rel="nofollow">About.com</a></em>
</p>

<p>
You can also try configuring your site to use SMTP to send emails; this is often preferable because it relies on a dedicated email server (e.g. yahoo.com or google.com) to send your messages. Under System-&gt;Settings, search for SMTP, and you'll find a handful of settings that can help you set that up.
</p>

<h3>
<a name="Login.RequestMembership-Aftersubmittingtheregistrationform%2CIgetawhitepage."></a>After submitting the registration form, I get a white page.
</h3>

<p>
This issue shouldn't come up on recent versions of MODX, but to verify this behavior, try visiting your "Request Membership" sign-up page and submit the form without any data in it. If you get nothing but a completely empty blank white page, the cause may be due to your PHP configuration.
</p>

<p>
A simple test here is the following script:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">if</span> (function_exists('mb_ereg')) {
 print 'Yes, the multibyte function exists';
}
<span class="code-keyword">else</span> {
 print 'No, the function does not exist. The Register Snippet may fail.';
}
</pre>
</div>
</div>

<p>
The solution involves recompiling PHP. You must have the <b>mbstring</b> library installed and you must ensure that you have not included the <em>--disable-mbregex</em> option.
</p>

<p>
See <a href="http://modxcms.com/forums/index.php/topic,63778.0.html" class="external-link" rel="nofollow">this forum post</a> for more details.
</p>