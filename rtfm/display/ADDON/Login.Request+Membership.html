<div>
<ul>
<li>
<a href='#Login.RequestMembership-Outline'>Outline</a>
</li>

<li>
<a href='#Login.RequestMembership-DownloadtheNecessarySnippets'>Download the Necessary Snippets</a>
</li>

<li>
<a href='#Login.RequestMembership-CreatetheRequiredPages'>Create the Required Pages</a>
</li>

<li>
<a href='#Login.RequestMembership-EnsureBasicPermissionsareinPlace'>Ensure Basic Permissions are in Place</a>
</li>

<li>
<a href='#Login.RequestMembership-AddSnippets'>Add Snippets</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#Login.RequestMembership-LoginPage%281%29'>Login Page (1)</a>
</li>

<li>
<a href='#Login.RequestMembership-TheHomepageTemplate'>The Homepage Template</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#Login.RequestMembership-AddChunk%3Aheaderforguests'>Add Chunk: header_for_guests</a>
</li>

<li>
<a href='#Login.RequestMembership-AddChunk%3Aheaderformembers'>Add Chunk: header_for_members</a>
</li>
</ul>
</li>

<li>
<a href='#Login.RequestMembership-LoginPage%281%29'>Login Page (1)</a>
</li>

<li>
<a href='#Login.RequestMembership-ForgotPassword%282%29'>Forgot Password (2)</a>
</li>

<li>
<a href='#Login.RequestMembership-ResetPasswordHandler%283%29'>Reset Password Handler (3)</a>
</li>

<li>
<a href='#Login.RequestMembership-MembersHomePage%284%29'>Members Home Page (4)</a>
</li>

<li>
<a href='#Login.RequestMembership-ComeAgainSoon%285%29'>Come Again Soon (5)</a>
</li>

<li>
<a href='#Login.RequestMembership-RequestMembership%286%29'>Request Membership (6)</a>
</li>

<li>
<a href='#Login.RequestMembership-RequestPending%287%29'>Request Pending (7)</a>
</li>

<li>
<a href='#Login.RequestMembership-MembershipConfirmationHandler%288%29'>Membership Confirmation Handler (8)</a>
</li>
</ul>
</li>

<li>
<a href='#Login.RequestMembership-Testing%3AMakingitallWork'>Testing: Making it all Work</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#Login.RequestMembership-RequestMembership'>Request Membership</a>
</li>

<li>
<a href='#Login.RequestMembership-CheckforVerificationEmail'>Check for Verification Email</a>
</li>

<li>
<a href='#Login.RequestMembership-Login'>Login</a>
</li>
</ul>
</li>

<li>
<a href='#Login.RequestMembership-Errors'>Errors</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#Login.RequestMembership-WhenIsubmittherequestmembershipform%2Cthepagedoesnotredirect%21'>When I submit the request membership form, the page does not redirect!</a>
</li>

<li>
<a href='#Login.RequestMembership-WhenIgettheActivationemail%2Cthemessageisblank%21'>When I get the Activation email, the message is blank!</a>
</li>

<li>
<a href='#Login.RequestMembership-InevergettheEmailsthatMODxsends%21'>I never get the Emails that MODx sends!</a>
</li>

<li>
<a href='#Login.RequestMembership-Aftersubmittingtheregistrationform%2CIgetawhitepage.'>After submitting the registration form, I get a white page.</a>
</li>
</ul>
</li>
</ul>
</div>

<h2>
<a name="Login.RequestMembership-Outline"></a>Outline
</h2>

<p>
If you've followed the tutorial for the <a href="/display/ADDON/Login.Basic+Setup" title="Login.Basic Setup">Basic Setup</a>, then it's time to try for a more thorough implementation of the Login Snippet where <font color="green"><em>users can apply for site membership themselves</em></font>. Once you've completed this tutorial, visitors to your site will be able to request membership by themselves and you will not have to add users manually.
</p>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<font color="red">Do not try to use extended user fields yet.</font> First get the registration process working using the standard user fields. See the next tutorial for setting up user profiles and using extended user fields.
</td>
</tr>
</table>
</div>

<p>
A good example for what we're trying to accomplish in this tutorial is visible on the <a href="http://forum.foxycart.com/" class="external-link" rel="nofollow">FoxyCart Forum</a>: when you're viewing the forums as a guest, the header displays a login link, but after you've signed in, additional functionality is unlocked. You've seen this type of thing on many sites.
</p>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
The FoxyCart forum is not running MODx: we're just using a simplified version of their login flow as an example.
</td>
</tr>
</table>
</div>

<p>
The steps go something like this:
</p>

<p>
1. <b>Visit the homepage as a guest:</b> the header displays a link to the login page.
</p>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/35094671/Foxy+Cart+Header.jpg?version=1&amp;modificationDate=1303606748000" style="border: 0px solid black" /></span>
</p>

<p>
2. <b>Login:</b> The Login page contains links to the "Forgot Password" and to a "Apply for Membership" page.
</p>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/35094671/The+FoxyCart+Forum+-+Sign+In.jpg?version=1&amp;modificationDate=1303606758000" style="border: 0px solid black" /></span>
</p>

<p>
3. <b>Redirect to the Homepage:</b> after a successful login, you are returned to the homepage, but this time, additional functionality is unlocked.
</p>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/35094671/The+FoxyCart+Forum+-+Logged+In.jpg?version=1&amp;modificationDate=1303606753000" style="border: 0px solid black" /></span>
</p>

<p>
4. <b>Logout:</b> When you're done visiting the site, you can click the "Logout" link and land on the "Come Again" page.
</p>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/35094671/The+FoxyCart+Forum+-+Sign+Out.jpg?version=1&amp;modificationDate=1303606763000" style="border: 0px solid black" /></span>
</p>

<p>
Make sense? It's pretty similar to what we did before in the <a href="/display/ADDON/Login.Basic+Setup" title="Login.Basic Setup">Basic Setup</a>, but there are a few extra things going on, so we need a few extra pages. Most importantly, we'll need to integrate both the <a href="/display/ADDON/Login.Register" title="Login.Register">Register</a> and the <a href="http://modx.com/extras/package/personalize" class="external-link" rel="nofollow">Personalize</a> Snippets, and we'll need to shuffle around a couple other components from the <a href="/display/ADDON/Login.Basic+Setup" title="Login.Basic Setup">Basic Setup</a> tutorial.
</p>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
This tutorial makes use of related and complimentary Snippets!
</td>
</tr>
</table>
</div>

<p>
Let's get started!
</p>

<hr />

<h2>
<a name="Login.RequestMembership-DownloadtheNecessarySnippets"></a>Download the Necessary Snippets
</h2>

<p>
We're augmenting the functionality offered by the default Login snippet, so make sure that you also download the <a href="http://modx.com/extras/package/personalize" class="external-link" rel="nofollow">Personalize</a> Snippet. It is available via package management.
</p>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/35094671/Personalize+Snippet.jpg?version=1&amp;modificationDate=1303607956000" style="border: 0px solid black" /></span>
</p>

<p>
Be sure to download the latest version (the one by BobRay). Bob says he may have goofed when submitting his upgrade, so it shows up as a separate package.
</p>

<hr />

<h2>
<a name="Login.RequestMembership-CreatetheRequiredPages"></a>Create the Required Pages
</h2>

<p>
As with the basic setup, we want to make sure we have the required pages in place before we add in all the Snippets. Make sure the following <b>9</b> pages exist on your MODx Revo site (1 - 5 are the same as the basic setup, additional pages highlighted in green):
</p>

<ul>
<li>
<b>Login Page (1)</b> : the page containing your login form
</li>

<li>
<b>Forgot Password (2)</b> : the page where users can go when they forgot their password
</li>

<li>
<b>Reset Password Handler (3)</b> : the hidden page that will actually do the resetting of the password
</li>

<li>
<b>Members Home Page (4)</b> : the secret clubhouse, available only to valid members
</li>

<li>
<b>Come Again Soon (5)</b> : the page displayed upon successful logout
</li>

<li>
<b><font color="green">Request Membership (6)</font></b> : the page where users can request membership, i.e. the "Become a Member" page.
</li>

<li>
<b><font color="green">Request Pending (7)</font></b> : notifies the user that the user's request has been received
</li>

<li>
<b><font color="green">Membership Confirmation Handler (8)</font></b> : the hidden page that will actually register the user
</li>
</ul>

<p>
And lest we forget...
</p>

<ul>
<li>
<b>Home Page (9)</b> : we're just being thorough – you probably already some page designated as your home page.
</li>
</ul>

<h2>
<a name="Login.RequestMembership-EnsureBasicPermissionsareinPlace"></a>Ensure Basic Permissions are in Place
</h2>

<p>
In case you haven't already, you'll want to prepare the necessary rights and permissions for users and resources on your site as described in the <a href="http://rtfm.modx.com/display/ADDON/Login.Basic+Setup#Login.BasicSetup-CreatetheNecessaryUserGroupsandResourceGroups" class="external-link" rel="nofollow">Basic Setup</a>. <font color="red">This must be in place before continuing!</font>
</p>

<h2>
<a name="Login.RequestMembership-AddSnippets"></a>Add Snippets
</h2>

<h3>
<a name="Login.RequestMembership-LoginPage%281%29"></a>Login Page (1)
</h3>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
You don't have to spruce up your login page, so if you're at all unsure here, skip these bits with the <b>Personalize</b> Snippet and skip ahead a bit.
</td>
</tr>
</table>
</div>

<p>
As before, we can use the same Login Snippet:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[!Login? &amp;loginTpl=`lgnLoginTpl` &amp;logoutTpl=`lgnLogoutTpl` &amp;errTpl=`lgnErrTpl` &amp;logoutResourceId=`5`]] 
</pre>
</div>
</div>

<h3>
<a name="Login.RequestMembership-TheHomepageTemplate"></a>The Homepage Template
</h3>

<p>
That nifty banner link on your homepage that displays "Logout" when you are signed in and "Login" when you're not can be accomplished via the <a href="http://modx.com/extras/package/personalize" class="external-link" rel="nofollow">Personalize</a> Snippet.
</p>

<p>
To make use of it, put something like the following in your homepage template (add HTML to taste):
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;div id=<span class="code-quote">"your_header"</span>&gt;
[[!Personalize? &amp;yesChunk=`header_for_members` &amp;noChunk=`header_for_guests` &amp;ph=`name`]]
&lt;/div&gt;
</pre>
</div>
</div>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
It's important that the <b>Personalize</b> snippet is not cached!
</td>
</tr>
</table>
</div>

<h4>
<a name="Login.RequestMembership-AddChunk%3Aheaderforguests"></a>Add Chunk: header_for_guests
</h4>

<p>
Create a chunk that contains something like the following:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;span id=<span class="code-quote">"logged_in_status"</span>&gt;Not signed in (&lt;a href=<span class="code-quote">"[[~1]]"</span>&gt;Sign in&lt;/a&gt;)&lt;/span&gt;
</pre>
</div>
</div>

<p>
The important thing there is that it links back to the login form.
</p>

<h4>
<a name="Login.RequestMembership-AddChunk%3Aheaderformembers"></a>Add Chunk: header_for_members
</h4>

<p>
Next create a chunk that will be displayed to members when they are logged in:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;span id=<span class="code-quote">"logged_in_status"</span>&gt;Signed in: [[+name]] (&lt;a href=<span class="code-quote">"[[~1? &amp;service=`logout`]]"</span>&gt;Sign out&lt;/a&gt;)&lt;/span&gt;
</pre>
</div>
</div>

<p>
Note the special format of the logout link: you trigger the logout action by passing a parameter to the <em>Login</em> page.
</p>

<div class='panelMacro'>
<table class='noteMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
The syntax for passing parameters to a MODx URL tag is similar the way parameters are passed to Snippets; this ensures that the parameter gets correctly appended to the URL. The [[~1? &amp;service=`logout`]] tag would render two different ways depending on whether friendly URLs were enabled:
<ul>
<li>
<a href="http://yoursite.com/index.php?id=1&amp;service=logout" class="external-link" rel="nofollow">http://yoursite.com/index.php?id=1&amp;service=logout</a>
</li>

<li>
<a href="http://yoursite.com/login?service=logout" class="external-link" rel="nofollow">http://yoursite.com/login?service=logout</a>
</li>
</ul>

<p>
Note that MODx automatically handled the placement of the "?"
</p>
</td>
</tr>
</table>
</div>

<p>
We could do the same thing for any parts of our page that need to change how they look based on whether a user is logged-in or not. In the example of FoxyCart, their site also added some menu options that appeared when when a user had successfully logged in. All you would need to do is create another instance of the <a href="http://modx.com/extras/package/personalize" class="external-link" rel="nofollow">Personalize</a> Snippet with its corresponding <b>yesChunk</b> and <b>noChunk</b>. We're going to assume you get the idea and you can repeat as needed.
</p>

<h3>
<a name="Login.RequestMembership-LoginPage%281%29"></a>Login Page (1)
</h3>

<p>
We can basically use the same Snippet call as the Basic setup, but we're going to add one more parameter: <b>redirectToPrior</b>. This will enable users to login from any page, then return to that same page after completing the login.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[!Login? 
&amp;loginTpl=`lgnLoginTpl` 
&amp;logoutTpl=`lgnLogoutTpl` 
&amp;errTpl=`lgnErrTpl` 
&amp;logoutResourceId=`5` 
&amp;redirectToPrior=`1`]] 
</pre>
</div>
</div>

<p>
We can use the same <b>loginTpl</b> Chunk to display the login form, but we want to add a link to where the user can "Request Membership" :
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;div class=<span class="code-quote">"loginForm"</span>&gt;
    &lt;div class=<span class="code-quote">"loginMessage"</span>&gt;[[+errors]]&lt;/div&gt;
    &lt;div class=<span class="code-quote">"loginLogin"</span>&gt;
        &lt;form class=<span class="code-quote">"loginLoginForm"</span> action=<span class="code-quote">"[[~[[*id]]]]"</span> method=<span class="code-quote">"post"</span>&gt;
            &lt;fieldset class=<span class="code-quote">"loginLoginFieldset"</span>&gt;
                &lt;legend class=<span class="code-quote">"loginLegend"</span>&gt;[[+actionMsg]]&lt;/legend&gt;
                &lt;label class=<span class="code-quote">"loginUsernameLabel"</span>&gt;[[%login.username]]
                    &lt;input class=<span class="code-quote">"loginUsername"</span> type=<span class="code-quote">"text"</span> name=<span class="code-quote">"username"</span> /&gt;
                &lt;/label&gt;
                
                &lt;label class=<span class="code-quote">"loginPasswordLabel"</span>&gt;[[%login.password]]
                    &lt;input class=<span class="code-quote">"loginPassword"</span> type=<span class="code-quote">"password"</span> name=<span class="code-quote">"password"</span> /&gt;
                &lt;/label&gt;
                &lt;input class=<span class="code-quote">"returnUrl"</span> type=<span class="code-quote">"hidden"</span> name=<span class="code-quote">"returnUrl"</span> value=<span class="code-quote">"[[+request_uri]]"</span> /&gt;

                [[+login.recaptcha_html]]
                
                &lt;input class=<span class="code-quote">"loginLoginValue"</span> type=<span class="code-quote">"hidden"</span> name=<span class="code-quote">"service"</span> value=<span class="code-quote">"login"</span> /&gt;
                &lt;span class=<span class="code-quote">"loginLoginButton"</span>&gt;&lt;input type=<span class="code-quote">"submit"</span> name=<span class="code-quote">"Login"</span> value=<span class="code-quote">"[[+actionMsg]]"</span> /&gt;&lt;/span&gt;
            &lt;/fieldset&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;a href=<span class="code-quote">"[[~2]]"</span>&gt;Forgot your Password?&lt;/a&gt;  &lt;a href=<span class="code-quote">"[[~6]]"</span>&gt;Apply <span class="code-keyword">for</span> Membership&lt;/a&gt;
</pre>
</div>
</div>

<p>
Again, you may choose to put the "Forgot Password" and "Apply for Membership" links outside of your Chunk and put them in the template alongside the Snippet call.
</p>

<h3>
<a name="Login.RequestMembership-ForgotPassword%282%29"></a>Forgot Password (2)
</h3>

<p>
This page functions identically as it did in the Basic Setup: it provides a form where forgetful users can request that their password be reset. The form submission triggers an email to be sent. The email contains a link to the "Reset Passsword Handler (3)" page.
</p>

<h3>
<a name="Login.RequestMembership-ResetPasswordHandler%283%29"></a>Reset Password Handler (3)
</h3>

<p>
This page functions in exactly the way it did in the Basic Setup: it handles incoming links from emails and resets passwords as appropriate.
</p>

<h3>
<a name="Login.RequestMembership-MembersHomePage%284%29"></a>Members Home Page (4)
</h3>

<p>
You'll notice that in this scenario, we have effectively bypassed this page entirely. It's still good to have it there: by its membership in a "Members Only" resource group, it represents content that is only visible to validated members. In the FoxyCart example, the menu that was displayed only to the members represented "Members Only" pages like this one. Just create the necessary pages you need, and adjust their access permissions so they belong to the "Members Only" resource group.
</p>

<h3>
<a name="Login.RequestMembership-ComeAgainSoon%285%29"></a>Come Again Soon (5)
</h3>

<p>
This page doesn't have to change any from the basic setup. Its purpose is simply to message the user; you can throw a link back to the login page if you want.
</p>

<h3>
<a name="Login.RequestMembership-RequestMembership%286%29"></a>Request Membership (6)
</h3>

<p>
Next, let's handle the form that allows users to apply for membership on your site. The <a href="/display/ADDON/Login.Register" title="Login.Register">Register</a> Snippet acts on a form that is included in-line on the page (as opposed to a form inside of a chunk).
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;h2&gt;Register&lt;/h2&gt;

[[!Register?
    &amp;submitVar=`registerbtn`
    &amp;activationResourceId=`8`
    &amp;activationEmailTpl=`ActivationEmailTpl`
    &amp;activationEmailSubject=`Thanks <span class="code-keyword">for</span> Registering!`
    &amp;submittedResourceId=`7`
    &amp;usergroups=`Members`
]]


 
&lt;div class=<span class="code-quote">"register"</span>&gt;
    &lt;div class=<span class="code-quote">"registerMessage"</span>&gt;[[+error.message]]&lt;/div&gt;
     
    &lt;form class=<span class="code-quote">"form"</span> action=<span class="code-quote">"[[~[[*id]]]]"</span> method=<span class="code-quote">"post"</span>&gt;
        &lt;input type=<span class="code-quote">"hidden"</span> name=<span class="code-quote">"nospam:blank"</span> value="" /&gt;
         
        &lt;label <span class="code-keyword">for</span>=<span class="code-quote">"username"</span>&gt;[[%register.username? &amp;namespace=`login` &amp;topic=`register`]]
            &lt;span class=<span class="code-quote">"error"</span>&gt;[[+error.username]]&lt;/span&gt;
        &lt;/label&gt;
        &lt;input type=<span class="code-quote">"text"</span> name=<span class="code-quote">"username:required:minLength=6"</span> id=<span class="code-quote">"username"</span> value=<span class="code-quote">"[[+username]]"</span> /&gt;
         
        &lt;label <span class="code-keyword">for</span>=<span class="code-quote">"password"</span>&gt;[[%register.password]]
            &lt;span class=<span class="code-quote">"error"</span>&gt;[[+error.password]]&lt;/span&gt;
        &lt;/label&gt;
        &lt;input type=<span class="code-quote">"password"</span> name=<span class="code-quote">"password:required:minLength=6"</span> id=<span class="code-quote">"password"</span> value=<span class="code-quote">"[[+password]]"</span> /&gt;
         
        &lt;label <span class="code-keyword">for</span>=<span class="code-quote">"password_confirm"</span>&gt;[[%register.password_confirm]]
            &lt;span class=<span class="code-quote">"error"</span>&gt;[[+error.password_confirm]]&lt;/span&gt;
        &lt;/label&gt;
        &lt;input type=<span class="code-quote">"password"</span> name=<span class="code-quote">"password_confirm:password_confirm=`password`"</span> id=<span class="code-quote">"password_confirm"</span> value=<span class="code-quote">"[[+password_confirm]]"</span> /&gt;
         
        &lt;label <span class="code-keyword">for</span>=<span class="code-quote">"fullname"</span>&gt;[[%register.fullname]]
            &lt;span class=<span class="code-quote">"error"</span>&gt;[[+error.fullname]]&lt;/span&gt;
        &lt;/label&gt;
        &lt;input type=<span class="code-quote">"text"</span> name=<span class="code-quote">"fullname:required"</span> id=<span class="code-quote">"fullname"</span> value=<span class="code-quote">"[[+fullname]]"</span> /&gt;
         
        &lt;label <span class="code-keyword">for</span>=<span class="code-quote">"email"</span>&gt;[[%register.email]]
            &lt;span class=<span class="code-quote">"error"</span>&gt;[[+error.email]]&lt;/span&gt;
        &lt;/label&gt;
        &lt;input type=<span class="code-quote">"text"</span> name=<span class="code-quote">"email:email"</span> id=<span class="code-quote">"email"</span> value=<span class="code-quote">"[[+email]]"</span> /&gt;
         
        &lt;br class=<span class="code-quote">"clear"</span> /&gt;
         
        &lt;div class=<span class="code-quote">"form-buttons"</span>&gt;
            &lt;input type=<span class="code-quote">"submit"</span> name=<span class="code-quote">"registerbtn"</span> value=<span class="code-quote">"Register"</span> /&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;
</pre>
</div>
</div>

<p>
It needs to reference two other pages: the <b>Request Pending (7)</b> page, and the <b>Membership Confirmation Handler (8)</b> page.
</p>

<h3>
<a name="Login.RequestMembership-RequestPending%287%29"></a>Request Pending (7)
</h3>

<p>
This page's job is to inform the user that their request is being processed and that they should check their email for an activation link. Here's a sample message:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;p&gt;Thank you <span class="code-keyword">for</span> your interest in our site! Check your email <span class="code-keyword">for</span> an activation link.  
You will need to click <span class="code-keyword">this</span> link before you can log into our site.&lt;/p&gt;
</pre>
</div>
</div>

<h3>
<a name="Login.RequestMembership-MembershipConfirmationHandler%288%29"></a>Membership Confirmation Handler (8)
</h3>

<p>
This page handles the incoming links from the emails sent by the <b>Register</b> Snippet. The <b>ConfirmRegister</b> Snippet handles this processing; in our example, we want it to redirect users to the home page (page 9 in our example):
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[ConfirmRegister? &amp;redirectTo=`9`]]
</pre>
</div>
</div>

<p>
----------------------
</p>

<h2>
<a name="Login.RequestMembership-Testing%3AMakingitallWork"></a>Testing: Making it all Work
</h2>

<p>
Now that we have the pieces laid out, let's try to make this work.
</p>

<h3>
<a name="Login.RequestMembership-RequestMembership"></a>Request Membership
</h3>

<p>
Go to your <b>Request Membership (6)</b> page. Verify that the form shows up and go ahead and try creating a new user – use a different email address for this than the one you have assigned to your MODX manager user.
</p>

<p>
If the page doesn't redirect correctly, verify that you have a valid page ID for the <b>&amp;submittedResourceId</b> parameter.
</p>

<ol>
<li>
<b>CHECK:</b> After submitting the form, you should be redirected to the <b>Request Pending (7)</b> page.
</li>

<li>
<b>CHECK:</b> After submitting the form, you should see the new user created under <b>Security --&gt; Manage Users</b>. It will be grayed out because the user is not yet active until they confirm their email address by clicking the link that was emailed to them.
</li>
</ol>

<p>
<span class="image-wrap" style=""><img src="/download/attachments/35094671/New_inactive_user.jpg?version=1&amp;modificationDate=1339727602000" style="border: 0px solid black" /></span>
</p>

<h3>
<a name="Login.RequestMembership-CheckforVerificationEmail"></a>Check for Verification Email
</h3>

<p>
Check your email for email message containing the confirmation link. There is a section below for troubleshooting email functionality on your server.
</p>

<p>
Also check your spam filters on your your email account, and keep in mind it may take a minute or two for the email to arrive.
</p>

<ol>
<li>
<b>CHECK:</b> Did you get the confirmation email? You can customize the text of the email by changing the content of the <b>ActivationEmailTpl</b> Chunk.
</li>

<li>
<b>CHECK:</b> Is the confirmation link in the email correct? When you click it, does it take you to the <b>Membership Confirmation Handler (8)</b> page? If the link is not correct, double-check the <b>&amp;activationResourceId</b> parameter and make sure it's pointing to your <b>Membership Confirmation Handler (8)</b> page.
</li>

<li>
<b>CHECK:</b> Make sure that the <b>ConfirmRegister</b> Snippet on the <b>Membership Confirmation Handler (8)</b> page works: if your template isn't displaying [[<b>content]] correctly, then the *ConfirmRegister</b> Snippet may never execute. The expected behavior is that clicking the activation link in your email message should take to to the <b>Membership Confirmation Handler (8)</b> page, which should <em>immediately</em> redirect to the home page (check the <b>&amp;redirectTo</b> parameter in the <b>ConfirmRegister</b> Snippet.
</li>

<li>
<b>CHECK:</b> Verify that your new user is not set to <font color="green"><b>Active</b></font> under <b>Security -&gt; Manage Users</b>. This confirms that the user was activated!
</li>
</ol>

<h3>
<a name="Login.RequestMembership-Login"></a>Login
</h3>

<p>
Using a different browser other than the one you're logged into the MODX manager, navigate to your <b>Login Page (1)</b> (as was set up in the <a href="/display/ADDON/Login.Basic+Setup" title="Login.Basic Setup">basic tutorial</a>. Try to log in using the newly created user.
</p>

<ol>
<li>
<b>CHECK:</b> is the login successful? Does the page redirect to your <b>Members Home Page (4)</b>? If not, double-check the <b>&amp;loginResourceId</b> parameter in your <b>Login</b> Snippet call.
</li>

<li>
<b>CHECK:</b> is the <b>Members Home Page (4)</b> publicly accessible? You might need a 3rd browser for this, but try visiting the Members Home Page in a browser where you are not logged in to any part of the site. You should see a 404 page.
</li>

<li>
<b>CHECK:</b> Can you log out? It's best to put a logout link on your Members Home Page somewhere. See the basic tutorial for how to set up a logout link. In a pinch, visit your login page and append <b>?service=logout</b> to the URL.
</li>
</ol>

<p>
----------------------
</p>

<h2>
<a name="Login.RequestMembership-Errors"></a>Errors
</h2>

<h3>
<a name="Login.RequestMembership-WhenIsubmittherequestmembershipform%2Cthepagedoesnotredirect%21"></a>When I submit the request membership form, the page does not redirect!
</h3>

<p>
Sometimes the form submits, the user <em>IS</em> created, but the page does not redirect: the user sees the same form they filled out. What's going on?
</p>

<p>
Triple-check the page ID you have set the <b>&amp;submittedResourceId</b> parameter. If the page ID does not exist on your site, the user will be created, but the redirect will fail.
</p>

<h3>
<a name="Login.RequestMembership-WhenIgettheActivationemail%2Cthemessageisblank%21"></a>When I get the Activation email, the message is blank!
</h3>

<p>
The cause is almost certainly that you do not have a Chunk by the name listed for the <b>&amp;activationEmailTpl</b> parameter. The default install of the Login package uses a Chunk named <b>lgnActivateEmailTpl</b>, whereas the tutorial here used one named <b>ActivateEmailTpl</b>.
</p>

<h3>
<a name="Login.RequestMembership-InevergettheEmailsthatMODxsends%21"></a>I never get the Emails that MODx sends!
</h3>

<p>
Email configuration is unfortunately complex and differs from server to server. A good place to start is checking whether PHP can send emails. Try placing the following script on your site, then navigate to it in your browser:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php
 $to = <span class="code-quote">"recipient@example.com"</span>;
 $subject = <span class="code-quote">"Hi!"</span>;
 $body = <span class="code-quote">"Hi,\n\nHow are you?"</span>;
 <span class="code-keyword">if</span> (mail($to, $subject, $body)) {
   echo(<span class="code-quote">"&lt;p&gt;Message successfully sent!&lt;/p&gt;"</span>);
  } <span class="code-keyword">else</span> {
   echo(<span class="code-quote">"&lt;p&gt;Message delivery failed...&lt;/p&gt;"</span>);
  }
 ?&gt;
</pre>
</div>
</div>

<p>
<em>* Script from <a href="http://email.about.com/od/emailprogrammingtips/qt/How_to_Send_Email_from_a_PHP_Script.htm" class="external-link" rel="nofollow">About.com</a></em>
</p>

<p>
You can also try configuring your site to use SMTP to send emails; this is often preferable because it relies on a dedicated email server (e.g. yahoo.com or google.com) to send your messages. Under System-&gt;Settings, search for SMTP, and you'll find a handful of settings that can help you set that up.
</p>

<h3>
<a name="Login.RequestMembership-Aftersubmittingtheregistrationform%2CIgetawhitepage."></a>After submitting the registration form, I get a white page.
</h3>

<p>
This issue shouldn't come up on recent versions of MODX, but to verify this behavior, try visiting your "Request Membership" sign-up page and submit the form without any data in it. If you get nothing but a completely empty blank white page, the cause may be due to your PHP configuration.
</p>

<p>
A simple test here is the following script:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">if</span> (function_exists('mb_ereg')) {
 print 'Yes, the multibyte function exists';
}
<span class="code-keyword">else</span> {
 print 'No, the function does not exist. The Register Snippet may fail.';
}
</pre>
</div>
</div>

<p>
The solution involves recompiling PHP. You must have the <b>mbstring</b> library installed and you must ensure that you have not included the <em>--disable-mbregex</em> option.
</p>

<p>
See <a href="http://modxcms.com/forums/index.php/topic,63778.0.html" class="external-link" rel="nofollow">this forum post</a> for more details.
</p>