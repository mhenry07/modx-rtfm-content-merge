<div class='panelMacro'>
<table class='tipMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
This feature is available since v.1.0.0-pl
</td>
</tr>
</table>
</div>

<div>
<ul>
<li>
<a href='#FileDownloadR.Plugins-Events'>Events</a>
</li>

<li>
<a href='#FileDownloadR.Plugins-Properties'>Properties</a>
</li>

<li>
<a href='#FileDownloadR.Plugins-APIs'>APIs</a>
</li>
</ul>
</div>

<h2>
<a name="FileDownloadR.Plugins-Events"></a>Events
</h2>

<p>
There are still a few events that have been provided, because again, this is small script.
<br />
But the event spots are really useful:
</p>

<ul>
<li>
<b>OnLoad</b>
<br />
Just when the script is loaded, this event trigger also calls all the plugins that want to do their dependencies, for instance
</li>

<li>
<b>BeforeDirOpen</b>
<br />
Before the folder is scanned/opened
</li>

<li>
<b>AfterDirOpen</b>
<br />
After the folder is scanned/opened
</li>

<li>
<b>BeforeFileDownload</b>
<br />
Before the file is downloaded
</li>

<li>
<b>AfterFileDownload</b>
<br />
After the file is downloaded
</li>
</ul>

<p>
The complete reference actually is written directly in the <b>core/components/filedownload/plugins/filedownloadplugin.events.php</b> file, including their available properties and the expected results.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;?php

$events = array(
    'OnLoad' =&gt; array(
        'properties' =&gt; array(),
        'returnType' =&gt; array(
            NULL
        )
    ),
    'BeforeDirOpen' =&gt; array(
        'properties' =&gt; array(
            'dirPath'
        ),
        'returnType' =&gt; array(
            NULL,
            FALSE,
            '<span class="code-keyword">continue</span>'
        )
    ),
    'AfterDirOpen' =&gt; array(
        'properties' =&gt; array(
            'dirPath',
            'contents'
        ),
        'returnType' =&gt; array(
            NULL,
            FALSE,
            '<span class="code-keyword">continue</span>'
        )
    ),
    'BeforeFileDownload' =&gt; array(
        'properties' =&gt; array(
            'hash',
            'ctx',
            'filePath',
            'count'
        ),
        'returnType' =&gt; array(
            NULL,
            FALSE
        )
    ),
    'AfterFileDownload' =&gt; array(
        'properties' =&gt; array(
            'hash',
            'ctx',
            'filePath',
            'count'
        ),
        'returnType' =&gt; array(
            NULL
        )
    ),
);
<span class="code-keyword">return</span> $events;
</pre>
</div>
</div>

<h2>
<a name="FileDownloadR.Plugins-Properties"></a>Properties
</h2>

<p>
<b>&amp;plugins</b>
</p>

<p>
To call the plugins, you need to call it inside the snippet, as a JSON format, eg:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[!FileDownload?
&amp;getDir=`assets/files`
&amp;plugins=`[
    {
        <span class="code-quote">"name"</span>:<span class="code-quote">"[[++core_path]]components/filedownload/plugins/formit.formsave.plugin.php"</span>
        ,<span class="code-quote">"event"</span>:<span class="code-quote">"OnLoad"</span>
        ,<span class="code-quote">"strict"</span>:<span class="code-keyword">true</span>
    },{
        <span class="code-quote">"name"</span>:<span class="code-quote">"[[++core_path]]components/filedownload/plugins/formit.formsave.plugin.php"</span>
        ,<span class="code-quote">"event"</span>:<span class="code-quote">"AfterFileDownload"</span>
    },{
        <span class="code-quote">"name"</span>:<span class="code-quote">"FileDownloadEmailPlugin"</span>
        ,<span class="code-quote">"event"</span>:<span class="code-quote">"AfterFileDownload"</span>
    }
]`
&amp;emailProps=`{
    <span class="code-quote">"emailTpl"</span>:<span class="code-quote">"FileDownloadEmailChunk"</span>,
    <span class="code-quote">"emailSubject"</span>:<span class="code-quote">"New Downloader"</span>,
    <span class="code-quote">"emailTo"</span>:<span class="code-quote">"your@email.com"</span>,
    <span class="code-quote">"emailCC"</span>:<span class="code-quote">"your@other.email.com"</span>,
    <span class="code-quote">"emailBCC"</span>:<span class="code-quote">"your@secret.email.com"</span>,
    <span class="code-quote">"emailBCCName"</span>:<span class="code-quote">"secret"</span>
}`
]]
</pre>
</div>
</div>

<p>
In this example, I'm using 2 default plugins for examples, <b><a href="/display/ADDON/FormSave" title="FormSave">FormSave</a></b> (as file based) and <b>Email</b> (as a snippet), which are both depend on <a href="/display/ADDON/FormIt" title="FormIt">FormIt</a>.
<br />
These plugins will do:
</p>

<ul>
<li>OnLoad
<br />
Checks whether FormSave and Formit are available. If not, halt.
</li>

<li>AfterFileDownload
<br />
After the file is downloaded, store the information into FormSave, and then send email to the given addresses, with the chunk as provided
</li>
</ul>

<p>
The email's properties are using the <a href="/display/ADDON/FormIt" title="FormIt">FormIt</a>'s properties, because it IS the <a href="/display/ADDON/FormIt" title="FormIt">FormIt</a>'s hook.
</p>

<p>
The structure of the JSON is:
</p>

<ul>
<li>
<b>name</b>
<br />
The snippet's name or file path to the plugin file
</li>

<li>
<b>event</b>
<br />
Name of the event you want this to be applied
</li>

<li>
<b>strict</b> <em>(optional)</em>
<br />
Boolean (TRUE|FALSE), sets this particular plugin in a strict mode, which means if the return is <ins><b>FALSE</b></ins> the script should stop to process. This stopping process is only available on several particular events, so please refer to the Event triggers above.
</li>
</ul>

<p>
Multiple plugins and events must be called repeatedly, because they have different strictness statuses.
</p>

<h2>
<a name="FileDownloadR.Plugins-APIs"></a>APIs
</h2>

<p>
These are the APIs that can be used inside your plugin script:
</p>

<div class='table-wrap'>
<table class='confluenceTable'>
<tbody>
<tr>
<th class='confluenceTh'>
Instance
</th>
<th class='confluenceTh'>
Method
</th>
<th class='confluenceTh'>
Description
</th>
</tr>

<tr>
<td class='confluenceTd'>
$modx
</td>
<td class='confluenceTd'>
all modx's methods
</td>
<td class='confluenceTd'>
default MODX instance
</td>
</tr>

<tr>
<td class='confluenceTd'>
$fileDownload
</td>
<td class='confluenceTd'>
getConfig($key), getConfigs()
</td>
<td class='confluenceTd'>
gets the scriptProperties, eg the <b>&amp;emailProps</b> above
</td>
</tr>

<tr>
<td class='confluenceTd'>
$plugin
</td>
<td class='confluenceTd'>
getProperties()
</td>
<td class='confluenceTd'>
gets the custom properties of the plugin
</td>
</tr>

<tr>
<td class='confluenceTd'>
&nbsp;
</td>
<td class='confluenceTd'>
getAllEvents()
</td>
<td class='confluenceTd'>
gets all event triggers
</td>
</tr>

<tr>
<td class='confluenceTd'>
&nbsp;
</td>
<td class='confluenceTd'>
getAppliedEvents()
</td>
<td class='confluenceTd'>
gets the applied events for the particular plugin in the run-time process
</td>
</tr>
</tbody>
</table>
</div>

<p>
Now, you can use your imagination to add more features for this snippet.
</p>