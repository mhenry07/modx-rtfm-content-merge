<div>
<ul>
<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-CreatetheRequiredPages">Create the Required Pages</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-CreatetheNecessaryUserGroupsandResourceGroups">Create the Necessary User Groups and Resource Groups</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-AddSnippetstothePages">Add Snippets to the Pages</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-LoginPage%281%29">Login Page (1)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-ForgotPassword%282%29">Forgot Password (2)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-ResetPasswordHandler%283%29">Reset Password Handler (3)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-MembersHomePage%284%29">Members Home Page (4)</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-ComeAgainSoon%285%29">Come Again Soon (5)</a>
</li>
</ul>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-Optional">Optional</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-LogoutPage">Logout Page</a>
</li>
</ul>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-PossibleErrors">Possible Errors</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-Ican%27tlogin%5C%21">I can't log in!</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-Ican%27tlogout%5C%21">I can't log out!</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-Loginerrorsarenotdisplayed">Login errors are not displayed</a>
</li>

<li>
<a href="extras/revo/login/login.tutorials/login.basic-setup#Login.BasicSetup-ErrorHTTP500%28InternalServerError%29">Error HTTP 500 (Internal Server Error)</a>
</li>
</ul>
</li>
</ul>
</div>

<p>
This tutorial catalogs which pages you need to set up and the Snippets that belong on each page. At the end of this tutorial, you will have a setup which will allow users to log in via the front-end of your website, but the <font color="red">users must be manually created by an admin in the manager</font>. There is a <a href="display/ADDON/Login.Request+Membership" title="Login.Request Membership">separate turorial</a> for establishing a process where users can request membership themselves.
</p>

<p>
Even a basic setup of a login portal involves a lot of inter-related parts, and the setup demonstrated here puts pretty much everything on its own page. A cleaner implementation might involve putting some of the functions listed below inside chunks or templates instead of on their own dedicated pages, but this page should give enough information to get a login portal established.
</p>

<div class="tip">
All the pages here use a sample <strong>page_id</strong> for reference.
</div>

<hr />

<h2>
<a name="Login.BasicSetup-CreatetheRequiredPages" id="Login.BasicSetup-CreatetheRequiredPages"></a>Create the Required Pages
</h2>

<p>
Before we add all the Snippets that do all the dirty work, let's first add the following <strong>5</strong> pages to your MODx Revo site:
</p>

<ul>
<li>
<strong>Login Page (1)</strong> : the page containing your login form
</li>

<li>
<strong>Forgot Password (2)</strong> : the page where users can go when they forgot their password
</li>

<li>
<strong>Reset Password Handler (3)</strong> : the hidden page that will actually do the resetting of the password
</li>

<li>
<strong>Members Home Page (4)</strong> : the secret clubhouse, available only to valid members
</li>

<li>
<strong>Come Again Soon (5)</strong> : the page displayed upon successful logout
</li>
</ul>

<p>
Next, you'll want to prepare the necessary rights and permissions for users and resources on your site.
</p>

<hr />

<h2>
<a name="Login.BasicSetup-CreatetheNecessaryUserGroupsandResourceGroups" id="Login.BasicSetup-CreatetheNecessaryUserGroupsandResourceGroups"></a>Create the Necessary User Groups and Resource Groups
</h2>

<p>
MODx Revolution includes some pretty head-splitting granularity when it comes to <a href="display/revolution20/Permissions" title="Permissions">Permissions</a>, but here is a basic schema to get you started. (Have a look at <a href="display/revolution20/Making+Member-Only+Pages" title="Making Member-Only Pages">Making Member-Only Pages</a> for more detailed explanation.)
</p>

<div class="note">
As of MODX 2.2.3, you can skip most of this step by using the <strong>Access Wizard</strong>, which appears when you create a new Resource Group under <strong>Security -&gt; Resource Groups</strong>. Just use the following settings:
<ul>
<li>Name: Members
</li>

<li>Context: web
</li>

<li>Automatically Give Adminstrator Group Access: <strong>checked</strong>
</li>

<li>Create Parallel User Group: <strong>checked</strong>
</li>

<li>Automatically Give Anonymous Access: <em>UNCHECKED</em>
</li>

<li>Automatically Give Other User Groups Access: <em>blank</em>
</li>
</ul>
</div>

<p>
If you are using an older version of MODX or you just want to enhance your understanding of the process, you can follow the manual steps below:
</p>

<p>
1. <strong>Security -&gt; Resource Groups</strong> : Create a new Resource Group for all the pages that will be available only to members.
</p>

<p>
<span class="image-wrap"><img src="download/attachments/35094632/Create+Resource+Group.jpg?version=1&amp;modificationDate=1303583586000" style="border: 0px solid black" /></span>
</p>

<p>
2. <strong>Security -&gt; Access Controls</strong> : Create User Group named "Members". Users in the "Members" group will have access to the "Members Only" resources. Make sense?
</p>

<p>
<span class="image-wrap"><img src="download/attachments/35094632/Create+User+Group.jpg?version=1&amp;modificationDate=1303583171000" style="border: 0px solid black" /></span>
</p>

<p>
3. On that same page (<strong>Security -&gt; Access Controls</strong>), <strong>Right Click</strong> the newly created "Members" User Group and select "Update User Group".
</p>

<p>
<span class="image-wrap"><img src="download/attachments/35094632/Update+User+Group.jpg?version=1&amp;modificationDate=1303583952000" style="border: 0px solid black" /></span>
</p>

<p>
<span class="image-wrap"><img src="download/attachments/35094632/Update+User+Group+-+Detail.jpg?version=1&amp;modificationDate=1303584122000" style="border: 0px solid black" /></span>
</p>

<p>
Then Add a Resource Group to this User Group. At a minimum, the Resource Group should have the following settings:
</p>

<ul>
<li>
<strong>Resource Group:</strong> Members Only (the one we just created)
</li>

<li>
<strong>Mimimum Role:</strong> Member-9999
</li>

<li>
<strong>Access Policy:</strong> Load, List and View
</li>

<li>
<strong>Context:</strong> web
</li>
</ul>

<p>
Then save.
</p>

<p>
4. <strong>Security -&gt; Manage Users</strong> : Create a new "member" user so we can test whether or not our login portal works.
</p>

<p>
Use a simple Username and password that you can remember; the important thing here is to make sure your new user is a member of the "Members" User Group. Head to the "Access Permissions" tab and click "Add User to Group"
</p>

<p>
<span class="image-wrap"><img src="download/attachments/35094632/New+User+as+Group+Member.jpg?version=1&amp;modificationDate=1303584433000" style="border: 0px solid black" /></span>
</p>

<ul>
<li>
<strong>User Group:</strong> Members
</li>

<li>
<strong>Role:</strong> Member
</li>
</ul>

<p>
This should ensure that your new user can log in with basic permissions to look around the "Members Only" pages.
</p>

<p>
Now circle back to add the various Snippet (adjust the Snippet calls so they point to the corresponding pages on your system).
</p>

<hr />

<h2>
<a name="Login.BasicSetup-AddSnippetstothePages" id="Login.BasicSetup-AddSnippetstothePages"></a>Add Snippets to the Pages
</h2>

<h3>
<a name="Login.BasicSetup-LoginPage%281%29"></a>Login Page (1)
</h3>

<p>
Put the following Snippet call on your login page:
</p>

<pre class="brush: php">
[[!Login? &amp;loginTpl=`lgnLoginTpl` &amp;logoutTpl=`lgnLogoutTpl` &amp;errTpl=`lgnErrTpl` &amp;loginResourceId=`4` &amp;logoutResourceId=`5`]]
</pre>

<pre class="brush: php">
&lt;div class="loginForm"&gt;
    &lt;div class="loginMessage"&gt;[[+errors]]&lt;/div&gt;
    &lt;div class="loginLogin"&gt;
        &lt;form class="loginLoginForm" action="[[~[[*id]]]]" method="post"&gt;
            &lt;fieldset class="loginLoginFieldset"&gt;
                &lt;legend class="loginLegend"&gt;[[+actionMsg]]&lt;/legend&gt;
                &lt;label class="loginUsernameLabel"&gt;[[%login.username]]
                    &lt;input class="loginUsername" type="text" name="username" /&gt;
                &lt;/label&gt;
                &lt;label class="loginPasswordLabel"&gt;[[%login.password]]
                    &lt;input class="loginPassword" type="password" name="password" /&gt;
                &lt;/label&gt;
                &lt;input class="returnUrl" type="hidden" name="returnUrl" value="[[+request_uri]]" /&gt;
                [[+login.recaptcha_html]]
                &lt;input class="loginLoginValue" type="hidden" name="service" value="login" /&gt;
                &lt;span class="loginLoginButton"&gt;&lt;input type="submit" name="Login" value="[[+actionMsg]]" /&gt;&lt;/span&gt;
            &lt;/fieldset&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;a href="[[~2]]"&gt;Forgot your Password?&lt;/a&gt;
</pre>
<p>
You may choose to put the link to "Forgot your Password" inside your template and keep it out of the Chunk, it's really up to you. As long as your site is clean and organized and you're not putting chunks within chunks within chunks, then you should be Ok.
</p>

<h3>
<a name="Login.BasicSetup-ForgotPassword%282%29"></a>Forgot Password (2)
</h3>

<ul>
<li>
<em>Probably hidden from most menus</em>
</li>
</ul>

<p>
This page houses the form where users can request that their password be reset. Remember: it displays the form that allows users to say that they've forgotten their password, and the "ResetPassword" Snippet is what actually resets the password.
</p>

<pre class="brush: php">
    [[!ResetPassword? &amp;loginResourceId=`1`]]
</pre>
<h3>
<a name="Login.BasicSetup-MembersHomePage%284%29"></a>Members Home Page (4)
</h3>

<p>
This is the page that displays to users who have successfully logged in. This page must have restricted permissions, and the users who log in must have the corresponding permissions to access this page. You can put whatever "private" content you want on it, just make sure you update the permissions on it so that it belongs to the "Members Only" resource group â€“ just click on the page's "Access Permissions" or "Resource Groups" tab (depending on your version of MODX):
</p>

<p>
<span class="image-wrap"><img src="download/attachments/35094632/Setting+Access+Permissions.jpg?version=1&amp;modificationDate=1303598934000" style="border: 0px solid black" /></span>
</p>

<p>
and check the box for "Members Only".
</p>

<h3>
<a name="Login.BasicSetup-ComeAgainSoon%285%29"></a>Come Again Soon (5)
</h3>

<p>
This is the page that people see after a successful logout. It needs only to contain a basic message, or perhaps a link back to the Login page:
</p>

<pre class="brush: php">
    [[~1? &amp;service=`logout`]]
</pre>
<p>
This is effectively the same as adding a Logout link like this to your pages:
</p>

<pre class="brush: php">
[[!Login]]
</pre>
<p>
and <strong>not</strong>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[Login]]
                
</pre>
</div>
</div>

<h3>
<a name="Login.BasicSetup-Ican%27tlogout%5C%21"></a>I can't log out!
</h3>

<p>
Another subtle error that you might encounter is an inability to log out. One cause of that is pointing your logout link to a page other than your <em>Login</em> page. Remember, your logout link must point to the same page containing the <strong>Login</strong> snippet!
</p>

<p>
It's also possible that your server does not send out the Password Reset emails correctly; in that case you need to debug your email setup on your server.
</p>

<h3>
<a name="Login.BasicSetup-Loginerrorsarenotdisplayed" id="Login.BasicSetup-Loginerrorsarenotdisplayed"></a>Login errors are not displayed
</h3>

<p>
If you fingermash the keyboard with a non-existent username and try to login, sometimes you don't see any errors displayed.
</p>

<h3>
<a name="Login.BasicSetup-ErrorHTTP500%28InternalServerError%29"></a>Error HTTP 500 (Internal Server Error)
</h3>

<p>
If you see this error when you try to view some of your "Members Only" pages and you see something like <tt>does not have permission to load object of class modContext with primary key</tt> in the MODX error log, then the problem might be with your Context Access: especially when dealing with multiple contexts, make sure you grant Contexts Access access to all contexts.
</p>