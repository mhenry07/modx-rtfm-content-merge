<table>
<tbody>
<tr>
<td>
Name = eForm
</td>
</tr>

<tr>
<td>
Version = 1.4.3
</td>
</tr>

<tr>
<td>
Author = TobyL
</td>
</tr>

<tr>
<td>
Since = &gt;= 0.9.5
</td>
</tr>

<tr>
<td>
Updated = 1/7/2007
</td>
</tr>
</tbody>
</table>

<div>
<ul>
<li>
<a href="extras/evo/eform#eForm-WhatiseForm%3F">What is eForm?</a>
<ul>
<li>
<a href="extras/evo/eform#eForm-Downloads">Downloads</a>
</li>
</ul>
</li>

<li>
<a href="extras/evo/eform#eForm-Installation">Installation</a>
</li>

<li>
<a href="extras/evo/eform#eForm-Usage">Usage</a>
<ul>
<li>
<a href="extras/evo/eform#eForm-RequiredParameters">Required Parameters</a>
</li>

<li>
<a href="extras/evo/eform#eForm-OptionalParameters">Optional Parameters</a>
</li>
</ul>
</li>

<li>
<a href="extras/evo/eform#eForm-Events">Events</a>
<ul>
<li>
<ul>
<li>
<a href="extras/evo/eform#eForm-eFormOnBeforeFormParse">eFormOnBeforeFormParse</a>
</li>

<li>
<a href="extras/evo/eform#eForm-eFormOnValidate">eFormOnValidate</a>
</li>

<li>
<a href="extras/evo/eform#eForm-eFormOnBeforeMailSent">eFormOnBeforeMailSent</a>
</li>

<li>
<a href="extras/evo/eform#eForm-eFormOnMailSent">eFormOnMailSent</a>
</li>

<li>
<a href="extras/evo/eform#eForm-eFormOnBeforeFormMerge">eFormOnBeforeFormMerge</a>
</li>
</ul>
</li>
</ul>
</li>

<li>
<a href="extras/evo/eform#eForm-Examples">Examples</a>
<ul>
<li>
<a href="extras/evo/eform#eForm-eFormForms">eForm Forms</a>
<ul>
<li>
<a href="extras/evo/eform#eForm-ASimpleContactFormchunk">A Simple ContactForm chunk</a>
</li>
</ul>
</li>

<li>
<a href="extras/evo/eform#eForm-eFormReport">eForm Report</a>
<ul>
<li>
<a href="extras/evo/eform#eForm-AsimpleContactFormReport">A simple ContactFormReport</a>
</li>
</ul>
</li>

<li>
<a href="extras/evo/eform#eForm-eFormDocumentSnippetCalls">eForm Document Snippet Calls</a>
</li>

<li>
<a href="extras/evo/eform#eForm-UsingeFormwithFlashforms">Using eForm with Flash forms</a>
</li>
</ul>
</li>

<li>
<a href="extras/evo/eform#eForm-DatatypesandFormatting">Datatypes and Formatting</a>
<ul>
<li>
<a href="extras/evo/eform#eForm-Datatypes">Data types</a>
</li>
</ul>
</li>

<li>
<a href="extras/evo/eform#eForm-ExtendedServerValidation">Extended Server Validation</a>
<ul>
<li>
<a href="extras/evo/eform#eForm-Validationrules">Validation rules</a>
</li>

<li>
<a href="extras/evo/eform#eForm-Hiddenfields%2Cselectboxes%2Cradiooptionsandcheckboxfields">Hidden fields, select boxes, radio options and checkbox fields</a>
<ul>
<li>
<a href="extras/evo/eform#eForm-Hiddenfields">Hidden fields</a>
</li>

<li>
<a href="extras/evo/eform#eForm-Formfieldexampleswithvalidation">Form field examples with validation</a>
</li>
</ul>
</li>
</ul>
</li>

<li>
<a href="extras/evo/eform#eForm-Notes">Notes</a>
</li>

<li>
<a href="extras/evo/eform#eForm-Resources">Resources</a>
</li>
</ul>
</div>

<h2 id="eForm-WhatiseForm?">
What is eForm?
</h2>

<p>
eForm is a highly flexible form parser snippet that will let you convert web forms into an email which can then be sent via email to users you can specify in the &#91;<a href="extras/evo/yams/yams-english-documentation/yams-snippet" title="YAMS Snippet">YAMS Snippet</a>&#93; or the form. Some notable features include:
</p>

<ul>
<li>Form validation using powerful validation rules
</li>

<li>Protection of hidden fields against tampering
</li>

<li>
<span class="error">&#91;Captcha&#93;</span> support
</li>

<li>Supports html email with attachments
</li>

<li>Flexible report &amp; page generation using placeholders
</li>

<li>Notification to mobile devices
</li>

<li>auto-respond email
</li>

<li>Support for CC and BCC fields
</li>
</ul>

<p>
Please note that eForm comes with extended documentation included in the package!
</p>

<h3 id="eForm-Downloads">
Downloads
</h3>

<p>
Download the <a href="http://modxcms.com/eForm-1003.html">latest version</a> of <a href="extras/evo/eform" title="eForm">eForm</a> from MODx repository.
</p>

<h2 id="eForm-Installation">
Installation
</h2>

<ul>
<li>Unzip the eForm ZIP file into the assets/snippet/ folder. You should now have an extra folder called eform.
</li>

<li>Create a new snippet, name it eForm and copy and paste the content of the eform.snippet.tpl file
</li>

<li>Read eform/docs/eform.htm and the examples
</li>

<li>Drop the eForm snippet into page and add parameters as you require
</li>

<li>If you are managing the server that you are running MODx on, you need to make sure that <strong>sendmail</strong> is installed and configured properly.
</li>
</ul>

<h2 id="eForm-Usage">
Usage
</h2>

<h3 id="eForm-RequiredParameters">
Required Parameters
</h3>

<ul>
<li>&amp;formid - <em>Required</em>
<ul>
<li>Identity (id) of the form on the page that this snippet will manage. Eg: &lt;code&gt;&lt;form id="formid"&gt;&lt;/code&gt;
</li>
</ul>
</li>

<li>&amp;tpl - <em>Required</em>
<ul>
<li>&#91;<span class="error">&#91;Chunk&#93;</span>&#93; name or document id to use as a template.
</li>
</ul>
</li>

<li>&amp;report - <em>Required</em>
<ul>
<li>&#91;<span class="error">&#91;Chunk&#93;</span>&#93; name or document id to use when generating reports, if using the &amp;noemail parameter, this parameter is not required.
</li>
</ul>
</li>
</ul>

<h3 id="eForm-OptionalParameters">
Optional Parameters
</h3>

<ul>
<li>&amp;to - <em>Optional</em>
<ul>
<li>Email address to send eForm information to For multiple recipients separate emails with a comma (,) If omitted the site settings email address will be used.
</li>
</ul>
</li>

<li>&amp;from - <em>Optional</em>
<ul>
<li>Sets the email address to appear in the From section of the email.
</li>
</ul>
</li>

<li>&amp;automessage - <em>Optional</em>
<ul>
<li>chunk name (non-numeric) or document id (numeric) to use as an auto-responder message Can include <span class="error">&#91;+form fields+&#93;</span>. E.g. <span class="error">&#91;+firstname+&#93;</span> - tags: <span class="error">&#91;form_fields&#93;</span>,<span class="error">&#91;postdate&#93;</span> - note: eForm will send the auto-respond message to the email address specified inside the <span class="error">&#91;email&#93;</span> form field.
<br />
<strong>More to Come...</strong>
</li>
</ul>
</li>
</ul>

<h2 id="eForm-Events">
Events
</h2>

<h4 id="eForm-eFormOnBeforeFormParse">
eFormOnBeforeFormParse
</h4>

<p>
Called just before the form is parsed, Parsing is done <strong>only</strong> if there is $_POST data valid to the form.
</p>

<h4 id="eForm-eFormOnValidate">
eFormOnValidate
</h4>

<p>
Called after built-in validation is parsed, for use with extended validation.
</p>

<h4 id="eForm-eFormOnBeforeMailSent">
eFormOnBeforeMailSent
</h4>

<p>
Called before the message is sent. This function is called regardless of wether &amp;noemail is set.
</p>

<h4 id="eForm-eFormOnMailSent">
eFormOnMailSent
</h4>

<p>
Called after the message is sent. If &amp;to is not set, or is not a valid address, this event is not called.
</p>

<h4 id="eForm-eFormOnBeforeFormMerge">
eFormOnBeforeFormMerge
</h4>

<p>
Very last event called before the form is pushed to the client browser.
</p>

<h2 id="eForm-Examples">
Examples
</h2>

<h3 id="eForm-eFormForms">
eForm Forms
</h3>

<h4 id="eForm-ASimpleContactFormchunk">
A Simple ContactForm chunk
</h4>

<pre class="brush: php">
&lt;p class="error"&gt;&#91;+validationmessage+&#93;&lt;/p&gt;

&lt;form method="post" action="&#91;~&#91;*id*&#93;~&#93;" id="EmailForm"&gt;

        &lt;fieldset&gt;
                &lt;h3&gt; Contact Us&lt;/h3&gt;

                &lt;input name="formid" type="hidden" value="ContactForm" /&gt;

                &lt;label for="cfName"&gt;Your name:
                &lt;p&gt;&lt;input name="name" id="cfName" class="text" type="text" eform="Your Name::1:" /&gt;&lt;/p&gt;&lt;/label&gt;

                &lt;label for="cfEmail"&gt;Your Email Address:
                &lt;p&gt;&lt;input name="email" id="cfEmail" class="text" type="text" eform="Email Address:email:1" /&gt;&lt;/p&gt; &lt;/label&gt;

                &lt;label for="cfRegarding"&gt;Regarding:
                &lt;p&gt;&lt;input name="subject" id="cfRegarding" class="text" type="text" eform="Form Subject::1" /&gt;&lt;/p&gt; &lt;/label&gt;

                &lt;label for="cfMessage"&gt;Message:
                &lt;p&gt;&lt;textarea name="message" id="cfMessage" eform="Message:textarea:1"&gt;&lt;/textarea&gt;&lt;/p&gt;
                &lt;/label&gt;

                &lt;label&gt;&amp;nbsp;&lt;/label&gt;&lt;p&gt;&lt;input type="submit" name="contact" id="cfContact" class="button" value="Send This Message" /&gt;&lt;/p&gt;

        &lt;/fieldset&gt;

&lt;/form&gt;
</pre>
<p>
--ScottyDelicious 16:00, 5 December 2006 (PST)
</p>

<h3 id="eForm-eFormReport">
eForm Report
</h3>

<h4 id="eForm-AsimpleContactFormReport">
A simple ContactFormReport
</h4>

<pre class="brush: php">
&lt;p&gt;This is a response sent by &lt;b&gt;&#91;+name+&#93;&lt;/b&gt; using the feedback form on this website. The details of the message follow below:&lt;/p&gt;

&lt;p&gt;Name: &#91;+name+&#93;&lt;/p&gt;
&lt;p&gt;Email: &#91;+email+&#93;&lt;/p&gt;
&lt;p&gt;Regarding: &#91;+subject+&#93;&lt;/p&gt;
&lt;p&gt;Comments:&lt;br /&gt;&#91;+message+&#93;&lt;/p&gt;

&lt;p&gt;You can use this link to reply: &lt;a href="mailto:&#91;+email+&#93;?subject=RE: &#91;+subject+&#93;"&gt;&#91;+email+&#93;&lt;/a&gt;&lt;/p&gt;
</pre>
<p>
--ScottyDelicious 16:00, 5 December 2006 (PST)
</p>

<h3 id="eForm-eFormDocumentSnippetCalls">
eForm Document Snippet Calls
</h3>

<pre class="brush: php">
&#91;!eForm? &amp;formid=`ContactForm` &amp;subject=`&#91;+subject+&#93;` &amp;to=`you@youremail.com` 
&amp;ccsender=`1` &amp;tpl=`ContactForm` &amp;report=`ContactFormReport` &amp;gotoid=`1`  !&#93;
</pre>
<h3 id="eForm-UsingeFormwithFlashforms">
Using eForm with Flash forms
</h3>

<p>
eForm can be used to process data sent through a Flash form.&lt;br /&gt;
<br />
The chunk template (tpl) defines all the fields in your Flash form.&lt;br /&gt;
<br />
Add the formid field with the appropriate name in the Flash form and post that form to a page where the eForm call is made.&lt;br /&gt;
<br />
You can even manage files upload with eForm and Flash. For that you will need to send all the data in one call with Flash using a similar code:
</p>

<pre class="brush: php">
var postData:String = "";
postData += "action=index.php?id=&lt;eFormPage&gt;";
postData += "&amp;name="+escape(Util.trim(input_name.text));

fileRef&#91;"postData"&#93; = postData;
fileRef.upload(url);
</pre>
<p>
You can format the report template as an xml document to send back to Flash to notify the success of the operation:
</p>

<pre class="brush: php">
&lt;root&gt;
&lt;success&gt;1&lt;/success&gt;
&lt;/root&gt;
</pre>
<h2 id="eForm-DatatypesandFormatting">
Datatypes and Formatting
</h2>

<p>
eForm incorporates a form parser which extracts formatting and validation options from each form field. To set options for a field add the eform(pseudo) attribute to each required form field.
</p>

<pre class="brush: php">
&lt;input type="text" name="color" eform="A Color:string:1" /&gt;
</pre>
<p>
The basic format of the eform attribute is:
</p>

<p>
description/title:datatype:required:validation message:validation rule
</p>

<h3 id="eForm-Datatypes">
Data types
</h3>

<p>
You only need to set the following data types. Others will be set automatically (radio &amp; checkbox as they are, string for textbox and listbox for select)
</p>

<p>
Standard validation: All fields that are required will be checked if they are left empty.
</p>

<ul>
<li>string - No specific validation besides checking if it's empty if the field is required.
</li>

<li>date - Checks if it is a valid date (based on php's strtotime() function)
</li>

<li>integer - Checks if it is a number (does not check if it is in fact an integer)
</li>

<li>float - Checks if it is a number
</li>

<li>email - Checks if it's a valid email address using a simple regular expression
</li>

<li>file - (for file upload input) - checks if a size error occurs, does not currently check file type
</li>

<li>html - Same as string except that it converts line endings (\n) to tags
</li>
</ul>

<p>
The listbox, checkbox and radio fields do normally not require the datatype to be set. eForm will recognize these automatically. It will validate the values against the list of values placed in the form. The option tags in the listbox and the checkbox must have their value attributes explicitly set for this automatic validation to work. Eg.
</p>

<pre class="brush: php">
&lt;option value="Mr"&gt;Mr&lt;/option&gt;
</pre>
<p>
Not:
</p>

<pre class="brush: php">
&lt;option&gt;Mr&lt;/option&gt;
</pre>
<h2 id="eForm-ExtendedServerValidation">
Extended Server Validation
</h2>

<p>
This version introduces extended server validation and word filtering using very flexible validation rules that can be set in the eformattribute. You can set 2 extra validation parameters, a custom error message and a validation or filter rule.
</p>

<p>
<strong>Example</strong>
</p>

<pre class="brush: php">
eform="Year of Birth:integer:1:Must be between 1950 and 2002:#RANGE 1950-2002"
</pre>
<h3 id="eForm-Validationrules">
Validation rules
</h3>

<ul>
<li>#LIST - comma separated list of valid values
<br />
example: #LIST blue,red,green.maroon
</li>

<li>#RANGE - a comma separated list of numbers or numeric ranges. When setting a range the order is not important.
<br />
1~10 or 10~1 will both validate a number between 1 and 10 (inclusive).
<br />
Handles negative as well as positive numbers
<br />
example: #RANGE 1,3,-5~-15,60~82
</li>

<li>#SELECT - list of valid values retrieved from a database query The query should only return a single column of values
<br />
(the function only checks against the first returned column). You can use the {DBASE} {PREFIX}tags which will
<br />
be replaced by the MODx database name and table prefix respectively.
<br />
example: #SELECT keyword FROM {PREFIX}site_keywords
</li>

<li>#EVAL - string of php code. Should return either true or false
<br />
deprecated - Although #EVAL still works in eForm 1.4 this rule will very likely no longer be supported in future versions.
<br />
Use #FUNCTION instead.
</li>

<li>#FUNCTION - Name of a function. The function should expect one parameter (the posted value) and return either TRUE or FALSE.
<br />
See the eform event example on how you can include a function. example: #FUNCTION myValidationFunction
</li>

<li>#REGEX - regular expression - syntax as for preg_match() - see php manual
<br />
example: #REGEX /^<span class="error">&#91;a-z&#93;</span>+ <span class="error">&#91;a-z0-9_&#93;</span>+/i
</li>

<li>#FILTER - Filters do not validate the input but simply replace words or values using filter criteria. You can use the following
<br />
filters:
<br />
o #FILTER #LIST
<br />
use double pipe to separate 2 comma separated lists of words and replacement values.
<br />
example; #FILTER #LIST badword,verybadword||goodword,verygoodword
<br />
o #FILTER #EVAL
<br />
example: #FILTER #EVAL return myFilterFunction($value);
<br />
(of course you have to make sure the function exists somehow)
</li>
</ul>

<p>
example filter function
</p>

<pre class="brush: php">
            function myFilterFunction($value){
               $badWords = array('scribble','coding');
               $goodWords = array('design','sleep');
               return str_replace($badWords,$goodWords,$value);
            }
            
</pre>
<p>
o #FILTER #REGEX
<br />
regular expression replace - syntax as for preg_replace() separate the search and replacement expression with a double
<br />
pipe symbol (||)
<br />
TODO: example
</p>

<h3 id="eForm-Hiddenfields,selectboxes,radiooptionsandcheckboxfields">
Hidden fields, select boxes, radio options and checkbox fields
</h3>

<p>
Select boxes, radio options and checkbox fields now have working automatic validation. Any input for these fields is validated against the values set in your form template. This avoids anyone tampering with the form by adding their own values to these fields.
</p>

<h4 id="eForm-Hiddenfields">
Hidden fields
</h4>

<p>
By default hidden fields are validated as a protection against tampering by comparing the input against the value set in the form template (much like the select, checkbox and radio fields) In some circumstances this may not be desirable however. For instance when you use some javascript in your form to store a result in a hidden field. In those cases you can turn this behaviour off by setting the eform attribute (with or without it's own validation).
</p>

<p>
<strong>Hidden field examples</strong>
</p>

<p>
<strong>1.</strong> The default behaviour is handy for instance if you are storing a document id and want to be sure no one can tamper with the id. the field would look like this:
</p>

<pre class="brush: php">
&lt;input type="hidden" name="docId" value="31" /&gt;
</pre>
<p>
<strong>2.</strong> Suppose you have a form where a javascript calculated value is stored in a hidden field. To avoid the hidden field being validated at all you add the following eform attribute:
</p>

<pre class="brush: php">
&lt;input type="hidden" name="calculatedField" value="" eform="::0::" /&gt;
</pre>
<p>
<strong>3.</strong> Same as example 2 but suppose you want to make sure a value is returned and that it stays within a certain range. The eform attribute is set with: title,integer data type, required field, error message and validation with #RANGE (in this example a value between 1-10)
</p>

<pre class="brush: php">
&lt;input type="hidden" name="calculatedField" value="" eform="Calculated Value:integer:1:Calculation out of range:#RANGE 1-10" /&gt;
</pre>
<h4 id="eForm-Formfieldexampleswithvalidation">
Form field examples with validation
</h4>

<p>
<strong>Selectbox</strong> - set as required field (no validation required)
</p>

<pre class="brush: php">
&lt;select name="mySelect" eform="Select Country::1" /&gt; (datatype left blank)
&lt;option value="en-au"&gt;Australia&lt;/option&gt;
&lt;option value="en-us"&gt;USA&lt;/option&gt;
&lt;/select&gt;
</pre>
<p>
<strong>Textbox</strong> - required and format set to date
</p>

<pre class="brush: php">
&lt;input type="text" name="dobDate" eform="Date of Birth:date:1:@EVAL return (strtotime($value)!==-1)?true:false;" /&gt;
</pre>
<p>
<strong>Multiple checkbox</strong> - required, eform only set once.
</p>

<pre class="brush: php">
&lt;input type="checkbox" name="myColors&#91;&#93;" value="Red" eform="Colors::1" /&gt; (datatype left blank)
&lt;input type="checkbox" name="myColors&#91;&#93;" value="Green" /&gt; (datatype left blank)
</pre>
<h2 id="eForm-Notes">
Notes
</h2>

<ul>
<li>If you use a template rather than a chunk for the form (the tpl parameter), make sure you turn the 'rich text' attribute of the template off. Otherwise all of the 'eform' pseudo attributes will be stripped off the first time you edit the form.
</li>
</ul>

<ul>
<li>The "tick marks" in the snippet call are not single quotes, but back ticks. Using single quotes will give you a "Document or chunk not found for template id=" error.
</li>
</ul>

<h2 id="eForm-Resources">
Resources
</h2>

<ul>
<li>
<a href="http://wiki.modxcms.com/index.php/Category:EForm">eForm Howtos</a> on old MODxWiki
</li>
</ul>

<p>
LInk to author's page (www.partout.info/assets/snippets/eform/docs/eform.htm)
</p>