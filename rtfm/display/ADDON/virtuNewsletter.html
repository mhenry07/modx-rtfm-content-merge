<div>
<ul>
<li>
<a href='#virtuNewsletter-virtuNewsletter'>virtuNewsletter</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#virtuNewsletter-Download'>Download</a>
</li>

<li>
<a href='#virtuNewsletter-DevelopmentandBugReporting'>Development and Bug Reporting</a>
</li>

<li>
<a href='#virtuNewsletter-Howitworks'>How it works</a>
</li>
</ul>
</li>

<li>
<a href='#virtuNewsletter-EmailTemplates'>Email Templates</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#virtuNewsletter-Tpl%3AThankyouforyoursubscription'>Tpl: Thank you for your subscription</a>
</li>

<li>
<a href='#virtuNewsletter-Tpl%3AYoursubscriptionhasbeenactivatedsuccessfully.'>Tpl: Your subscription has been activated successfully.</a>
</li>

<li>
<a href='#virtuNewsletter-Tpl%3AYouhavebeenunsubscribedsuccessfully.'>Tpl: You have been unsubscribed successfully.</a>
</li>
</ul>
</li>

<li>
<a href='#virtuNewsletter-SystemSettings'>System Settings</a>
</li>

<li>
<a href='#virtuNewsletter-Resources%2CSnippets%26aChunk'>Resources, Snippets &amp; a Chunk</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#virtuNewsletter-1.Subscribe'>1. Subscribe</a>
</li>

<li>
<a href='#virtuNewsletter-2.Confirm'>2. Confirm</a>
</li>

<li>
<a href='#virtuNewsletter-3.Read'>3. Read</a>
</li>

<li>
<a href='#virtuNewsletter-4.aChunk'>4. a Chunk</a>
</li>

<li>
<a href='#virtuNewsletter-5.TheNewsletters'>5. The Newsletters</a>
</li>
</ul>
</li>

<li>
<a href='#virtuNewsletter-CustomManagerPage%28CMP%29'>Custom Manager Page (CMP)</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#virtuNewsletter-Newsletters'>Newsletters</a>
</li>

<li style="list-style: none; display: inline">
<ul>
<li>
<a href='#virtuNewsletter-Category'>Category</a>
</li>
</ul>
</li>

<li>
<a href='#virtuNewsletter-Subscribers'>Subscribers</a>
</li>
</ul>
</li>

<li>
<a href='#virtuNewsletter-Cron'>Cron</a>
</li>
</ul>
</div>

<h1>
<a name="virtuNewsletter-virtuNewsletter"></a>virtuNewsletter
</h1>

<p>
virtuNewsletter is another newsletter system for MODX Revolution.
</p>

<h2>
<a name="virtuNewsletter-Download"></a>Download
</h2>

<p>
It can be downloaded from within the MODx Revolution manager via <a href="/display/revolution20/Package+Management" title="Package Management">Package Management</a>, or from the MODx Extras Repository, available here: <a href="http://modx.com/extras/package/virtunewsletter" class="external-link" rel="nofollow">http://modx.com/extras/package/virtunewsletter</a>
</p>

<h2>
<a name="virtuNewsletter-DevelopmentandBugReporting"></a>Development and Bug Reporting
</h2>

<p>
virtuNewsletteris stored and developed in GitHub, and can be found here: <a href="https://github.com/virtudraft/virtuNewsletter" class="external-link" rel="nofollow">https://github.com/virtudraft/virtuNewsletter</a>
</p>

<h2>
<a name="virtuNewsletter-Howitworks"></a>How it works
</h2>

<p>
1. Set up a newsletter format using common Resource on the left tree
<br />
2. On the CMP, add a Category, as the newsletter group. In here, you may or may not apply usergroups to this category.
<br />
3. Then add a Newsletter, to this Category
<br />
4. <b><em>is recurring</em></b>, means that newsletter will be used recursively based on the given time range (weekly, monthly, or yearly), and split into the number of recurring (1 - monthly, 7 - weekly =&gt; means daily).
</p>

<p>
This system using web-accessible gateway for the cron to initiate.
<br />
This is useful for 3rd party web cron service outside of the web hosting.
<br />
Particularly, modxcloud doesn't provide cron job for its host service.
</p>

<p>
Read how to set it up in the Cron section below.
</p>

<h1>
<a name="virtuNewsletter-EmailTemplates"></a>Email Templates
</h1>

<p>
You need to provide some email templates for confirmations.
<br />
These templates are resources, not chunks.
<br />
Leave them unpublished or hidden, it doesn't matter.
<br />
Its <b>pagetitle</b> will be the <em>subject</em> of the email.
<br />
Its <b>content</b> will be the <em>body</em> of the email.
<br />
<b>ALL SNIPPETS AND CHUNKS</b> will be processed.
</p>

<p>
So you can leave ,eg: getResources, snippets to give more update about your site inside the email's body.
</p>

<p>
By using resources, non-techie user won't be horrified with HTML tags if they want to edit the email's content.
</p>

<h2>
<a name="virtuNewsletter-Tpl%3AThankyouforyoursubscription"></a>Tpl: Thank you for your subscription
</h2>

<p>
Email template for subscribe confirmation.
<br />
The default is in <b>core/components/virtunewsletter/elements/emails/activation-email.tpl</b>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;p&gt;Hello [[+virtuNewsletter.email.name:<span class="code-keyword">default</span>=`[[+virtuNewsletter.email.email]]`]],&lt;/p&gt;

&lt;p&gt;Thank you <span class="code-keyword">for</span> your subscription.&lt;/p&gt;

&lt;p&gt;To complete <span class="code-keyword">this</span>, please click <span class="code-keyword">this</span> link to activate your account:
    &lt;a href="[[~62?
       &amp;subid=`[[+virtuNewsletter.email.args.subid]]`
       &amp;h=`[[+virtuNewsletter.email.args.hash]]`
       &amp;act=`subscribe`
       &amp;scheme=`full`]]"
       target=<span class="code-quote">"_blank"</span>&gt;activate&lt;/a&gt;.
&lt;/p&gt;

&lt;p&gt;You can unsubscribe back later <span class="code-keyword">if</span> it is required.&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;&lt;a href=<span class="code-quote">"http:<span class="code-comment">//www.example.com"</span> target=<span class="code-quote">"_blank"</span>&gt;Example.com&lt;/a&gt;&lt;/p&gt;</span>
</pre>
</div>
</div>

<p>
The ID# <b>62</b> should be replaced with the resource's ID for the confirmation page, which only contains:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[!virtuNewsletter.confirm]]
</pre>
</div>
</div>

<h2>
<a name="virtuNewsletter-Tpl%3AYoursubscriptionhasbeenactivatedsuccessfully."></a>Tpl: Your subscription has been activated successfully.
</h2>

<p>
Email template for confirmed subscription.
<br />
The default is in <b>core/components/virtunewsletter/elements/emails/activated-email.tpl</b>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;p&gt;Thank you.&lt;/p&gt;

&lt;p&gt;Your subscription has been activated successfully.&lt;/p&gt;

&lt;p&gt;We will send you the upcoming newsletter once they are published.&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;&lt;a href=<span class="code-quote">"http:<span class="code-comment">//www.example.com"</span> target=<span class="code-quote">"_blank"</span>&gt;Example.com&lt;/a&gt;&lt;/p&gt;</span>
</pre>
</div>
</div>

<h2>
<a name="virtuNewsletter-Tpl%3AYouhavebeenunsubscribedsuccessfully."></a>Tpl: You have been unsubscribed successfully.
</h2>

<p>
Email template for unsubscription.
</p>

<p>
In each of newsletter, can be given a unsubscription link.
<br />
This link will go to the same confirmation page as above, but with "subsubscribe" value as the replacement.
<br />
This template is about to send the unsubscription confirmation.
</p>

<p>
The default is in <b>core/components/virtunewsletter/elements/emails/deactivated-email.tpl</b>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;p&gt;Thank you.&lt;/p&gt;

&lt;p&gt;Your subscription has been cancelled successfully.&lt;/p&gt;

&lt;p&gt;We will no longer send you the upcoming newsletters.&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;&lt;a href=<span class="code-quote">"http:<span class="code-comment">//www.example.com"</span> target=<span class="code-quote">"_blank"</span>&gt;Example.com&lt;/a&gt;&lt;/p&gt;</span>
</pre>
</div>
</div>

<p>
At this point, the subscriber won't be removed from the system.
<br />
Only be deactivated.
</p>

<h1>
<a name="virtuNewsletter-SystemSettings"></a>System Settings
</h1>

<div class='table-wrap'>
<table class='confluenceTable'>
<tbody>
<tr>
<th class='confluenceTh'>
Settings
<br class="atl-forced-newline" />
</th>
<th class='confluenceTh'>
description
<br class="atl-forced-newline" />
</th>
</tr>

<tr>
<td class='confluenceTd'>
virtunewsletter.usergroups
</td>
<td class='confluenceTd'>
Fill up names of usergroups, delimited by comma, to make these usergroups will be automatically subscribed
</td>
</tr>

<tr>
<td class='confluenceTd'>
<b>virtunewsletter.email_debug</b>
</td>
<td class='confluenceTd'>
<b>Turn this on to dump the email's placeholders to MODX's error log without sending the email</b>
</td>
</tr>

<tr>
<td class='confluenceTd'>
virtunewsletter.email_limit
</td>
<td class='confluenceTd'>
Number of emails per hour for the cron job. Please consult your webhost about this. 0 (zero) or empty value means unlimited which will send all emails in 1 (one) batch. Default: 50.
</td>
</tr>

<tr>
<td class='confluenceTd'>
virtunewsletter.email_sender
</td>
<td class='confluenceTd'>
From whom the newsletter comes from as the Email's header. Default is any value in the System Setting's <b>emailsender</b>
</td>
</tr>

<tr>
<td class='confluenceTd'>
virtunewsletter.subscribe_confirmation_tpl
</td>
<td class='confluenceTd'>
Resource's ID as the email template for the new subscription, as the above <em>Tpl: Thank you for your subscription</em>
</td>
</tr>

<tr>
<td class='confluenceTd'>
virtunewsletter.subscribe_succeeded_tpl
</td>
<td class='confluenceTd'>
Resource's ID as the email template for the unsubscription confirmation
</td>
</tr>

<tr>
<td class='confluenceTd'>
virtunewsletter.unsubscribe_confirmation_tpl
</td>
<td class='confluenceTd'>
Resource's ID as the email template for the unsubscription
</td>
</tr>

<tr>
<td class='confluenceTd'>
virtunewsletter.unsubscribe_succeeded_tpl
</td>
<td class='confluenceTd'>
Resource's ID as the email template for the completed confirmation of the unsubscription
</td>
</tr>

<tr>
<td class='confluenceTd'>
virtunewsletter.readerpage
</td>
<td class='confluenceTd'>
Resource's ID where visitor can access the newsletter via web
</td>
</tr>
</tbody>
</table>
</div>

<h1>
<a name="virtuNewsletter-Resources%2CSnippets%26aChunk"></a>Resources, Snippets &amp; a Chunk
</h1>

<p>
You need to create 3 more resources with its own snippet in it:
</p>

<h2>
<a name="virtuNewsletter-1.Subscribe"></a>1. Subscribe
</h2>

<p>
<b>Example: this is the ID# 61 for the subscribe form below.</b>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[!virtuNewsletter.subscribe]]
</pre>
</div>
</div>

<h2>
<a name="virtuNewsletter-2.Confirm"></a>2. Confirm
</h2>

<p>
<b>Example: this is the ID# 62 in my template examples above.</b>
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[!virtuNewsletter.confirm]]
</pre>
</div>
</div>

<h2>
<a name="virtuNewsletter-3.Read"></a>3. Read
</h2>

<p>
<b>Example: this is the ID# 63 for the link in the email's body of the newsletter below.</b>
<br />
This resource will be the website's newsletter reader page.
<br />
Use the MODX's original <b>BaseTemplate</b>, without any CSS styles.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[!virtuNewsletter.reader]]
</pre>
</div>
</div>

<p>
To dump the placeholders, use this
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[!virtuNewsletter.reader? &amp;toArray=`1`]]
</pre>
</div>
</div>

<h2>
<a name="virtuNewsletter-4.aChunk"></a>4. a Chunk
</h2>

<p>
The subscribe form (can be a chunk) is simply like this:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;form action=<span class="code-quote">"[[~61]]"</span> method=<span class="code-quote">"POST"</span>&gt;
    &lt;p&gt;Email: &lt;input type=<span class="code-quote">"email"</span> name=<span class="code-quote">"email"</span>&gt;&lt;/p&gt;
    &lt;input type=<span class="code-quote">"hidden"</span> name=<span class="code-quote">"category"</span> value=<span class="code-quote">"Customer News"</span>&gt;
    &lt;p&gt;&lt;input type=<span class="code-quote">"submit"</span> name=<span class="code-quote">"submit"</span> value=<span class="code-quote">"Subscribe"</span>&gt;&lt;/p&gt;
&lt;/form&gt;
</pre>
</div>
</div>

<p>
<b>NO FORMIT, NO HOOK!</b>
<br />
Simply point the action to the Subscribe page above.
<br />
The <b>category</b> field is required to set the subscriber to the appropriate <b>Category</b> inside the CMP.
<br />
The name itself can be changed, but make sure you have to apply this also to the <b>[[!virtuNewsletter.subscribe? &amp;categoryKey=`category`]]</b>
</p>

<h2>
<a name="virtuNewsletter-5.TheNewsletters"></a>5. The Newsletters
</h2>

<p>
You are now ready to create the newsletters using the common resource.
<br />
1. Create another template that will be acting as the email's body, means without &lt;!DOCTYPE&gt; and &lt;head&gt; tags.
<br />
2. Put the CSS styles inside the &lt;style&gt;&lt;/style&gt; tag, and it will parsed automatically inline to the email's body.
<br />
3. You might also want to add these placeholders as the unsubscribe link, or link to read this on your website:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;!-- unsubscribe link --&gt;
&lt;a href="[[~62? 
&amp;subid=`[[+virtuNewsletter.email.id]]` 
&amp;h=`[[+virtuNewsletter.email.hash]]`
&amp;act=`unsubscribe`
&amp;scheme=`full`
]]"&gt;
Unsubscribe
&lt;/a&gt;

&lt;!-- read the newsletter on the website --&gt;
&lt;a href="[[~63?
&amp;newsid=`[[+virtuNewsletter.email.id]]`
&amp;scheme=`full`
]]"&gt;read <span class="code-keyword">this</span> newsletter on the website&lt;/a&gt;
</pre>
</div>
</div>

<p>
Just remember to always put <b>&amp;scheme=`full`</b> to all link tags, so they will be appended with the full URL of the website.
</p>

<h1>
<a name="virtuNewsletter-CustomManagerPage%28CMP%29"></a>Custom Manager Page (CMP)
</h1>

<h2>
<a name="virtuNewsletter-Newsletters"></a>Newsletters
</h2>

<h3>
<a name="virtuNewsletter-Category"></a>Category
</h3>

<p>
Category is a group definition of subscribers.
<br />
The subscriber can be from usergroups, or anonymous subscriber from web page, whom registered using the subscription form.
<br />
Because this is required for newsletter, then the subscription form <b>MUST</b> have category field (or anything you define which matches with [[!virtuNewsletter.subscriber? &amp;categoryKey=`category`]] controller snippet).
</p>

<p>
So in CMP, you have to create a Category first.
</p>

<h2>
<a name="virtuNewsletter-Subscribers"></a>Subscribers
</h2>

<h1>
<a name="virtuNewsletter-Cron"></a>Cron
</h1>

<p>
To use cron in your own hosting, set this command:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
php -q /home/xxx[absolute_path]xxx/public_html/assets/components/virtunewsletter/conn/web.php?action=web/crons/queues/process&amp;site_id=modx12abc345678d90.12345678
</pre>
</div>
</div>

<p>
If you use 3rd party cron service, point the address to:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
http:<span class="code-comment">//www.your_cool_website.com/assets/components/virtunewsletter/conn/web.php?action=web/crons/queues/process&amp;site_id=modx12abc345678d90.12345678</span>
</pre>
</div>
</div>

<p>
<b>site_id</b> is required!
<br />
Replace <b>site_id=modx12abc345678d90.12345678</b> with your site's ID.
<br />
Look for it inside the core/config/config.inc.php, check the <b>$site_id</b> variable.
</p>

<div class='panelMacro'>
<table class='warningMacro'>
<colgroup>
<col width='24' />
<col />
</colgroup>

<tr>
<td valign='top'>
<img src="/images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0" />
</td>
<td>
<b>Heads Up</b>
<br />
Do not share this site_id to anybody else!
<br />
This is the MODX's secret to prevent cross-site scripting.
<br />
If you want to ask something on the forum, remember to REPLACE THIS VALUE!
</td>
</tr>
</table>
</div>