<p>
The bdListings snippet can be used to present search results, a generic listing overview and more.
</p>

<h2>
<a name="bdListings.bdListings-SnippetProperties" id="bdListings.bdListings-SnippetProperties"></a>Snippet Properties
</h2>

<h3>
<a name="bdListings.bdListings-GeneralProperties" id="bdListings.bdListings-GeneralProperties"></a>General Properties
</h3>

<div class='table-wrap'>
<table class='confluenceTable'>
<tbody>
<tr>
<th class='confluenceTh'>
Property Name
</th>
<th class='confluenceTh'>
Description
<br class="atl-forced-newline" />
</th>
<th class='confluenceTh'>
Default Value
<br class="atl-forced-newline" />
</th>
</tr>

<tr>
<td class='confluenceTd'>
limit
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Maximum number of results, or 0 for all listings.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
0
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
offset
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Optional offset (for use with pagination, you can use getPage for that).
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
0
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
sort
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
JSON string to allow sorting on multiple factors with different directions. Fields you can use in this property and &amp;sortby are:
<br class="atl-forced-newline" />

<ul>
<li>id
</li>

<li>title
</li>

<li>description
</li>

<li>keywords
</li>

<li>price
</li>

<li>createdon
</li>

<li>publisheduntil
</li>

<li>featured
</li>

<li>companyname
</li>

<li>contactinfo
</li>

<li>address
</li>

<li>phone
</li>

<li>email
</li>

<li>neighborhood
</li>

<li>zip
</li>

<li>city
</li>

<li>country
</li>

<li>website
</li>

<li>latitude
</li>

<li>longitude
</li>

<li>category_name
</li>

<li>category_description
</li>

<li>subcategory_name (may not exist)
</li>

<li>subcategory_description (may not exist)
</li>

<li>target_name (may not exist)
</li>

<li>pricegroup_display (may not exist)
</li>
</ul>
</td>
<td class='confluenceTd'>
<div class="preformatted panel" style="border-width: 1px;">
<div class="preformattedContent panelContent">
<pre>
{"city": "ASC", "neighborhood": "ASC", "companyname": "ASC" }
</pre>
</div>
</div>
</td>
</tr>

<tr>
<td class='confluenceTd'>
sortby
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
When &amp;sort is empty or not a valid JSON string (hint: use &amp;sort=`` to overrule the default), you can define a property to sort on with this.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
title
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
sortdir
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
[ASC|DESC] When &amp;sort is empty or not a valid JSON string you can define ascending or descending sort order with this property.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
ASC
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
activeOnly
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
[1|0] If 1 (true) will only show active items.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
1
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
featuredOnly
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
[1|0] If 1 (true) will only show featured items.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
0
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
where
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Optional JSON encoded limits.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
&nbsp;
</td>
</tr>

<tr>
<td class='confluenceTd'>
acceptUrlParams
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
[1|0] Allow specific url params (see acceptedUrlParams) to override properties you set in the snippet call / default values.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
1
</td>
</tr>

<tr>
<td class='confluenceTd'>
acceptedUrlParams
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Comma separated list of properties that are allowed to override what's set in the snippet call or default values.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
query, keyword, target, pricegroup, city, category, subcategory, sort, listings
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
redirectResource
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
<b>Required if using click tracking.</b> The Resource ID to use as redirect resource. See <a href="/display/ADDON/bdListings.bdRedirect" title="bdListings.bdRedirect">bdRedirect</a> as well.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
39
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
rowSeparator
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Separator to use between listings.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
a line break (\n)
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
imageSeparator
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Separator to use between images of a listing.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
a line break (\n)
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
emptyValue
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
A value (hint: could be a chunk tag) to display when there are no results.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
&lt;p&gt;No listings found :(&lt;/p&gt; (bdlistings.noresults lexicon key)
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
trackViews
</td>
<td class='confluenceTd'>
[1|0] When 1, the snippet will increment the "views" field for listings in the displayed result set. Can be useful if you have certain lists you don't want to influence the view count. Added in 1.1.1-pl.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
1
</td>
</tr>
</tbody>
</table>
</div>

<h2>
<a name="bdListings.bdListings-FilteringProperties" id="bdListings.bdListings-FilteringProperties"></a>Filtering Properties
</h2>

<div class='table-wrap'>
<table class='confluenceTable'>
<tbody>
<tr>
<th class='confluenceTh'>
Property Name
<br class="atl-forced-newline" />
</th>
<th class='confluenceTh'>
Description
<br class="atl-forced-newline" />
</th>
</tr>

<tr>
<td class='confluenceTd'>
query
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Full-text search that uses a loose match against the title and description of a listing.
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
keyword
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Full-text search that uses a loose match against the keyword field.
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
target
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
ID of a target as defined in the component to match against.
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
pricegroup
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
ID of a price group as defined in the component to match against.
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
city
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Loose match against the city field.
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
category
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Either the category name (exact match) or ID to filter on. As of 1.1.2 this will also search subcategories (name or ID).
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
subcategory
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Either the subcategory name (exact match) or ID to filter on.
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
listings
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
If you want to show only a specific set of listings, this can be a comma separated list of their IDs.
<br class="atl-forced-newline" />
</td>
</tr>
</tbody>
</table>
</div>

<p>
Tip: by default each of these are accepted as URL properties (or POST values) so they are great to offer as filtering options to your site visitor.
</p>

<h2>
<a name="bdListings.bdListings-TemplatingChunks" id="bdListings.bdListings-TemplatingChunks"></a>Templating Chunks
</h2>

<h3>
<a name="bdListings.bdListings-tplOuter" id="bdListings.bdListings-tplOuter"></a>tplOuter
</h3>

<p>
Wraps around all the individual items.
</p>

<p>
Default:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
[[+wrapper]]
</pre>
</div>
</div>

<p>
Accepted properties:
</p>

<ul>
<li>wrapper: all individual items contained in their tplRow chunk, separated by the rowSeparator separator.
</li>

<li>total: the total amount of items in the result set.
</li>
</ul>

<h3>
<a name="bdListings.bdListings-tplRow" id="bdListings.bdListings-tplRow"></a>tplRow
</h3>

<p>
Used to output a single listing.
</p>

<p>
Default:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;div&gt;
    &lt;h2&gt;
        [[+redirect_url:notempty=`&lt;a href=<span class="code-quote">"[[+redirect_url]]"</span>&gt;[[+title]]&lt;/a&gt;`:<span class="code-keyword">default</span>=`[[+title]]`]]
    &lt;/h2&gt;
    [[+images:notempty=`&lt;p&gt;[[+primaryimage:notempty=`&lt;img src=<span class="code-quote">"[[+primaryimage:phpthumbof=`w=300&amp;h=200`]]"</span> alt=<span class="code-quote">"[[+title]]"</span> /&gt;&lt;br /&gt;`]] [[+images]]&lt;/p&gt;`]]
    &lt;p&gt;In [[+city]] - [[+neighborhood]] - [[+companyname]] - &lt;a href=<span class="code-quote">"[[+redirect_url]]"</span>&gt;[[+companyname]]&lt;/a&gt;&lt;/p&gt;
    [[+description:notempty=`&lt;p&gt;[[+description:nl2br]]&lt;/p&gt;`]]
    [[+googlemap_url:notempty=`&lt;a href=<span class="code-quote">"[[+googlemap_url]]"</span> title=<span class="code-quote">"View on Google Maps"</span>&gt;&lt;img src=<span class="code-quote">"[[+googlemap_static]]"</span> alt=<span class="code-quote">"Google Maps"</span>&gt;&lt;/a&gt;`]]
&lt;/div&gt;
</pre>
</div>
</div>

<p>
There's a lot of placeholders you can use there, and some properties have a direct influence on their value. Especially think of the redirect_url (which is influenced by &amp;redirectResource) and the googlemap_static placeholder which is a link generated based on the staticMap* properties (see further below).
</p>

<p>
Placeholders:
</p>

<ul>
<li>title
</li>

<li>description
</li>

<li>keywords
</li>

<li>price
</li>

<li>pricegroup / pricegroup_id (id)
</li>

<li>pricegroup_display
</li>

<li>category / category_id (id)
</li>

<li>category_name
</li>

<li>category_description
</li>

<li>subcategory / subcategory_id (id)
</li>

<li>subcategory_name
</li>

<li>subcategory_description
</li>

<li>target / target_id (id)
</li>

<li>target_name
</li>

<li>createdon (use with strtotime and date output modifiers)
</li>

<li>publisheduntil (use with strtotime and date output modifiers)
</li>

<li>active (1/0)
</li>

<li>featured (1/0)
</li>

<li>extended (1/0)
</li>

<li>companyname
</li>

<li>contactinfo
</li>

<li>address
</li>

<li>phone
</li>

<li>email
</li>

<li>neighborhood
</li>

<li>zip
</li>

<li>city
</li>

<li>country
</li>

<li>website
</li>

<li>latitude
</li>

<li>longitude
</li>

<li>clicks
</li>

<li>views
</li>

<li>googlemap_static: url to a static google map image (based on your map snippet properties, see further below). Empty if no lat/long is set.
</li>

<li>googlemap_url: url to maps.google.com/maps?q=LATITUDE,LONGITUDE. Empty if no lat/long is set.
</li>

<li>redirect_url: url to the &amp;redirectResource resource with the "lid" property and the listing ID as its value, used to redirect to the website set for the listing while tracking clicks. Empty if no website is set.
</li>

<li>images: filled with individual images templated with the tplImage chunk, separated by the imageSeparator property.
</li>

<li>primaryimage: if you have an image marked as primary, this will have the link (so not the tplImage tpl) to the image. If you don't have an image marked as primary it will attempt to use the first image.
</li>

<li>primaryimagepath: path to the image set in primaryimage.
</li>
</ul>

<h3>
<a name="bdListings.bdListings-tplImage%28lowerLthenupperi%29"></a>tplImage (lower L then upper i)
</h3>

<p>
Used to wrap around images inside a listing. (not used for the primaryimage property in the tplRow chunk)
</p>

<p>
Default:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;img src=<span class="code-quote">"[[+image:phpthumbof=`w=150&amp;h=150&amp;zc=1`]]"</span> alt=<span class="code-quote">"[[+caption]]"</span> /&gt;
</pre>
</div>
</div>

<p>
Placeholders:
</p>

<ul>
<li>image
</li>

<li>imagepath
</li>

<li>caption
</li>

<li>sortorder
</li>

<li>listing (id)
</li>

<li>primary (1|0)
</li>
</ul>

<h2>
<a name="bdListings.bdListings-StaticMapProperties" id="bdListings.bdListings-StaticMapProperties"></a>Static Map Properties
</h2>

<p>
In the tplRow chunk there's a googlemap_static placeholder. That's a simple image showing a map with the listing centered with a marker. The following properties influence its behavior, and I would suggest reading up on the Google Maps Static API if you are looking for more in-depth explanation of what goes on behind the scenes.
</p>

<div class='table-wrap'>
<table class='confluenceTable'>
<tbody>
<tr>
<th class='confluenceTh'>
Property Name
<br class="atl-forced-newline" />
</th>
<th class='confluenceTh'>
Description
<br class="atl-forced-newline" />
</th>
<th class='confluenceTh'>
Default Value
<br class="atl-forced-newline" />
</th>
</tr>

<tr>
<td class='confluenceTd'>
staticMapWidth
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Width of the image to generate.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
150
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
staticMapHeight
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Height of the image to generate.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
150
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
staticMapZoom
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Zoom level (1-23, depending on location)
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
12
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
staticMapType
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Type of map to show.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
hybrid
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
staticMapMarkerColor
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Color (some textual, otherwise hex) for the marker.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
red
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
staticMapMarkerLabel
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Text on the marker. Limited to 1 upper character or number.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
A
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
staticMapMarkerSize
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
[tiny|mid|small|medium] Size of the marker.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
medium
<br class="atl-forced-newline" />
</td>
</tr>

<tr>
<td class='confluenceTd'>
staticMapMarkerIcon
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
Optionally an icon to use instead of the marker. Consult the Google Maps Static API for detailed usage and what you need to encode or not. An example could be:
<br class="atl-forced-newline" />

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
http:<span class="code-comment">//chart.apis.google.com/chart?chst=d_map_pin_icon&amp;chld=cafe%7C996600</span>
</pre>
</div>
</div>
</td>
<td class='confluenceTd'>
&nbsp;
</td>
</tr>

<tr>
<td class='confluenceTd'>
staticMapMarkerIconShadow
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
["true" or "false", actual text so NOT 1 or 0] To use shadow or not when using a custom icon.
<br class="atl-forced-newline" />
</td>
<td class='confluenceTd'>
true
<br class="atl-forced-newline" />
</td>
</tr>
</tbody>
</table>
</div>

<h2>
<a name="bdListings.bdListings-Examples" id="bdListings.bdListings-Examples"></a>Examples
</h2>

<p>
Last 5 listings, simple list format:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;h3&gt;Lastest 5 Ads&lt;/h3&gt;
&lt;ul id=<span class="code-quote">"latest_ads"</span>&gt;
[[!bdListings? &amp;sort=`{<span class="code-quote">"createdon"</span>:<span class="code-quote">"DESC"</span>}`  &amp;tplRow=`bdl.listings.list` &amp;limit=`5`]]
&lt;/ul&gt;
</pre>
</div>
</div>

<p>
bdl.listings.list chunk, pointing to resource 14 (search results page which has an uncached bdListings call on it and accepts URL parameters) with the listing ID as filter, meaning it will only show the one listing.
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;li&gt;
  &lt;a href=<span class="code-quote">"[[~14? &amp;listings=`[[+id]]`]]"</span> title=<span class="code-quote">"[[+title]]"</span>&gt;[[+title]]&lt;/a&gt;
&lt;/li&gt;
</pre>
</div>
</div>