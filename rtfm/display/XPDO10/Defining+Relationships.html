<p>
We're going to need to define some relationships between our tables so xPDO can communicate properly between them. xPDO deals with two types of relationships, <b>aggregate</b> and <b>composite</b>.
</p>

<h2>
<a name="DefiningRelationships-AggregateRelationships" id="DefiningRelationships-AggregateRelationships"></a>Aggregate Relationships
</h2>

<p>
An aggregate relationship in xPDO is relationship between two tables where the secondary table is an aggregate of the primary table in such a way that if the primary table is deleted, the secondary table should still exist.
</p>

<p>
A great example of this is a collection of Crayons in a Box. The relationship from the Crayons to the Box is an <b>aggregate</b> relationship, and would be defined in our XML schema like such:
</p>

<pre class="brush: php">
    $crayon = $xpdo-&gt;getObject('Crayon',1);
$box = $crayon-&gt;getOne('Box');
echo $box-&gt;get('name');

    
</pre>
<h2>
<a name="DefiningRelationships-CompositeRelationships" id="DefiningRelationships-CompositeRelationships"></a>Composite Relationships
</h2>

<p>
A composite relationship in xPDO is relationship between two tables where the secondary table(s) are composites of the primary table in such a way that if the primary table is deleted, the secondary table(s) should be removed.
</p>

<p>
Back to our Crayon-Box example: The Crayons are Composites of the Box object. We'd define that in our XML schema as:
</p>

<pre class="brush: php">
    $box = $xpdo-&gt;getObject('Box',23);
$crayons = $box-&gt;getMany('Crayons');
foreach ($crayons as $crayon) {
   echo $crayon-&gt;get('color').'&lt;br /&gt;';
}

    
</pre>
<p>
Remember that in a Composite relationship, should the owner of the relationship be removed, all the Composites will be removed. So, if we remove the Box object:
</p>

<pre class="brush: xml">
    &lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;model package="storefinder" baseClass="xPDOObject" platform="mysql" defaultEngine="MyISAM" phpdoc-package="storefinder" phpdoc-subpackage="model"&gt;
  &lt;object class="sfStore" table="sfinder_stores" extends="xPDOSimpleObject"&gt;
        &lt;field key="name" dbtype="varchar" precision="100" phptype="string" null="false" default="" index="index" /&gt;
        &lt;field key="address" dbtype="varchar" precision="255" phptype="string" null="false" default="" /&gt;
        &lt;field key="city" dbtype="varchar" precision="255" phptype="string" null="false" default="" /&gt;
        &lt;field key="state" dbtype="varchar" precision="255" phptype="string" null="false" default="" /&gt;
        &lt;field key="zip" dbtype="varchar" precision="10" phptype="string" null="false" default="0" index="index" /&gt;
        &lt;field key="country" dbtype="varchar" precision="20" phptype="string" null="false" default="" /&gt;
        &lt;field key="phone" dbtype="varchar" precision="20" phptype="string" null="false" default="" /&gt;
        &lt;field key="fax" dbtype="varchar" precision="20" phptype="string" null="false" default="" /&gt;
        &lt;field key="active" dbtype="int" precision="1" attributes="unsigned" phptype="integer" null="false" default="0" /&gt;
  &lt;/object&gt;
  &lt;object class="sfOwner" table="sfinder_owners" extends="xPDOSimpleObject"&gt;
    &lt;field key="name" dbtype="varchar" precision="100" phptype="string" null="false" default="" index="index" /&gt;
    &lt;field key="email" dbtype="varchar" precision="255" phptype="string" null="false" default="" /&gt;
  &lt;/object&gt;
  
  &lt;object class="sfStoreOwner" table="sfinder_store_owners" extends="xPDOSimpleObject"&gt;
    &lt;field key="store" dbtype="int" precision="10" attributes="unsigned" phptype="integer" null="false" default="0" index="index" /&gt;
    &lt;field key="owner" dbtype="int" precision="10" attributes="unsigned" phptype="integer" null="false" default="0" index="index" /&gt;
  &lt;/object&gt;
&lt;/model&gt;

    
</pre>
<p>
We're going to want to relate Stores to Owners, but as you can see here, the relationship is "many-to-many" - an Owner can have multiple Stores, and a Store can have multiple Owners. So how do we handle this? Well, the best way is to create an intermediary table, which we'll call 'sfStoreOwner'. This table has only 3 fields - it's ID, and 2 indexed fields that are 'store' and 'owner'.
</p>

<p>
Those two fields contain the PK values of the Store and Owner it is relating. So let's add the relationships. In our sfStore definition, we want to add this line:
</p>

<pre class="brush: xml">
    &lt;composite alias="StoreOwners" class="sfStoreOwner" local="id" foreign="owner" 
cardinality="many" owner="local" /&gt;

    
</pre>
<p>
Note that both of our primary classes use a Composite relationship. This is because if any of our Stores or Owners get deleted, we want to delete any connecting relationships between them.
</p>

<p>
So go to our sfStoreOwner definition, and add these two lines:
</p>

<pre class="brush: php">
    $store = $xpdo-&gt;getObject('sfStore',43);
$storeOwners = $store-&gt;getMany('StoreOwners');
$owners = array();
foreach ($storeOwners as $storeOwner) {
    $owners[] = $storeOwner-&gt;getOne('Owner');
}
foreach ($owners as $owner) {
   echo $owner-&gt;get('name').'&lt;br /&gt;';
}

    
</pre>
<p>
And that will output a list of owners for that store.
</p>

<p>
However, as you can see, that code isn't very optimized. So we're going to optimize it a bit using $xpdo-&gt;newQuery:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$c = $xpdo-&gt;newQuery('sfOwner');
$c-&gt;innerJoin('sfStoreOwner','StoreOwners');
$c-&gt;where(array(
   'StoreOwners.store' =&gt; 43, <span class="code-comment">// the ID of our Store
</span>));
$owners = $xpdo-&gt;getCollection('sfOwner',$c);

foreach ($owners as $owner) {
   echo $owner-&gt;get('name').'&lt;br /&gt;';
}
</pre>
</div>
</div>

<p>
This block of code lets us grab all the owners of a store with only one query.
</p>

<h2>
<a name="DefiningRelationships-SeeAlso" id="DefiningRelationships-SeeAlso"></a>See Also
</h2>

<ul>
<li>
<a href="display/XPDO10/getOne" title="getOne">getOne</a>
</li>

<li>
<a href="display/XPDO10/getMany" title="getMany">getMany</a>
</li>

<li>
<a href="display/XPDO10/addOne" title="addOne">addOne</a>
</li>

<li>
<a href="display/XPDO10/addMany" title="addMany">addMany</a>
</li>

<li>
<a href="display/XPDO10/Retrieving+Objects" title="Retrieving Objects">Retrieving Objects</a>
</li>
</ul>