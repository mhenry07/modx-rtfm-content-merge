<p>
<br class="atl-forced-newline" />
</p>

<h2>
<a name="xPDOForeignKeyConstraint-WhatDoestheRuleDo%3F"></a>What Does the Rule Do?
</h2>

<p>
This rule tests the validity of a foreign key for a defined relationship.
</p>

<h2>
<a name="xPDOForeignKeyConstraint-UsingtheRule" id="xPDOForeignKeyConstraint-UsingtheRule"></a>Using the Rule
</h2>

<p>
Here we want to make sure no category ID is assigned to our object that doesnt have a category that exists.
</p>

<p>
First, our model:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
&lt;model <span class="code-keyword">package</span>=<span class="code-quote">"test"</span> baseClass=<span class="code-quote">"xPDOObject"</span> platform=<span class="code-quote">"mysql"</span>
       defaultEngine=<span class="code-quote">"MyISAM"</span> tablePrefix=<span class="code-quote">"test_"</span>&gt;    
    &lt;object class=<span class="code-quote">"myTest"</span> table=<span class="code-quote">"test"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"xPDOSimpleObject"</span>&gt;
        &lt;field key=<span class="code-quote">"category"</span> dbtype=<span class="code-quote">"<span class="code-object">int</span>"</span> precision=<span class="code-quote">"10"</span> attributes=<span class="code-quote">"unsigned"</span>
               phptype=<span class="code-quote">"integer"</span> <span class="code-keyword">default</span>=<span class="code-quote">"0"</span> <span class="code-keyword">null</span>=<span class="code-quote">"<span class="code-keyword">false</span>"</span> index=<span class="code-quote">"index"</span> /&gt;
                
        &lt;validation&gt;
            &lt;rule field=<span class="code-quote">"name"</span> 
                  name=<span class="code-quote">"preventBlank"</span>
                  type=<span class="code-quote">"xPDOValidationRule"</span>
                  rule=<span class="code-quote">"xPDOForeignKeyConstraint"</span>
                  foreign=<span class="code-quote">"id"</span>
                  local=<span class="code-quote">"category"</span>
                  alias=<span class="code-quote">"Category"</span>
                  class=<span class="code-quote">"modCategory"</span>
                  message=<span class="code-quote">"The category specified does not exist."</span>
             /&gt;
        &lt;/validation&gt;

        &lt;aggregate alias=<span class="code-quote">"Category"</span> class=<span class="code-quote">"modCategory"</span> 
                   local=<span class="code-quote">"category"</span> foreign=<span class="code-quote">"id"</span>
                   cardinality=<span class="code-quote">"one"</span> owner=<span class="code-quote">"foreign"</span> /&gt;
    &lt;/object&gt;
&lt;/model&gt;
</pre>
</div>
</div>

<p>
From there, go ahead and generate the model from the XML schema. And now in a Snippet we'll call Test:
</p>

<div class="code panel" style="border-width: 1px;">
<div class="codeContent panelContent">
<pre class="code-java">
$output = '';
$modx-&gt;addPackage('test','/path/to/my/test/model/','test_');
$obj = $modx-&gt;newObject('myTest');
$obj-&gt;set('category',123);
$validator = $obj-&gt;getValidator();
<span class="code-keyword">if</span> ($validator-&gt;validate() == <span class="code-keyword">false</span>) {
    $messages = $validator-&gt;getMessages();
    foreach ($messages as $errorMsg) {
        $output .= $errorMsg['message'];
    }
}
</pre>
</div>
</div>

<p>
This will display, assuming that a category doesn't exist with ID '123':
</p>

<blockquote>
<p>
The category specified does not exist.
</p>
</blockquote>

<p>
Similarly, we could have used the 'name' field as the "foreign" attribute in our schema, if we were setting our myTest object's category field to that name.
</p>

<h2>
<a name="xPDOForeignKeyConstraint-SeeAlso" id="xPDOForeignKeyConstraint-SeeAlso"></a>See Also
</h2>

<div class="plugin_pagetree">
<div style="margin-left: 2em" class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">
<div class="plugin_pagetree_children">
</div>
</div>

<fieldset class="hidden">
<input type="hidden" name="treeId" value="" /> <input type="hidden" name="treeRequestId" value="/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false" /> <input type="hidden" name="treePageId" value="11043020" /> <input type="hidden" name="noRoot" value="false" /> <input type="hidden" name="rootPageId" value="8192508" /> <input type="hidden" name="rootPage" value="" /> <input type="hidden" name="startDepth" value="0" /> <input type="hidden" name="spaceKey" value="XPDO10" /> <input type="hidden" name="i18n-pagetree.loading" value="Loading..." /> <input type="hidden" name="i18n-pagetree.error.permission" value="Unable to load page tree. It seems that you do not have permission to view the root page." /> <input type="hidden" name="i18n-pagetree.eeror.general" value="There was a problem retrieving the page tree. Please check the server log file for more information." /> <input type="hidden" name="loginUrl" value="/login.action?os_destination=%2Fdisplay%2FXPDO10%2FxPDOForeignKeyConstraint" />
<fieldset class="hidden">
<input type="hidden" name="ancestorId" value="8192508" />
</fieldset>
</fieldset>
</div>